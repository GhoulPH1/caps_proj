import{c as Zh,d as Fc}from"./chunk-7DHYIQBU.js";import{a as Ms,b as w0,c as x0,d as b0,e as k0,f as v0,g as S0,h as E0}from"./chunk-K5YOUKA3.js";import{c as xe,d as C,e as Ht,g as F,h as te,i as it,j as at}from"./chunk-PJRSMLCV.js";var Ay=xe((xU,Ey)=>{function Je(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Ey.exports=Je;Je.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Je.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Je.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},r),this._options.unref&&this._timer.unref(),!0};Je.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Je.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};Je.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};Je.prototype.start=Je.prototype.try;Je.prototype.errors=function(){return this._errors};Je.prototype.attempts=function(){return this._attempts};Je.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,r=0,n=0;n<this._errors.length;n++){var o=this._errors[n],s=o.message,i=(t[s]||0)+1;t[s]=i,i>=r&&(e=o,r=i)}return e}});var Ty=xe(zr=>{var jE=Ay();zr.operation=function(t){var e=zr.timeouts(t);return new jE(e,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})};zr.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],o=0;o<e.retries;o++)n.push(this.createTimeout(o,e));return t&&t.forever&&!n.length&&n.push(this.createTimeout(o,e)),n.sort(function(s,i){return s-i}),n};zr.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,n=Math.round(r*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return n=Math.min(n,e.maxTimeout),n};zr.wrap=function(t,e,r){if(e instanceof Array&&(r=e,e=null),!r){r=[];for(var n in t)typeof t[n]=="function"&&r.push(n)}for(var o=0;o<r.length;o++){var s=r[o],i=t[s];t[s]=function(c){var u=zr.operation(e),d=Array.prototype.slice.call(arguments,1),h=d.pop();d.push(function(w){u.retry(w)||(w&&(arguments[0]=u.mainError()),h.apply(this,arguments))}),u.attempt(function(){c.apply(t,d)})}.bind(t,i),t[s].options=e}}});var Dy=xe((kU,Iy)=>{Iy.exports=Ty()});var jw=xe((W4,Mw)=>{"use strict";Mw.exports=pe;var ss=hr();function pe(t,e){this.lo=t>>>0,this.hi=e>>>0}var Vr=pe.zero=new pe(0,0);Vr.toNumber=function(){return 0};Vr.zzEncode=Vr.zzDecode=function(){return this};Vr.length=function(){return 1};var i8=pe.zeroHash="\0\0\0\0\0\0\0\0";pe.fromNumber=function(e){if(e===0)return Vr;var r=e<0;r&&(e=-e);var n=e>>>0,o=(e-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new pe(n,o)};pe.from=function(e){if(typeof e=="number")return pe.fromNumber(e);if(ss.isString(e))if(ss.Long)e=ss.Long.fromString(e);else return pe.fromNumber(parseInt(e,10));return e.low||e.high?new pe(e.low>>>0,e.high>>>0):Vr};pe.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var r=~this.lo+1>>>0,n=~this.hi>>>0;return r||(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296};pe.prototype.toLong=function(e){return ss.Long?new ss.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var lr=String.prototype.charCodeAt;pe.fromHash=function(e){return e===i8?Vr:new pe((lr.call(e,0)|lr.call(e,1)<<8|lr.call(e,2)<<16|lr.call(e,3)<<24)>>>0,(lr.call(e,4)|lr.call(e,5)<<8|lr.call(e,6)<<16|lr.call(e,7)<<24)>>>0)};pe.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};pe.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};pe.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};pe.prototype.length=function(){var e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?e<16384?e<128?1:2:e<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}});var hr=xe(vl=>{"use strict";var L=vl;L.asPromise=w0();L.base64=x0();L.EventEmitter=b0();L.float=k0();L.inquire=v0();L.utf8=S0();L.pool=E0();L.LongBits=jw();L.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);L.global=L.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||vl;L.emptyArray=Object.freeze?Object.freeze([]):[];L.emptyObject=Object.freeze?Object.freeze({}):{};L.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};L.isString=function(e){return typeof e=="string"||e instanceof String};L.isObject=function(e){return e&&typeof e=="object"};L.isset=L.isSet=function(e,r){var n=e[r];return n!=null&&e.hasOwnProperty(r)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};L.Buffer=function(){try{var t=L.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch{return null}}();L._Buffer_from=null;L._Buffer_allocUnsafe=null;L.newBuffer=function(e){return typeof e=="number"?L.Buffer?L._Buffer_allocUnsafe(e):new L.Array(e):L.Buffer?L._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};L.Array=typeof Uint8Array<"u"?Uint8Array:Array;L.Long=L.global.dcodeIO&&L.global.dcodeIO.Long||L.global.Long||L.inquire("long");L.key2Re=/^true|false|0|1$/;L.key32Re=/^-?(?:0|[1-9][0-9]*)$/;L.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;L.longToHash=function(e){return e?L.LongBits.from(e).toHash():L.LongBits.zeroHash};L.longFromHash=function(e,r){var n=L.LongBits.fromHash(e);return L.Long?L.Long.fromBits(n.lo,n.hi,r):n.toNumber(!!r)};function Hw(t,e,r){for(var n=Object.keys(e),o=0;o<n.length;++o)(t[n[o]]===void 0||!r)&&(t[n[o]]=e[n[o]]);return t}L.merge=Hw;L.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Vw(t){function e(r,n){if(!(this instanceof e))return new e(r,n);Object.defineProperty(this,"message",{get:function(){return r}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&Hw(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return t},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}L.newError=Vw;L.ProtocolError=Vw("ProtocolError");L.oneOfGetter=function(e){for(var r={},n=0;n<e.length;++n)r[e[n]]=1;return function(){for(var o=Object.keys(this),s=o.length-1;s>-1;--s)if(r[o[s]]===1&&this[o[s]]!==void 0&&this[o[s]]!==null)return o[s]}};L.oneOfSetter=function(e){return function(r){for(var n=0;n<e.length;++n)e[n]!==r&&delete this[e[n]]}};L.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};L._configure=function(){var t=L.Buffer;if(!t){L._Buffer_from=L._Buffer_allocUnsafe=null;return}L._Buffer_from=t.from!==Uint8Array.from&&t.from||function(r,n){return new t(r,n)},L._Buffer_allocUnsafe=t.allocUnsafe||function(r){return new t(r)}}});var Bl=xe((K4,Kw)=>{"use strict";Kw.exports=q;var Ze=hr(),Sl,Ka=Ze.LongBits,qw=Ze.base64,Ww=Ze.utf8;function is(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}function Al(){}function a8(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function q(){this.len=0,this.head=new is(Al,0,0),this.tail=this.head,this.states=null}var Gw=function(){return Ze.Buffer?function(){return(q.create=function(){return new Sl})()}:function(){return new q}};q.create=Gw();q.alloc=function(e){return new Ze.Array(e)};Ze.Array!==Array&&(q.alloc=Ze.pool(q.alloc,Ze.Array.prototype.subarray));q.prototype._push=function(e,r,n){return this.tail=this.tail.next=new is(e,r,n),this.len+=r,this};function Tl(t,e,r){e[r]=t&255}function c8(t,e,r){for(;t>127;)e[r++]=t&127|128,t>>>=7;e[r]=t}function Il(t,e){this.len=t,this.next=void 0,this.val=e}Il.prototype=Object.create(is.prototype);Il.prototype.fn=c8;q.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Il((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};q.prototype.int32=function(e){return e<0?this._push(Dl,10,Ka.fromNumber(e)):this.uint32(e)};q.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Dl(t,e,r){for(;t.hi;)e[r++]=t.lo&127|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=t.lo&127|128,t.lo=t.lo>>>7;e[r++]=t.lo}q.prototype.uint64=function(e){var r=Ka.from(e);return this._push(Dl,r.length(),r)};q.prototype.int64=q.prototype.uint64;q.prototype.sint64=function(e){var r=Ka.from(e).zzEncode();return this._push(Dl,r.length(),r)};q.prototype.bool=function(e){return this._push(Tl,1,e?1:0)};function El(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}q.prototype.fixed32=function(e){return this._push(El,4,e>>>0)};q.prototype.sfixed32=q.prototype.fixed32;q.prototype.fixed64=function(e){var r=Ka.from(e);return this._push(El,4,r.lo)._push(El,4,r.hi)};q.prototype.sfixed64=q.prototype.fixed64;q.prototype.float=function(e){return this._push(Ze.float.writeFloatLE,4,e)};q.prototype.double=function(e){return this._push(Ze.float.writeDoubleLE,8,e)};var f8=Ze.Array.prototype.set?function(e,r,n){r.set(e,n)}:function(e,r,n){for(var o=0;o<e.length;++o)r[n+o]=e[o]};q.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(Tl,1,0);if(Ze.isString(e)){var n=q.alloc(r=qw.length(e));qw.decode(e,n,0),e=n}return this.uint32(r)._push(f8,r,e)};q.prototype.string=function(e){var r=Ww.length(e);return r?this.uint32(r)._push(Ww.write,r,e):this._push(Tl,1,0)};q.prototype.fork=function(){return this.states=new a8(this),this.head=this.tail=new is(Al,0,0),this.len=0,this};q.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new is(Al,0,0),this.len=0),this};q.prototype.ldelim=function(){var e=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=r,this.len+=n),this};q.prototype.finish=function(){for(var e=this.head.next,r=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,r,n),n+=e.len,e=e.next;return r};q._configure=function(t){Sl=t,q.create=Gw(),Sl._configure()}});var Qw=xe((J4,Zw)=>{"use strict";Zw.exports=wt;var Jw=Bl();(wt.prototype=Object.create(Jw.prototype)).constructor=wt;var pr=hr();function wt(){Jw.call(this)}wt._configure=function(){wt.alloc=pr._Buffer_allocUnsafe,wt.writeBytesBuffer=pr.Buffer&&pr.Buffer.prototype instanceof Uint8Array&&pr.Buffer.prototype.set.name==="set"?function(e,r,n){r.set(e,n)}:function(e,r,n){if(e.copy)e.copy(r,n,0,e.length);else for(var o=0;o<e.length;)r[n++]=e[o++]}};wt.prototype.bytes=function(e){pr.isString(e)&&(e=pr._Buffer_from(e,"base64"));var r=e.length>>>0;return this.uint32(r),r&&this._push(wt.writeBytesBuffer,r,e),this};function u8(t,e,r){t.length<40?pr.utf8.write(t,e,r):e.utf8Write?e.utf8Write(t,r):e.write(t,r)}wt.prototype.string=function(e){var r=pr.Buffer.byteLength(e);return this.uint32(r),r&&this._push(u8,r,e),this};wt._configure()});var Cl=xe((Z4,rx)=>{"use strict";rx.exports=ae;var ot=hr(),Ll,ex=ot.LongBits,d8=ot.utf8;function st(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function ae(t){this.buf=t,this.pos=0,this.len=t.length}var Yw=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new ae(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new ae(e);throw Error("illegal buffer")},tx=function(){return ot.Buffer?function(r){return(ae.create=function(o){return ot.Buffer.isBuffer(o)?new Ll(o):Yw(o)})(r)}:Yw};ae.create=tx();ae.prototype._slice=ot.Array.prototype.subarray||ot.Array.prototype.slice;ae.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,st(this,10);return e}}();ae.prototype.int32=function(){return this.uint32()|0};ae.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function _l(){var t=new ex(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw st(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw st(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}ae.prototype.bool=function(){return this.uint32()!==0};function Ja(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}ae.prototype.fixed32=function(){if(this.pos+4>this.len)throw st(this,4);return Ja(this.buf,this.pos+=4)};ae.prototype.sfixed32=function(){if(this.pos+4>this.len)throw st(this,4);return Ja(this.buf,this.pos+=4)|0};function Xw(){if(this.pos+8>this.len)throw st(this,8);return new ex(Ja(this.buf,this.pos+=4),Ja(this.buf,this.pos+=4))}ae.prototype.float=function(){if(this.pos+4>this.len)throw st(this,4);var e=ot.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};ae.prototype.double=function(){if(this.pos+8>this.len)throw st(this,4);var e=ot.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};ae.prototype.bytes=function(){var e=this.uint32(),r=this.pos,n=this.pos+e;if(n>this.len)throw st(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(r,n);if(r===n){var o=ot.Buffer;return o?o.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,r,n)};ae.prototype.string=function(){var e=this.bytes();return d8.read(e,0,e.length)};ae.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw st(this,e);this.pos+=e}else do if(this.pos>=this.len)throw st(this);while(this.buf[this.pos++]&128);return this};ae.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this};ae._configure=function(t){Ll=t,ae.create=tx(),Ll._configure();var e=ot.Long?"toLong":"toNumber";ot.merge(ae.prototype,{int64:function(){return _l.call(this)[e](!1)},uint64:function(){return _l.call(this)[e](!0)},sint64:function(){return _l.call(this).zzDecode()[e](!1)},fixed64:function(){return Xw.call(this)[e](!0)},sfixed64:function(){return Xw.call(this)[e](!1)}})}});var ix=xe((Q4,sx)=>{"use strict";sx.exports=qr;var ox=Cl();(qr.prototype=Object.create(ox.prototype)).constructor=qr;var nx=hr();function qr(t){ox.call(this,t)}qr._configure=function(){nx.Buffer&&(qr.prototype._slice=nx.Buffer.prototype.slice)};qr.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};qr._configure()});var cx=xe((Y4,ax)=>{"use strict";ax.exports=as;var Ul=hr();(as.prototype=Object.create(Ul.EventEmitter.prototype)).constructor=as;function as(t,e,r){if(typeof t!="function")throw TypeError("rpcImpl must be a function");Ul.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!e,this.responseDelimited=!!r}as.prototype.rpcCall=function t(e,r,n,o,s){if(!o)throw TypeError("request must be specified");var i=this;if(!s)return Ul.asPromise(t,i,e,r,n,o);if(!i.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return i.rpcImpl(e,r[i.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(c,u){if(c)return i.emit("error",c,e),s(c);if(u===null){i.end(!0);return}if(!(u instanceof n))try{u=n[i.responseDelimited?"decodeDelimited":"decode"](u)}catch(d){return i.emit("error",d,e),s(d)}return i.emit("data",u,e),s(null,u)})}catch(a){i.emit("error",a,e),setTimeout(function(){s(a)},0);return}};as.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var ux=xe(fx=>{"use strict";var l8=fx;l8.Service=cx()});var lx=xe((eO,dx)=>{"use strict";dx.exports={}});var mx=xe(px=>{"use strict";var Be=px;Be.build="minimal";Be.Writer=Bl();Be.BufferWriter=Qw();Be.Reader=Cl();Be.BufferReader=ix();Be.util=hr();Be.rpc=ux();Be.roots=lx();Be.configure=hx;function hx(){Be.util._configure(),Be.Writer._configure(Be.BufferWriter),Be.Reader._configure(Be.BufferReader)}hx()});var yx=xe((rO,gx)=>{"use strict";gx.exports=mx()});var hb=xe((ks,mc)=>{(function(t,e){"use strict";var r={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function n(f){if(!Array.isArray(f)&&!ArrayBuffer.isView(f))return!1;for(var l=0;l<f.length;l++)if(!Number.isInteger(f[l])||f[l]<0||f[l]>255)return!1;return!0}function o(f,l){return(f&65535)*l+(((f>>>16)*l&65535)<<16)}function s(f,l){return f<<l|f>>>32-l}function i(f){return f^=f>>>16,f=o(f,2246822507),f^=f>>>13,f=o(f,3266489909),f^=f>>>16,f}function a(f,l){f=[f[0]>>>16,f[0]&65535,f[1]>>>16,f[1]&65535],l=[l[0]>>>16,l[0]&65535,l[1]>>>16,l[1]&65535];var m=[0,0,0,0];return m[3]+=f[3]+l[3],m[2]+=m[3]>>>16,m[3]&=65535,m[2]+=f[2]+l[2],m[1]+=m[2]>>>16,m[2]&=65535,m[1]+=f[1]+l[1],m[0]+=m[1]>>>16,m[1]&=65535,m[0]+=f[0]+l[0],m[0]&=65535,[m[0]<<16|m[1],m[2]<<16|m[3]]}function c(f,l){f=[f[0]>>>16,f[0]&65535,f[1]>>>16,f[1]&65535],l=[l[0]>>>16,l[0]&65535,l[1]>>>16,l[1]&65535];var m=[0,0,0,0];return m[3]+=f[3]*l[3],m[2]+=m[3]>>>16,m[3]&=65535,m[2]+=f[2]*l[3],m[1]+=m[2]>>>16,m[2]&=65535,m[2]+=f[3]*l[2],m[1]+=m[2]>>>16,m[2]&=65535,m[1]+=f[1]*l[3],m[0]+=m[1]>>>16,m[1]&=65535,m[1]+=f[2]*l[2],m[0]+=m[1]>>>16,m[1]&=65535,m[1]+=f[3]*l[1],m[0]+=m[1]>>>16,m[1]&=65535,m[0]+=f[0]*l[3]+f[1]*l[2]+f[2]*l[1]+f[3]*l[0],m[0]&=65535,[m[0]<<16|m[1],m[2]<<16|m[3]]}function u(f,l){return l%=64,l===32?[f[1],f[0]]:l<32?[f[0]<<l|f[1]>>>32-l,f[1]<<l|f[0]>>>32-l]:(l-=32,[f[1]<<l|f[0]>>>32-l,f[0]<<l|f[1]>>>32-l])}function d(f,l){return l%=64,l===0?f:l<32?[f[0]<<l|f[1]>>>32-l,f[1]<<l]:[f[1]<<l-32,0]}function h(f,l){return[f[0]^l[0],f[1]^l[1]]}function w(f){return f=h(f,[0,f[0]>>>1]),f=c(f,[4283543511,3981806797]),f=h(f,[0,f[0]>>>1]),f=c(f,[3301882366,444984403]),f=h(f,[0,f[0]>>>1]),f}r.x86.hash32=function(f,l){if(r.inputValidation&&!n(f))return e;l=l||0;for(var m=f.length%4,D=f.length-m,g=l,y=0,S=3432918353,v=461845907,A=0;A<D;A=A+4)y=f[A]|f[A+1]<<8|f[A+2]<<16|f[A+3]<<24,y=o(y,S),y=s(y,15),y=o(y,v),g^=y,g=s(g,13),g=o(g,5)+3864292196;switch(y=0,m){case 3:y^=f[A+2]<<16;case 2:y^=f[A+1]<<8;case 1:y^=f[A],y=o(y,S),y=s(y,15),y=o(y,v),g^=y}return g^=f.length,g=i(g),g>>>0},r.x86.hash128=function(f,l){if(r.inputValidation&&!n(f))return e;l=l||0;for(var m=f.length%16,D=f.length-m,g=l,y=l,S=l,v=l,A=0,B=0,E=0,U=0,oe=597399067,Jr=2869860233,br=951274213,Fs=2716044179,H=0;H<D;H=H+16)A=f[H]|f[H+1]<<8|f[H+2]<<16|f[H+3]<<24,B=f[H+4]|f[H+5]<<8|f[H+6]<<16|f[H+7]<<24,E=f[H+8]|f[H+9]<<8|f[H+10]<<16|f[H+11]<<24,U=f[H+12]|f[H+13]<<8|f[H+14]<<16|f[H+15]<<24,A=o(A,oe),A=s(A,15),A=o(A,Jr),g^=A,g=s(g,19),g+=y,g=o(g,5)+1444728091,B=o(B,Jr),B=s(B,16),B=o(B,br),y^=B,y=s(y,17),y+=S,y=o(y,5)+197830471,E=o(E,br),E=s(E,17),E=o(E,Fs),S^=E,S=s(S,15),S+=v,S=o(S,5)+2530024501,U=o(U,Fs),U=s(U,18),U=o(U,oe),v^=U,v=s(v,13),v+=g,v=o(v,5)+850148119;switch(A=0,B=0,E=0,U=0,m){case 15:U^=f[H+14]<<16;case 14:U^=f[H+13]<<8;case 13:U^=f[H+12],U=o(U,Fs),U=s(U,18),U=o(U,oe),v^=U;case 12:E^=f[H+11]<<24;case 11:E^=f[H+10]<<16;case 10:E^=f[H+9]<<8;case 9:E^=f[H+8],E=o(E,br),E=s(E,17),E=o(E,Fs),S^=E;case 8:B^=f[H+7]<<24;case 7:B^=f[H+6]<<16;case 6:B^=f[H+5]<<8;case 5:B^=f[H+4],B=o(B,Jr),B=s(B,16),B=o(B,br),y^=B;case 4:A^=f[H+3]<<24;case 3:A^=f[H+2]<<16;case 2:A^=f[H+1]<<8;case 1:A^=f[H],A=o(A,oe),A=s(A,15),A=o(A,Jr),g^=A}return g^=f.length,y^=f.length,S^=f.length,v^=f.length,g+=y,g+=S,g+=v,y+=g,S+=g,v+=g,g=i(g),y=i(y),S=i(S),v=i(v),g+=y,g+=S,g+=v,y+=g,S+=g,v+=g,("00000000"+(g>>>0).toString(16)).slice(-8)+("00000000"+(y>>>0).toString(16)).slice(-8)+("00000000"+(S>>>0).toString(16)).slice(-8)+("00000000"+(v>>>0).toString(16)).slice(-8)},r.x64.hash128=function(f,l){if(r.inputValidation&&!n(f))return e;l=l||0;for(var m=f.length%16,D=f.length-m,g=[0,l],y=[0,l],S=[0,0],v=[0,0],A=[2277735313,289559509],B=[1291169091,658871167],E=0;E<D;E=E+16)S=[f[E+4]|f[E+5]<<8|f[E+6]<<16|f[E+7]<<24,f[E]|f[E+1]<<8|f[E+2]<<16|f[E+3]<<24],v=[f[E+12]|f[E+13]<<8|f[E+14]<<16|f[E+15]<<24,f[E+8]|f[E+9]<<8|f[E+10]<<16|f[E+11]<<24],S=c(S,A),S=u(S,31),S=c(S,B),g=h(g,S),g=u(g,27),g=a(g,y),g=a(c(g,[0,5]),[0,1390208809]),v=c(v,B),v=u(v,33),v=c(v,A),y=h(y,v),y=u(y,31),y=a(y,g),y=a(c(y,[0,5]),[0,944331445]);switch(S=[0,0],v=[0,0],m){case 15:v=h(v,d([0,f[E+14]],48));case 14:v=h(v,d([0,f[E+13]],40));case 13:v=h(v,d([0,f[E+12]],32));case 12:v=h(v,d([0,f[E+11]],24));case 11:v=h(v,d([0,f[E+10]],16));case 10:v=h(v,d([0,f[E+9]],8));case 9:v=h(v,[0,f[E+8]]),v=c(v,B),v=u(v,33),v=c(v,A),y=h(y,v);case 8:S=h(S,d([0,f[E+7]],56));case 7:S=h(S,d([0,f[E+6]],48));case 6:S=h(S,d([0,f[E+5]],40));case 5:S=h(S,d([0,f[E+4]],32));case 4:S=h(S,d([0,f[E+3]],24));case 3:S=h(S,d([0,f[E+2]],16));case 2:S=h(S,d([0,f[E+1]],8));case 1:S=h(S,[0,f[E]]),S=c(S,A),S=u(S,31),S=c(S,B),g=h(g,S)}return g=h(g,[0,f.length]),y=h(y,[0,f.length]),g=a(g,y),y=a(y,g),g=w(g),y=w(y),g=a(g,y),y=a(y,g),("00000000"+(g[0]>>>0).toString(16)).slice(-8)+("00000000"+(g[1]>>>0).toString(16)).slice(-8)+("00000000"+(y[0]>>>0).toString(16)).slice(-8)+("00000000"+(y[1]>>>0).toString(16)).slice(-8)},typeof ks<"u"?(typeof mc<"u"&&mc.exports&&(ks=mc.exports=r),ks.murmurHash3=r):typeof define=="function"&&define.amd?define([],function(){return r}):(r._murmurHash3=t.murmurHash3,r.noConflict=function(){return t.murmurHash3=r._murmurHash3,r._murmurHash3=e,r.noConflict=e,r},t.murmurHash3=r)})(ks)});var hh=xe((DO,pb)=>{pb.exports=hb()});var Tf={};C(Tf,{Digest:()=>Sf,MAX_HEIGHT:()=>Lm,MAX_PAYLOAD_SIZE:()=>Af,code:()=>Ef,create:()=>pk,digest:()=>hk,name:()=>_m});var Mc=BigInt(4),Zr=254,Qr=256,kt=4*Zr/8,Qn=4*Qr/8,Yr=BigInt(kt),js=BigInt(Qn),KI=Qn/4,Hs=Zr/Qr,ce=Qn/4,Qh=BigInt(ce),Yh=2*ce+1;var A0=t=>{if(t instanceof Uint8Array){if(t.length>ce)return t.subarray(0,ce);if(t.length==ce)return t}let e=new Uint8Array(ce);return e.set([...t]),e},jc=()=>Xh,Xh=A0(new Uint8Array(ce).fill(0));Object.freeze(Xh.buffer);var kr={};C(kr,{coerce:()=>ct,empty:()=>ep,equals:()=>Vs,fromHex:()=>D0,fromString:()=>Hc,isBinary:()=>B0,toHex:()=>I0,toString:()=>Vc});var ep=new Uint8Array(0);function I0(t){return t.reduce((e,r)=>e+r.toString(16).padStart(2,"0"),"")}function D0(t){let e=t.match(/../g);return e!=null?new Uint8Array(e.map(r=>parseInt(r,16))):ep}function Vs(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}function ct(t){if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")}function B0(t){return t instanceof ArrayBuffer||ArrayBuffer.isView(t)}function Hc(t){return new TextEncoder().encode(t)}function Vc(t){return new TextDecoder().decode(t)}var Vt={};C(Vt,{code:()=>U0,digest:()=>L0,name:()=>qc,size:()=>Wc});import{sha256 as _0}from"@noble/hashes/sha256";var qc="sha2-256";var Wc=32,Ws=new Uint8Array([18,32]),qs=class{constructor(e){this.code=18,this.name=qc,this.bytes=e,this.size=32,this.digest=e.subarray(2)}};var L0=t=>{let e=new Uint8Array(Ws.length+32);return e.set(Ws,0),e.set(_0(t),Ws.length),new qs(e)};var U0=18;var O0=["string","number","bigint","symbol"],P0=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function rp(t){if(t===null)return"null";if(t===void 0)return"undefined";if(t===!0||t===!1)return"boolean";let e=typeof t;if(O0.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(t))return"Array";if(R0(t))return"Buffer";let r=N0(t);return r||"Object"}function R0(t){return t&&t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer.call(null,t)}function N0(t){let e=Object.prototype.toString.call(t).slice(8,-1);if(P0.includes(e))return e}var p=class{constructor(e,r,n){this.major=e,this.majorEncoded=e<<5,this.name=r,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}};p.uint=new p(0,"uint",!0);p.negint=new p(1,"negint",!0);p.bytes=new p(2,"bytes",!0);p.string=new p(3,"string",!0);p.array=new p(4,"array",!1);p.map=new p(5,"map",!1);p.tag=new p(6,"tag",!1);p.float=new p(7,"float",!0);p.false=new p(7,"false",!0);p.true=new p(7,"true",!0);p.null=new p(7,"null",!0);p.undefined=new p(7,"undefined",!0);p.break=new p(7,"break",!0);var b=class{constructor(e,r,n){this.type=e,this.value=r,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}};var Xr=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",$0=new TextDecoder,z0=new TextEncoder;function Gs(t){return Xr&&globalThis.Buffer.isBuffer(t)}function Yn(t){return t instanceof Uint8Array?Gs(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t:Uint8Array.from(t)}var ip=Xr?(t,e,r)=>r-e>64?globalThis.Buffer.from(t.subarray(e,r)).toString("utf8"):op(t,e,r):(t,e,r)=>r-e>64?$0.decode(t.subarray(e,r)):op(t,e,r),Ks=Xr?t=>t.length>64?globalThis.Buffer.from(t):np(t):t=>t.length>64?z0.encode(t):np(t),ft=t=>Uint8Array.from(t),en=Xr?(t,e,r)=>Gs(t)?new Uint8Array(t.subarray(e,r)):t.slice(e,r):(t,e,r)=>t.slice(e,r),ap=Xr?(t,e)=>(t=t.map(r=>r instanceof Uint8Array?r:globalThis.Buffer.from(r)),Yn(globalThis.Buffer.concat(t,e))):(t,e)=>{let r=new Uint8Array(e),n=0;for(let o of t)n+o.length>r.length&&(o=o.subarray(0,r.length-n)),r.set(o,n),n+=o.length;return r},cp=Xr?t=>globalThis.Buffer.allocUnsafe(t):t=>new Uint8Array(t);function fp(t,e){if(Gs(t)&&Gs(e))return t.compare(e);for(let r=0;r<t.length;r++)if(t[r]!==e[r])return t[r]<e[r]?-1:1;return 0}function np(t){let e=[],r=0;for(let n=0;n<t.length;n++){let o=t.charCodeAt(n);o<128?e[r++]=o:o<2048?(e[r++]=o>>6|192,e[r++]=o&63|128):(o&64512)===55296&&n+1<t.length&&(t.charCodeAt(n+1)&64512)===56320?(o=65536+((o&1023)<<10)+(t.charCodeAt(++n)&1023),e[r++]=o>>18|240,e[r++]=o>>12&63|128,e[r++]=o>>6&63|128,e[r++]=o&63|128):(e[r++]=o>>12|224,e[r++]=o>>6&63|128,e[r++]=o&63|128)}return e}function op(t,e,r){let n=[];for(;e<r;){let o=t[e],s=null,i=o>239?4:o>223?3:o>191?2:1;if(e+i<=r){let a,c,u,d;switch(i){case 1:o<128&&(s=o);break;case 2:a=t[e+1],(a&192)===128&&(d=(o&31)<<6|a&63,d>127&&(s=d));break;case 3:a=t[e+1],c=t[e+2],(a&192)===128&&(c&192)===128&&(d=(o&15)<<12|(a&63)<<6|c&63,d>2047&&(d<55296||d>57343)&&(s=d));break;case 4:a=t[e+1],c=t[e+2],u=t[e+3],(a&192)===128&&(c&192)===128&&(u&192)===128&&(d=(o&15)<<18|(a&63)<<12|(c&63)<<6|u&63,d>65535&&d<1114112&&(s=d))}}s===null?(s=65533,i=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|s&1023),n.push(s),e+=i}return Gc(n)}var sp=4096;function Gc(t){let e=t.length;if(e<=sp)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=sp));return r}var F0=256,Xn=class{constructor(e=F0){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let r=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let o=r.length-(this.maxCursor-this.cursor)-1;r.set(e,o)}else{if(r){let o=r.length-(this.maxCursor-this.cursor)-1;o<r.length&&(this.chunks[this.chunks.length-1]=r.subarray(0,o),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(r=cp(this.chunkSize),this.chunks.push(r),this.maxCursor+=r.length,this._initReuseChunk===null&&(this._initReuseChunk=r),r.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let r;if(this.chunks.length===1){let n=this.chunks[0];e&&this.cursor>n.length/2?(r=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):r=en(n,0,this.cursor)}else r=ap(this.chunks,this.cursor);return e&&this.reset(),r}};var I="CBOR decode error:",vt="CBOR encode error:",eo=[];eo[23]=1;eo[24]=2;eo[25]=3;eo[26]=5;eo[27]=9;function St(t,e,r){if(t.length-e<r)throw new Error(`${I} not enough data for type`)}var de=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Ce(t,e,r){St(t,e,1);let n=t[e];if(r.strict===!0&&n<de[0])throw new Error(`${I} integer encoded in more bytes than necessary (strict decode)`);return n}function Ue(t,e,r){St(t,e,2);let n=t[e]<<8|t[e+1];if(r.strict===!0&&n<de[1])throw new Error(`${I} integer encoded in more bytes than necessary (strict decode)`);return n}function Oe(t,e,r){St(t,e,4);let n=t[e]*16777216+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3];if(r.strict===!0&&n<de[2])throw new Error(`${I} integer encoded in more bytes than necessary (strict decode)`);return n}function Pe(t,e,r){St(t,e,8);let n=t[e]*16777216+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3],o=t[e+4]*16777216+(t[e+5]<<16)+(t[e+6]<<8)+t[e+7],s=(BigInt(n)<<BigInt(32))+BigInt(o);if(r.strict===!0&&s<de[3])throw new Error(`${I} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(r.allowBigInt===!0)return s;throw new Error(`${I} integers outside of the safe integer range are not supported`)}function up(t,e,r,n){return new b(p.uint,Ce(t,e+1,n),2)}function dp(t,e,r,n){return new b(p.uint,Ue(t,e+1,n),3)}function lp(t,e,r,n){return new b(p.uint,Oe(t,e+1,n),5)}function hp(t,e,r,n){return new b(p.uint,Pe(t,e+1,n),9)}function Me(t,e){return me(t,0,e.value)}function me(t,e,r){if(r<de[0]){let n=Number(r);t.push([e|n])}else if(r<de[1]){let n=Number(r);t.push([e|24,n])}else if(r<de[2]){let n=Number(r);t.push([e|25,n>>>8,n&255])}else if(r<de[3]){let n=Number(r);t.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{let n=BigInt(r);if(n<de[4]){let o=[e|27,0,0,0,0,0,0,0],s=Number(n&BigInt(4294967295)),i=Number(n>>BigInt(32)&BigInt(4294967295));o[8]=s&255,s=s>>8,o[7]=s&255,s=s>>8,o[6]=s&255,s=s>>8,o[5]=s&255,o[4]=i&255,i=i>>8,o[3]=i&255,i=i>>8,o[2]=i&255,i=i>>8,o[1]=i&255,t.push(o)}else throw new Error(`${I} encountered BigInt larger than allowable range`)}}Me.encodedSize=function(e){return me.encodedSize(e.value)};me.encodedSize=function(e){return e<de[0]?1:e<de[1]?2:e<de[2]?3:e<de[3]?5:9};Me.compareTokens=function(e,r){return e.value<r.value?-1:e.value>r.value?1:0};function pp(t,e,r,n){return new b(p.negint,-1-Ce(t,e+1,n),2)}function mp(t,e,r,n){return new b(p.negint,-1-Ue(t,e+1,n),3)}function gp(t,e,r,n){return new b(p.negint,-1-Oe(t,e+1,n),5)}var Kc=BigInt(-1),yp=BigInt(1);function wp(t,e,r,n){let o=Pe(t,e+1,n);if(typeof o!="bigint"){let s=-1-o;if(s>=Number.MIN_SAFE_INTEGER)return new b(p.negint,s,9)}if(n.allowBigInt!==!0)throw new Error(`${I} integers outside of the safe integer range are not supported`);return new b(p.negint,Kc-BigInt(o),9)}function Js(t,e){let r=e.value,n=typeof r=="bigint"?r*Kc-yp:r*-1-1;me(t,e.type.majorEncoded,n)}Js.encodedSize=function(e){let r=e.value,n=typeof r=="bigint"?r*Kc-yp:r*-1-1;return n<de[0]?1:n<de[1]?2:n<de[2]?3:n<de[3]?5:9};Js.compareTokens=function(e,r){return e.value<r.value?1:e.value>r.value?-1:0};function to(t,e,r,n){St(t,e,r+n);let o=en(t,e+r,e+r+n);return new b(p.bytes,o,r+n)}function xp(t,e,r,n){return to(t,e,1,r)}function bp(t,e,r,n){return to(t,e,2,Ce(t,e+1,n))}function kp(t,e,r,n){return to(t,e,3,Ue(t,e+1,n))}function vp(t,e,r,n){return to(t,e,5,Oe(t,e+1,n))}function Sp(t,e,r,n){let o=Pe(t,e+1,n);if(typeof o=="bigint")throw new Error(`${I} 64-bit integer bytes lengths not supported`);return to(t,e,9,o)}function Zs(t){return t.encodedBytes===void 0&&(t.encodedBytes=t.type===p.string?Ks(t.value):t.value),t.encodedBytes}function tn(t,e){let r=Zs(e);me(t,e.type.majorEncoded,r.length),t.push(r)}tn.encodedSize=function(e){let r=Zs(e);return me.encodedSize(r.length)+r.length};tn.compareTokens=function(e,r){return j0(Zs(e),Zs(r))};function j0(t,e){return t.length<e.length?-1:t.length>e.length?1:fp(t,e)}function ro(t,e,r,n,o){let s=r+n;St(t,e,s);let i=new b(p.string,ip(t,e+r,e+s),s);return o.retainStringBytes===!0&&(i.byteValue=en(t,e+r,e+s)),i}function Ep(t,e,r,n){return ro(t,e,1,r,n)}function Ap(t,e,r,n){return ro(t,e,2,Ce(t,e+1,n),n)}function Tp(t,e,r,n){return ro(t,e,3,Ue(t,e+1,n),n)}function Ip(t,e,r,n){return ro(t,e,5,Oe(t,e+1,n),n)}function Dp(t,e,r,n){let o=Pe(t,e+1,n);if(typeof o=="bigint")throw new Error(`${I} 64-bit integer string lengths not supported`);return ro(t,e,9,o,n)}var Bp=tn;function rn(t,e,r,n){return new b(p.array,n,r)}function _p(t,e,r,n){return rn(t,e,1,r)}function Lp(t,e,r,n){return rn(t,e,2,Ce(t,e+1,n))}function Cp(t,e,r,n){return rn(t,e,3,Ue(t,e+1,n))}function Up(t,e,r,n){return rn(t,e,5,Oe(t,e+1,n))}function Op(t,e,r,n){let o=Pe(t,e+1,n);if(typeof o=="bigint")throw new Error(`${I} 64-bit integer array lengths not supported`);return rn(t,e,9,o)}function Pp(t,e,r,n){if(n.allowIndefinite===!1)throw new Error(`${I} indefinite length items not allowed`);return rn(t,e,1,1/0)}function Qs(t,e){me(t,p.array.majorEncoded,e.value)}Qs.compareTokens=Me.compareTokens;Qs.encodedSize=function(e){return me.encodedSize(e.value)};function nn(t,e,r,n){return new b(p.map,n,r)}function Rp(t,e,r,n){return nn(t,e,1,r)}function Np(t,e,r,n){return nn(t,e,2,Ce(t,e+1,n))}function $p(t,e,r,n){return nn(t,e,3,Ue(t,e+1,n))}function zp(t,e,r,n){return nn(t,e,5,Oe(t,e+1,n))}function Fp(t,e,r,n){let o=Pe(t,e+1,n);if(typeof o=="bigint")throw new Error(`${I} 64-bit integer map lengths not supported`);return nn(t,e,9,o)}function Mp(t,e,r,n){if(n.allowIndefinite===!1)throw new Error(`${I} indefinite length items not allowed`);return nn(t,e,1,1/0)}function Ys(t,e){me(t,p.map.majorEncoded,e.value)}Ys.compareTokens=Me.compareTokens;Ys.encodedSize=function(e){return me.encodedSize(e.value)};function jp(t,e,r,n){return new b(p.tag,r,1)}function Hp(t,e,r,n){return new b(p.tag,Ce(t,e+1,n),2)}function Vp(t,e,r,n){return new b(p.tag,Ue(t,e+1,n),3)}function qp(t,e,r,n){return new b(p.tag,Oe(t,e+1,n),5)}function Wp(t,e,r,n){return new b(p.tag,Pe(t,e+1,n),9)}function Xs(t,e){me(t,p.tag.majorEncoded,e.value)}Xs.compareTokens=Me.compareTokens;Xs.encodedSize=function(e){return me.encodedSize(e.value)};var K0=20,J0=21,Z0=22,Q0=23;function Gp(t,e,r,n){if(n.allowUndefined===!1)throw new Error(`${I} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new b(p.null,null,1):new b(p.undefined,void 0,1)}function Kp(t,e,r,n){if(n.allowIndefinite===!1)throw new Error(`${I} indefinite length items not allowed`);return new b(p.break,void 0,1)}function Jc(t,e,r){if(r){if(r.allowNaN===!1&&Number.isNaN(t))throw new Error(`${I} NaN values are not supported`);if(r.allowInfinity===!1&&(t===1/0||t===-1/0))throw new Error(`${I} Infinity values are not supported`)}return new b(p.float,t,e)}function Jp(t,e,r,n){return Jc(Zc(t,e+1),3,n)}function Zp(t,e,r,n){return Jc(Qc(t,e+1),5,n)}function Qp(t,e,r,n){return Jc(tm(t,e+1),9,n)}function ei(t,e,r){let n=e.value;if(n===!1)t.push([p.float.majorEncoded|K0]);else if(n===!0)t.push([p.float.majorEncoded|J0]);else if(n===null)t.push([p.float.majorEncoded|Z0]);else if(n===void 0)t.push([p.float.majorEncoded|Q0]);else{let o,s=!1;(!r||r.float64!==!0)&&(Xp(n),o=Zc(Qe,1),n===o||Number.isNaN(n)?(Qe[0]=249,t.push(Qe.slice(0,3)),s=!0):(em(n),o=Qc(Qe,1),n===o&&(Qe[0]=250,t.push(Qe.slice(0,5)),s=!0))),s||(Y0(n),o=tm(Qe,1),Qe[0]=251,t.push(Qe.slice(0,9)))}}ei.encodedSize=function(e,r){let n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!r||r.float64!==!0){Xp(n);let o=Zc(Qe,1);if(n===o||Number.isNaN(n))return 3;if(em(n),o=Qc(Qe,1),n===o)return 5}return 9};var Yp=new ArrayBuffer(9),je=new DataView(Yp,1),Qe=new Uint8Array(Yp,0);function Xp(t){if(t===1/0)je.setUint16(0,31744,!1);else if(t===-1/0)je.setUint16(0,64512,!1);else if(Number.isNaN(t))je.setUint16(0,32256,!1);else{je.setFloat32(0,t);let e=je.getUint32(0),r=(e&2139095040)>>23,n=e&8388607;if(r===255)je.setUint16(0,31744,!1);else if(r===0)je.setUint16(0,(t&2147483648)>>16|n>>13,!1);else{let o=r-127;o<-24?je.setUint16(0,0):o<-14?je.setUint16(0,(e&2147483648)>>16|1<<24+o,!1):je.setUint16(0,(e&2147483648)>>16|o+15<<10|n>>13,!1)}}}function Zc(t,e){if(t.length-e<2)throw new Error(`${I} not enough data for float16`);let r=(t[e]<<8)+t[e+1];if(r===31744)return 1/0;if(r===64512)return-1/0;if(r===32256)return NaN;let n=r>>10&31,o=r&1023,s;return n===0?s=o*2**-24:n!==31?s=(o+1024)*2**(n-25):s=o===0?1/0:NaN,r&32768?-s:s}function em(t){je.setFloat32(0,t,!1)}function Qc(t,e){if(t.length-e<4)throw new Error(`${I} not enough data for float32`);let r=(t.byteOffset||0)+e;return new DataView(t.buffer,r,4).getFloat32(0,!1)}function Y0(t){je.setFloat64(0,t,!1)}function tm(t,e){if(t.length-e<8)throw new Error(`${I} not enough data for float64`);let r=(t.byteOffset||0)+e;return new DataView(t.buffer,r,8).getFloat64(0,!1)}ei.compareTokens=Me.compareTokens;function W(t,e,r){throw new Error(`${I} encountered invalid minor (${r}) for major ${t[e]>>>5}`)}function ti(t){return()=>{throw new Error(`${I} ${t}`)}}var T=[];for(let t=0;t<=23;t++)T[t]=W;T[24]=up;T[25]=dp;T[26]=lp;T[27]=hp;T[28]=W;T[29]=W;T[30]=W;T[31]=W;for(let t=32;t<=55;t++)T[t]=W;T[56]=pp;T[57]=mp;T[58]=gp;T[59]=wp;T[60]=W;T[61]=W;T[62]=W;T[63]=W;for(let t=64;t<=87;t++)T[t]=xp;T[88]=bp;T[89]=kp;T[90]=vp;T[91]=Sp;T[92]=W;T[93]=W;T[94]=W;T[95]=ti("indefinite length bytes/strings are not supported");for(let t=96;t<=119;t++)T[t]=Ep;T[120]=Ap;T[121]=Tp;T[122]=Ip;T[123]=Dp;T[124]=W;T[125]=W;T[126]=W;T[127]=ti("indefinite length bytes/strings are not supported");for(let t=128;t<=151;t++)T[t]=_p;T[152]=Lp;T[153]=Cp;T[154]=Up;T[155]=Op;T[156]=W;T[157]=W;T[158]=W;T[159]=Pp;for(let t=160;t<=183;t++)T[t]=Rp;T[184]=Np;T[185]=$p;T[186]=zp;T[187]=Fp;T[188]=W;T[189]=W;T[190]=W;T[191]=Mp;for(let t=192;t<=215;t++)T[t]=jp;T[216]=Hp;T[217]=Vp;T[218]=qp;T[219]=Wp;T[220]=W;T[221]=W;T[222]=W;T[223]=W;for(let t=224;t<=243;t++)T[t]=ti("simple values are not supported");T[244]=W;T[245]=W;T[246]=W;T[247]=Gp;T[248]=ti("simple values are not supported");T[249]=Jp;T[250]=Zp;T[251]=Qp;T[252]=W;T[253]=W;T[254]=W;T[255]=Kp;var Ye=[];for(let t=0;t<24;t++)Ye[t]=new b(p.uint,t,1);for(let t=-1;t>=-24;t--)Ye[31-t]=new b(p.negint,t,1);Ye[64]=new b(p.bytes,new Uint8Array(0),1);Ye[96]=new b(p.string,"",1);Ye[128]=new b(p.array,0,1);Ye[160]=new b(p.map,0,1);Ye[244]=new b(p.false,!1,1);Ye[245]=new b(p.true,!0,1);Ye[246]=new b(p.null,null,1);function ri(t){switch(t.type){case p.false:return ft([244]);case p.true:return ft([245]);case p.null:return ft([246]);case p.bytes:return t.value.length?void 0:ft([64]);case p.string:return t.value===""?ft([96]):void 0;case p.array:return t.value===0?ft([128]):void 0;case p.map:return t.value===0?ft([160]):void 0;case p.uint:return t.value<24?ft([Number(t.value)]):void 0;case p.negint:if(t.value>=-24)return ft([31-Number(t.value)])}}var e1={float64:!1,mapSorter:r1,quickEncodeToken:ri};function Xc(){let t=[];return t[p.uint.major]=Me,t[p.negint.major]=Js,t[p.bytes.major]=tn,t[p.string.major]=Bp,t[p.array.major]=Qs,t[p.map.major]=Ys,t[p.tag.major]=Xs,t[p.float.major]=ei,t}var rm=Xc(),Yc=new Xn,ni=class t{constructor(e,r){this.obj=e,this.parent=r}includes(e){let r=this;do if(r.obj===e)return!0;while(r=r.parent);return!1}static createCheck(e,r){if(e&&e.includes(r))throw new Error(`${vt} object contains circular references`);return new t(r,e)}},qt={null:new b(p.null,null),undefined:new b(p.undefined,void 0),true:new b(p.true,!0),false:new b(p.false,!1),emptyArray:new b(p.array,0),emptyMap:new b(p.map,0)},Wt={number(t,e,r,n){return!Number.isInteger(t)||!Number.isSafeInteger(t)?new b(p.float,t):t>=0?new b(p.uint,t):new b(p.negint,t)},bigint(t,e,r,n){return t>=BigInt(0)?new b(p.uint,t):new b(p.negint,t)},Uint8Array(t,e,r,n){return new b(p.bytes,t)},string(t,e,r,n){return new b(p.string,t)},boolean(t,e,r,n){return t?qt.true:qt.false},null(t,e,r,n){return qt.null},undefined(t,e,r,n){return qt.undefined},ArrayBuffer(t,e,r,n){return new b(p.bytes,new Uint8Array(t))},DataView(t,e,r,n){return new b(p.bytes,new Uint8Array(t.buffer,t.byteOffset,t.byteLength))},Array(t,e,r,n){if(!t.length)return r.addBreakTokens===!0?[qt.emptyArray,new b(p.break)]:qt.emptyArray;n=ni.createCheck(n,t);let o=[],s=0;for(let i of t)o[s++]=no(i,r,n);return r.addBreakTokens?[new b(p.array,t.length),o,new b(p.break)]:[new b(p.array,t.length),o]},Object(t,e,r,n){let o=e!=="Object",s=o?t.keys():Object.keys(t),i=o?t.size:s.length;if(!i)return r.addBreakTokens===!0?[qt.emptyMap,new b(p.break)]:qt.emptyMap;n=ni.createCheck(n,t);let a=[],c=0;for(let u of s)a[c++]=[no(u,r,n),no(o?t.get(u):t[u],r,n)];return t1(a,r),r.addBreakTokens?[new b(p.map,i),a,new b(p.break)]:[new b(p.map,i),a]}};Wt.Map=Wt.Object;Wt.Buffer=Wt.Uint8Array;for(let t of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Wt[`${t}Array`]=Wt.DataView;function no(t,e={},r){let n=rp(t),o=e&&e.typeEncoders&&e.typeEncoders[n]||Wt[n];if(typeof o=="function"){let i=o(t,n,e,r);if(i!=null)return i}let s=Wt[n];if(!s)throw new Error(`${vt} unsupported type: ${n}`);return s(t,n,e,r)}function t1(t,e){e.mapSorter&&t.sort(e.mapSorter)}function r1(t,e){let r=Array.isArray(t[0])?t[0][0]:t[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(r.type!==n.type)return r.type.compare(n.type);let o=r.type.major,s=rm[o].compareTokens(r,n);return s===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function nm(t,e,r,n){if(Array.isArray(e))for(let o of e)nm(t,o,r,n);else r[e.type.major](t,e,n)}function ef(t,e,r){let n=no(t,r);if(!Array.isArray(n)&&r.quickEncodeToken){let o=r.quickEncodeToken(n);if(o)return o;let s=e[n.type.major];if(s.encodedSize){let i=s.encodedSize(n,r),a=new Xn(i);if(s(a,n,r),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return Yn(a.chunks[0])}}return Yc.reset(),nm(Yc,n,e,r),Yc.toBytes(!0)}function tf(t,e){return e=Object.assign({},e1,e),ef(t,rm,e)}var n1={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0},oi=class{constructor(e,r={}){this._pos=0,this.data=e,this.options=r}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){let e=this.data[this._pos],r=Ye[e];if(r===void 0){let n=T[e];if(!n)throw new Error(`${I} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);let o=e&31;r=n(this.data,this._pos,o,this.options)}return this._pos+=r.encodedLength,r}},oo=Symbol.for("DONE"),si=Symbol.for("BREAK");function o1(t,e,r){let n=[];for(let o=0;o<t.value;o++){let s=on(e,r);if(s===si){if(t.value===1/0)break;throw new Error(`${I} got unexpected break to lengthed array`)}if(s===oo)throw new Error(`${I} found array but not enough entries (got ${o}, expected ${t.value})`);n[o]=s}return n}function s1(t,e,r){let n=r.useMaps===!0,o=n?void 0:{},s=n?new Map:void 0;for(let i=0;i<t.value;i++){let a=on(e,r);if(a===si){if(t.value===1/0)break;throw new Error(`${I} got unexpected break to lengthed map`)}if(a===oo)throw new Error(`${I} found map but not enough entries (got ${i} [no key], expected ${t.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${I} non-string keys not supported (got ${typeof a})`);if(r.rejectDuplicateMapKeys===!0&&(n&&s.has(a)||!n&&a in o))throw new Error(`${I} found repeat map key "${a}"`);let c=on(e,r);if(c===oo)throw new Error(`${I} found map but not enough entries (got ${i} [no value], expected ${t.value})`);n?s.set(a,c):o[a]=c}return n?s:o}function on(t,e){if(t.done())return oo;let r=t.next();if(r.type===p.break)return si;if(r.type.terminal)return r.value;if(r.type===p.array)return o1(r,t,e);if(r.type===p.map)return s1(r,t,e);if(r.type===p.tag){if(e.tags&&typeof e.tags[r.value]=="function"){let n=on(t,e);return e.tags[r.value](n)}throw new Error(`${I} tag not supported (${r.value})`)}throw new Error("unsupported")}function rf(t,e){if(!(t instanceof Uint8Array))throw new Error(`${I} data to decode must be a Uint8Array`);e=Object.assign({},n1,e);let r=e.tokenizer||new oi(t,e),n=on(r,e);if(n===oo)throw new Error(`${I} did not find any content to decode`);if(n===si)throw new Error(`${I} got unexpected break`);return[n,t.subarray(r.pos())]}function so(t,e){let[r,n]=rf(t,e);if(n.length>0)throw new Error(`${I} too many terminals, data makes no sense`);return r}var cf={};C(cf,{base32:()=>an,base32hex:()=>m1,base32hexpad:()=>y1,base32hexpadupper:()=>w1,base32hexupper:()=>g1,base32pad:()=>h1,base32padupper:()=>p1,base32upper:()=>l1,base32z:()=>x1});function a1(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<t.length;o++){var s=t.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";for(var m=0,D=0,g=0,y=l.length;g!==y&&l[g]===0;)g++,m++;for(var S=(y-g)*d+1>>>0,v=new Uint8Array(S);g!==y;){for(var A=l[g],B=0,E=S-1;(A!==0||B<D)&&E!==-1;E--,B++)A+=256*v[E]>>>0,v[E]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");D=B,g++}for(var U=S-D;U!==S&&v[U]===0;)U++;for(var oe=c.repeat(m);U<S;++U)oe+=t.charAt(v[U]);return oe}function w(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;var m=0;if(l[m]!==" "){for(var D=0,g=0;l[m]===c;)D++,m++;for(var y=(l.length-m)*u+1>>>0,S=new Uint8Array(y);l[m];){var v=r[l.charCodeAt(m)];if(v===255)return;for(var A=0,B=y-1;(v!==0||A<g)&&B!==-1;B--,A++)v+=a*S[B]>>>0,S[B]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");g=A,m++}if(l[m]!==" "){for(var E=y-g;E!==y&&S[E]===0;)E++;for(var U=new Uint8Array(D+(y-E)),oe=D;E!==y;)U[oe++]=S[E++];return U}}}function f(l){var m=w(l);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:w,decode:f}}var c1=a1,f1=c1,om=f1;var nf=class{constructor(e,r,n){F(this,"name");F(this,"prefix");F(this,"baseEncode");this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},of=class{constructor(e,r,n){F(this,"name");F(this,"prefix");F(this,"baseDecode");F(this,"prefixCodePoint");this.name=e,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sm(this,e)}},sf=class{constructor(e){F(this,"decoders");this.decoders=e}or(e){return sm(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function sm(t,e){return new sf({...t.decoders??{[t.prefix]:t},...e.decoders??{[e.prefix]:e}})}var af=class{constructor(e,r,n,o){F(this,"name");F(this,"prefix");F(this,"baseEncode");F(this,"baseDecode");F(this,"encoder");F(this,"decoder");this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new nf(e,r,n),this.decoder=new of(e,r,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function sn({name:t,prefix:e,encode:r,decode:n}){return new af(t,e,r,n)}function Gt({name:t,prefix:e,alphabet:r}){let{encode:n,decode:o}=om(r,t);return sn({prefix:e,name:t,encode:n,decode:s=>ct(o(s))})}function u1(t,e,r,n){let o={};for(let d=0;d<e.length;++d)o[e[d]]=d;let s=t.length;for(;t[s-1]==="=";)--s;let i=new Uint8Array(s*r/8|0),a=0,c=0,u=0;for(let d=0;d<s;++d){let h=o[t[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,i[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return i}function d1(t,e,r){let n=e[e.length-1]==="=",o=(1<<r)-1,s="",i=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],i+=8;i>r;)i-=r,s+=e[o&a>>i];if(i!==0&&(s+=e[o&a<<r-i]),n)for(;s.length*r&7;)s+="=";return s}function re({name:t,prefix:e,bitsPerChar:r,alphabet:n}){return sn({prefix:e,name:t,encode(o){return d1(o,n,r)},decode(o){return u1(o,n,r,t)}})}var an=re({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),l1=re({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),h1=re({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),p1=re({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),m1=re({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),g1=re({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),y1=re({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),w1=re({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),x1=re({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var ff={};C(ff,{base36:()=>io,base36upper:()=>b1});var io=Gt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),b1=Gt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var uf={};C(uf,{base58btc:()=>He,base58flickr:()=>k1});var He=Gt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),k1=Gt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var K={};C(K,{decode:()=>cn,encodeTo:()=>Sr,encodingLength:()=>Er});var v1=cm,im=128,S1=127,E1=~S1,A1=Math.pow(2,31);function cm(t,e,r){e=e||[],r=r||0;for(var n=r;t>=A1;)e[r++]=t&255|im,t/=128;for(;t&E1;)e[r++]=t&255|im,t>>>=7;return e[r]=t|0,cm.bytes=r-n+1,e}var T1=df,I1=128,am=127;function df(t,n){var r=0,n=n||0,o=0,s=n,i,a=t.length;do{if(s>=a)throw df.bytes=0,new RangeError("Could not decode varint");i=t[s++],r+=o<28?(i&am)<<o:(i&am)*Math.pow(2,o),o+=7}while(i>=I1);return df.bytes=s-n,r}var D1=Math.pow(2,7),B1=Math.pow(2,14),_1=Math.pow(2,21),L1=Math.pow(2,28),C1=Math.pow(2,35),U1=Math.pow(2,42),O1=Math.pow(2,49),P1=Math.pow(2,56),R1=Math.pow(2,63),N1=function(t){return t<D1?1:t<B1?2:t<_1?3:t<L1?4:t<C1?5:t<U1?6:t<O1?7:t<P1?8:t<R1?9:10},$1={encode:v1,decode:T1,encodingLength:N1},z1=$1,ao=z1;function cn(t,e=0){return[ao.decode(t,e),ao.decode.bytes]}function Sr(t,e,r=0){return ao.encode(t,e,r),e}function Er(t){return ao.encodingLength(t)}function Ar(t,e){let r=e.byteLength,n=Er(t),o=n+Er(r),s=new Uint8Array(o+r);return Sr(t,s,0),Sr(r,s,n),s.set(e,o),new fn(t,r,e,s)}function Ve(t){let e=ct(t),[r,n]=cn(e),[o,s]=cn(e.subarray(n)),i=e.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new fn(r,o,i,e)}function fm(t,e){if(t===e)return!0;{let r=e;return t.code===r.code&&t.size===r.size&&r.bytes instanceof Uint8Array&&Vs(t.bytes,r.bytes)}}var fn=class{constructor(e,r,n,o){F(this,"code");F(this,"size");F(this,"digest");F(this,"bytes");this.code=e,this.size=r,this.digest=n,this.bytes=o}};function lf(t,e){let{bytes:r,version:n}=t;switch(n){case 0:return M1(r,hf(t),e??He.encoder);default:return j1(r,hf(t),e??an.encoder)}}var um=new WeakMap;function hf(t){let e=um.get(t);if(e==null){let r=new Map;return um.set(t,r),r}return e}var lm,G=class t{constructor(e,r,n,o){F(this,"code");F(this,"version");F(this,"multihash");F(this,"bytes");F(this,"/");F(this,lm,"CID");this.code=r,this.version=e,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:r}=this;if(e!==co)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==H1)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return t.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,n=Ar(e,r);return t.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return t.equals(this,e)}static equals(e,r){let n=r;return n!=null&&e.code===n.code&&e.version===n.version&&fm(e.multihash,n.multihash)}toString(e){return lf(this,e)}toJSON(){return{"/":lf(this)}}link(){return this}[(lm=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let r=e;if(r instanceof t)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new t(n,o,s,i??dm(n,o,s.bytes))}else if(r[V1]===!0){let{version:n,multihash:o,code:s}=r,i=Ve(o);return t.create(n,s,i)}else return null}static create(e,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(r!==co)throw new Error(`Version 0 CID must use dag-pb (code: ${co}) block encoding`);return new t(e,r,n,n.bytes)}case 1:{let o=dm(e,r,n.bytes);return new t(e,r,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return t.create(0,co,e)}static createV1(e,r){return t.create(1,e,r)}static decode(e){let[r,n]=t.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=t.inspectBytes(e),n=r.size-r.multihashSize,o=ct(e.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new fn(r.multihashCode,r.digestSize,s,o);return[r.version===0?t.createV0(i):t.createV1(r.codec,i),e.subarray(r.size)]}static inspectBytes(e){let r=0,n=()=>{let[h,w]=cn(e.subarray(r));return r+=w,h},o=n(),s=co;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,a=n(),c=n(),u=r+c,d=u-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:u}}static parse(e,r){let[n,o]=F1(e,r),s=t.decode(o);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return hf(s).set(n,e),s}};function F1(t,e){switch(t[0]){case"Q":{let r=e??He;return[He.prefix,r.decode(`${He.prefix}${t}`)]}case He.prefix:{let r=e??He;return[He.prefix,r.decode(t)]}case an.prefix:{let r=e??an;return[an.prefix,r.decode(t)]}case io.prefix:{let r=e??io;return[io.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}}function M1(t,e,r){let{prefix:n}=r;if(n!==He.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=e.get(n);if(o==null){let s=r.encode(t).slice(1);return e.set(n,s),s}else return o}function j1(t,e,r){let{prefix:n}=r,o=e.get(n);if(o==null){let s=r.encode(t);return e.set(n,s),s}else return o}var co=112,H1=18;function dm(t,e,r){let n=Er(t),o=n+Er(e),s=new Uint8Array(o+r.byteLength);return Sr(t,s,0),Sr(e,s,n),s.set(r,o),s}var V1=Symbol.for("@ipld/js-cid/CID");var hm=42;function q1(t){return t instanceof ArrayBuffer?new Uint8Array(t,0,t.byteLength):t}function W1(t){if(t.asCID!==t&&t["/"]!==t.bytes)return null;let e=G.asCID(t);if(!e)return null;let r=new Uint8Array(e.bytes.byteLength+1);return r.set(e.bytes,1),[new b(p.tag,hm),new b(p.bytes,r)]}function G1(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function K1(t){if(Number.isNaN(t))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(t===1/0||t===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var pf={float64:!0,typeEncoders:{Object:W1,undefined:G1,number:K1}},bB={...pf,typeEncoders:{...pf.typeEncoders}};function J1(t){if(t[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return G.decode(t.subarray(1))}var ii={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};ii.tags[hm]=J1;var kB={...ii,tags:ii.tags.slice()},mf="dag-cbor",ut=113,be=t=>tf(t,pf),ke=t=>so(q1(t),ii);var Q1=112;function pm(t){return G.create(0,Q1,t)}function dn(t,e){return G.create(1,t,e)}function Y1(t,e={}){let r=e.hasher||Vt,{digest:n}=r.digest(t);return X1(n)}var ln=(t,e,r)=>{let n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),Y1(n,r)};function X1(t){return t[ce-1]&=63,t}var gf=64,yf=class{constructor(){this.bytes=new Uint8Array(gf*ce),this.bytes.set(jc(),0),this.node=jc(),this.length=ce}slice(e,r){for(;this.length<r;)this.node=ln(this.node,this.node),this.bytes.set(this.node,this.length),this.length+=ce;return this.bytes.subarray(e,r)}},ek=new yf,ym=t=>{if(t<0||t>=gf)throw new Error(`Only levels between 0 and ${gf-1} inclusive are available`);return ek.slice(ce*t,ce*(t+1))};var RB=2**32-1;var ai=t=>{let e=t.length/ce,r=new Array(e);for(let n=0;n<e;n++){let o=n*ce,s=t.subarray(o,o+ce);r[n]=s}return r};function wm(t){let e=Math.max(t,Yh),r=Math.floor(Math.log2(e)),n=Math.ceil(Hs*2**(r+1));return e<=n?n:Math.ceil(Hs*2**(r+2))}var rk=t=>wm(t)/Hs;var ci=(t,e=new Uint8Array(rk(t.length)))=>{let n=wm(t.byteLength)/kt;for(let o=0;o<n;o++){let s=o*kt,i=o*Qn;e.set(t.subarray(s,s+32),i),e[i+31]&=63;for(let a=32;a<64;a++)e[i+a]=t[s+a]<<2|t[s+a-1]>>6;e[i+63]&=63;for(let a=64;a<96;a++)e[i+a]=t[s+a]<<4|t[s+a-1]>>4;e[i+95]&=63;for(let a=96;a<127;a++)e[i+a]=t[s+a]<<6|t[s+a-1]>>2;e[i+127]=t[s+126]>>2}return e};var nk=t=>{let e=0n;for(;t>>=1n;)e++;return Number(e)},fo=t=>t<=1n?0:nk(BigInt(t)-1n)+1;var xm=t=>2n**BigInt(t-2)*Yr;var fi={};C(fi,{fromPiece:()=>ok,toExpanded:()=>vm,toHeight:()=>ik,toPadded:()=>km,toPadding:()=>sk,toWidth:()=>Sm});var ok=({height:t,padding:e})=>xm(t)-e,sk=t=>km(t)-t,km=t=>wf(t)*Yr,vm=t=>wf(t)*js,Sm=t=>wf(t)*Mc,ik=t=>fo(Sm(t)),wf=t=>{let e=(t+Yr-1n)/Yr;return 2n**BigInt(fo(e))};var ui=t=>ak(2n**BigInt(t));var ak=t=>t*Qh;var Sf={};C(Sf,{HEIGHT_SIZE:()=>Zt,MAX_DIGEST_SIZE:()=>bf,MAX_HEIGHT:()=>Tm,MAX_PAYLOAD_SIZE:()=>uk,MAX_SIZE:()=>kf,ROOT_SIZE:()=>li,TAG_SIZE:()=>Et,code:()=>Jt,fromBytes:()=>vf,fromPiece:()=>dk,height:()=>Im,name:()=>Am,padding:()=>Dm,root:()=>Bm,toBytes:()=>lk});function Tr({name:t,code:e,encode:r}){return new xf(t,e,r)}var xf=class{constructor(e,r,n){F(this,"name");F(this,"code");F(this,"encode");this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?Ar(this.code,r):r.then(n=>Ar(this.code,n))}else throw Error("Unknown type, must be binary type")}};var Am="fr32-sha2-256-trunc254-padded-binary-tree",Jt=4113,fk=9,Zt=1,li=Vt.size,bf=fk+Zt+Vt.size,Et=K.encodingLength(Jt),kf=Et+K.encodingLength(bf)+bf,Tm=255,uk=ui(Tm)*BigInt(Zr)/BigInt(Qr),dk=({padding:t,height:e,root:r})=>{let n=K.encodingLength(Number(t)),o=n+Zt+li,s=K.encodingLength(o),i=Et+s+o,a=0,c=new Uint8Array(i);return K.encodeTo(Jt,c,a),a+=Et,K.encodeTo(o,c,a),a+=s,K.encodeTo(Number(t),c,a),a+=n,c[a]=e,a+=Zt,c.set(r,a),new di(c)},vf=t=>new di(t),lk=({digest:t})=>{let r=K.encodingLength(t.length)+Et;if(t.byteOffset>=r){let o=new Uint8Array(t.buffer,t.byteOffset-r,t.byteOffset+t.length),[s,i]=K.decode(o);if(s===Jt&&K.decode(o,i)[0]===t.length)return o}let n=new Uint8Array(t.length+r);return K.encodeTo(Jt,n),K.encodeTo(t.length,n,Et),n.set(t,r),n},Im=({digest:t})=>{let[,e]=K.decode(t);return t[e]},Dm=({digest:t})=>{let[e]=K.decode(t);return BigInt(e)},Bm=({digest:t})=>{let[,e]=K.decode(t);return t.subarray(e+Zt,e+Zt+Vt.size)},di=class{constructor(e){this.bytes=e;let[r]=K.decode(e);if(r!==Jt)throw new RangeError(`Expected multihash with code ${Jt}`);let n=Et,[o,s]=K.decode(e,n);n+=s;let i=e.subarray(n);if(i.length!==o)throw new RangeError(`Invalid multihash size expected ${n+o} bytes, got ${e.length} bytes`);this.digest=i}get name(){return Am}get code(){return Jt}get size(){return this.digest.length}get padding(){return Dm(this)}get height(){return Im(this)}get root(){return Bm(this)}};var _m="fr32-sha2-256-trunc254-padded-binary-tree",Ef=4113,Lm=255,Af=ui(Lm)*BigInt(Zr)/BigInt(Qr),hk=t=>{let e=new hi;return e.write(t),e.digest()},pk=()=>new hi,hi=class{constructor(){this.bytesWritten=0n,this.buffer=new Uint8Array(kt),this.offset=0,this.layers=[[]]}count(){return this.bytesWritten}digest(){let e=new Uint8Array(kf),r=this.digestInto(e,0,!0);return vf(e.subarray(0,r))}digestInto(e,r=0,n=!0){let{buffer:o,layers:s,offset:i,bytesWritten:a}=this,[c,...u]=s;(i>0||a===0n)&&(c=[...c,...ai(ci(o.fill(0,i)))]);let d=gk([c,...u]),h=d.length-1,[w]=d[h],f=Number(fi.toPadding(this.bytesWritten)),l=K.encodingLength(f),m=r;if(n){K.encodeTo(Ef,e,m),m+=Et;let D=l+Zt+li,g=K.encodingLength(D);K.encodeTo(D,e,m),m+=g}return K.encodeTo(f,e,m),m+=l,e[m]=h,m+=1,e.set(w,m),m+=w.length,m-r}write(e){let{buffer:r,offset:n,layers:o}=this,s=o[0],{length:i}=e;if(i===0)return this;if(this.bytesWritten+BigInt(i)>Af)throw new RangeError(`Writing ${i} bytes exceeds max payload size of ${Af}`);if(n+i<r.length)return r.set(e,n),this.offset+=i,this.bytesWritten+=BigInt(i),this;{let a=r.length-n;r.set(e.subarray(0,a),n),s.push(...ai(ci(r)));let c=a;for(;c+kt<i;){let u=e.subarray(c,c+kt);s.push(...ai(ci(u))),c+=kt}return this.buffer.set(e.subarray(c),0),this.offset=i-c,this.bytesWritten+=BigInt(i),mk(this.layers),this}}reset(){return this.offset=0,this.bytesWritten=0n,this.layers.length=1,this.layers[0].length=0,this}dispose(){this.reset()}get code(){return Ef}get name(){return _m}},mk=t=>Cm(t,!1),gk=t=>Cm([...t],!0),Cm=(t,e)=>{let r=0;for(;r<t.length;){let n=t[r+1],o=t[r];e&&o.length%2>0&&n&&o.push(ym(r)),r+=1,n=n?e?[...n]:n:[];let s=0;for(;s+1<o.length;){let i=ln(o[s],o[s+1]);delete o[s],delete o[s+1],n.push(i),s+=2}n.length&&(t[r]=n),o.splice(0,s)}return t};var na={};C(na,{connection:()=>No,filecoinAccept:()=>J2,filecoinInfo:()=>Z2,filecoinOffer:()=>G2,filecoinSubmit:()=>K2});var Pr={};C(Pr,{ArchiveSchema:()=>Wg,Delegation:()=>rr,View:()=>rr,allows:()=>XS,archive:()=>qg,create:()=>id,delegate:()=>Or,exportDAG:()=>sd,extract:()=>t2,importDAG:()=>r2,isDelegation:()=>Ct,isLink:()=>YS,view:()=>qi});var yk=new TextEncoder,wk=new TextDecoder,dt=t=>yk.encode(t),Qt=t=>wk.decode(t);var $={};C($,{decode:()=>hn,encodeTo:()=>Ir,encodingLength:()=>Dr});var xk=Pm,Um=128,bk=127,kk=~bk,vk=Math.pow(2,31);function Pm(t,e,r){e=e||[],r=r||0;for(var n=r;t>=vk;)e[r++]=t&255|Um,t/=128;for(;t&kk;)e[r++]=t&255|Um,t>>>=7;return e[r]=t|0,Pm.bytes=r-n+1,e}var Sk=If,Ek=128,Om=127;function If(t,n){var r=0,n=n||0,o=0,s=n,i,a=t.length;do{if(s>=a)throw If.bytes=0,new RangeError("Could not decode varint");i=t[s++],r+=o<28?(i&Om)<<o:(i&Om)*Math.pow(2,o),o+=7}while(i>=Ek);return If.bytes=s-n,r}var Ak=Math.pow(2,7),Tk=Math.pow(2,14),Ik=Math.pow(2,21),Dk=Math.pow(2,28),Bk=Math.pow(2,35),_k=Math.pow(2,42),Lk=Math.pow(2,49),Ck=Math.pow(2,56),Uk=Math.pow(2,63),Ok=function(t){return t<Ak?1:t<Tk?2:t<Ik?3:t<Dk?4:t<Bk?5:t<_k?6:t<Lk?7:t<Ck?8:t<Uk?9:10},Pk={encode:xk,decode:Sk,encodingLength:Ok},Rk=Pk,lo=Rk;var hn=(t,e=0)=>[lo.decode(t,e),lo.decode.bytes],Ir=(t,e,r=0)=>(lo.encode(t,e,r),e),Dr=t=>lo.encodingLength(t);var O_=new Uint8Array(0);var Rm=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0},At=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};var Br=(t,e)=>{let r=e.byteLength,n=Dr(t),o=n+Dr(r),s=new Uint8Array(o+r);return Ir(t,s,0),Ir(r,s,n),s.set(e,o),new pn(t,r,e,s)},$m=t=>{let e=At(t),[r,n]=hn(e),[o,s]=hn(e.subarray(n)),i=e.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new pn(r,o,i,e)},zm=(t,e)=>{if(t===e)return!0;{let r=e;return t.code===r.code&&t.size===r.size&&r.bytes instanceof Uint8Array&&Rm(t.bytes,r.bytes)}},pn=class{constructor(e,r,n,o){this.code=e,this.size=r,this.digest=n,this.bytes=o}};function Nk(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<t.length;o++){var s=t.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";for(var m=0,D=0,g=0,y=l.length;g!==y&&l[g]===0;)g++,m++;for(var S=(y-g)*d+1>>>0,v=new Uint8Array(S);g!==y;){for(var A=l[g],B=0,E=S-1;(A!==0||B<D)&&E!==-1;E--,B++)A+=256*v[E]>>>0,v[E]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");D=B,g++}for(var U=S-D;U!==S&&v[U]===0;)U++;for(var oe=c.repeat(m);U<S;++U)oe+=t.charAt(v[U]);return oe}function w(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;var m=0;if(l[m]!==" "){for(var D=0,g=0;l[m]===c;)D++,m++;for(var y=(l.length-m)*u+1>>>0,S=new Uint8Array(y);l[m];){var v=r[l.charCodeAt(m)];if(v===255)return;for(var A=0,B=y-1;(v!==0||A<g)&&B!==-1;B--,A++)v+=a*S[B]>>>0,S[B]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");g=A,m++}if(l[m]!==" "){for(var E=y-g;E!==y&&S[E]===0;)E++;for(var U=new Uint8Array(D+(y-E)),oe=D;E!==y;)U[oe++]=S[E++];return U}}}function f(l){var m=w(l);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:w,decode:f}}var $k=Nk,zk=$k,Fm=zk;var Df=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Bf=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Mm(this,e)}},_f=class{constructor(e){this.decoders=e}or(e){return Mm(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Mm=(t,e)=>new _f({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}}),Lf=class{constructor(e,r,n,o){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Df(e,r,n),this.decoder=new Bf(e,r,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},jm=({name:t,prefix:e,encode:r,decode:n})=>new Lf(t,e,r,n),Cf=({prefix:t,name:e,alphabet:r})=>{let{encode:n,decode:o}=Fm(r,e);return jm({prefix:t,name:e,encode:n,decode:s=>At(o(s))})},Fk=(t,e,r,n)=>{let o={};for(let d=0;d<e.length;++d)o[e[d]]=d;let s=t.length;for(;t[s-1]==="=";)--s;let i=new Uint8Array(s*r/8|0),a=0,c=0,u=0;for(let d=0;d<s;++d){let h=o[t[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,i[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return i},Mk=(t,e,r)=>{let n=e[e.length-1]==="=",o=(1<<r)-1,s="",i=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],i+=8;i>r;)i-=r,s+=e[o&a>>i];if(i&&(s+=e[o&a<<r-i]),n)for(;s.length*r&7;)s+="=";return s},Te=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>jm({prefix:e,name:t,encode(o){return Mk(o,n,r)},decode(o){return Fk(o,n,r,t)}});var le=Cf({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),M_=Cf({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var qe=Te({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),V_=Te({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),q_=Te({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),W_=Te({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),G_=Te({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),K_=Te({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),J_=Te({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Z_=Te({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Q_=Te({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Uf=(t,e)=>{let{bytes:r,version:n}=t;switch(n){case 0:return Hk(r,Of(t),e||le.encoder);default:return Vk(r,Of(t),e||qe.encoder)}};var Hm=new WeakMap,Of=t=>{let e=Hm.get(t);if(e==null){let r=new Map;return Hm.set(t,r),r}return e},ve=class t{constructor(e,r,n,o){this.code=r,this.version=e,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:r}=this;if(e!==ho)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==qk)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return t.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,n=Br(e,r);return t.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return t.equals(this,e)}static equals(e,r){let n=r;return n&&e.code===n.code&&e.version===n.version&&zm(e.multihash,n.multihash)}toString(e){return Uf(this,e)}toJSON(){return{"/":Uf(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let r=e;if(r instanceof t)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new t(n,o,s,i||Vm(n,o,s.bytes))}else if(r[Wk]===!0){let{version:n,multihash:o,code:s}=r,i=$m(o);return t.create(n,s,i)}else return null}static create(e,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(r!==ho)throw new Error(`Version 0 CID must use dag-pb (code: ${ho}) block encoding`);return new t(e,r,n,n.bytes)}case 1:{let o=Vm(e,r,n.bytes);return new t(e,r,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return t.create(0,ho,e)}static createV1(e,r){return t.create(1,e,r)}static decode(e){let[r,n]=t.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=t.inspectBytes(e),n=r.size-r.multihashSize,o=At(e.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new pn(r.multihashCode,r.digestSize,s,o);return[r.version===0?t.createV0(i):t.createV1(r.codec,i),e.subarray(r.size)]}static inspectBytes(e){let r=0,n=()=>{let[h,w]=hn(e.subarray(r));return r+=w,h},o=n(),s=ho;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,a=n(),c=n(),u=r+c,d=u-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:u}}static parse(e,r){let[n,o]=jk(e,r),s=t.decode(o);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Of(s).set(n,e),s}},jk=(t,e)=>{switch(t[0]){case"Q":{let r=e||le;return[le.prefix,r.decode(`${le.prefix}${t}`)]}case le.prefix:{let r=e||le;return[le.prefix,r.decode(t)]}case qe.prefix:{let r=e||qe;return[qe.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}},Hk=(t,e,r)=>{let{prefix:n}=r;if(n!==le.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=e.get(n);if(o==null){let s=r.encode(t).slice(1);return e.set(n,s),s}else return o},Vk=(t,e,r)=>{let{prefix:n}=r,o=e.get(n);if(o==null){let s=r.encode(t);return e.set(n,s),s}else return o},ho=112,qk=18,Vm=(t,e,r)=>{let n=Dr(t),o=n+Dr(e),s=new Uint8Array(o+r.byteLength);return Ir(t,s,0),Ir(e,s,n),s.set(r,o),s},Wk=Symbol.for("@ipld/js-cid/CID");var Gk=112;var Pf=t=>ve.create(0,Gk,t),Re=(t,e)=>ve.create(1,t,e),Se=t=>{if(t==null)return!1;let e=t;return e["/"]!=null&&e["/"]===e.bytes||t.asCID===t},po=(t,e)=>ve.parse(t,e);var qm=0,Jk="identity",Wm=At,Zk=t=>Br(qm,Wm(t)),mi={code:qm,name:Jk,encode:Wm,digest:Zk};var Nf=({name:t,code:e,encode:r})=>new Rf(t,e,r),Rf=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?Br(this.code,r):r.then(n=>Br(this.code,n))}else throw Error("Unknown type, must be binary type")}};var Gm="did:",Yk=Gm.length,Km="did:key:",Xk=Km.length,ev=237,tv=4613,rv=4608,nv=4609,ov=4610,sv=231,iv=234,av=235,Ff=3357,$f=$.encodingLength(Ff),se=t=>{if(t.startsWith(Gm))if(t.startsWith(Km)){let e=le.decode(t.slice(Xk));return gi(e)}else{let e=dt(t.slice(Yk)),r=new Uint8Array(e.byteLength+$f);return $.encodeTo(Ff,r),r.set(e,$f),new mn(r)}else throw new RangeError(`Invalid DID "${t}", must start with 'did:'`)},gn=t=>t.did(),Mf=t=>t instanceof mn?t:t instanceof Uint8Array?gi(t):se(typeof t=="string"?t:t.did()),gi=t=>{let[e]=$.decode(t),{buffer:r,byteOffset:n,byteLength:o}=t;switch(e){case rv:if(t.length>35)throw new RangeError("Only p256-pub compressed is supported.");case ev:case tv:case nv:case ov:case iv:case av:case sv:return new zf(r,n,o);case Ff:return new mn(r,n,o);default:throw new RangeError(`Unsupported DID encoding, unknown multicode 0x${e.toString(16)}.`)}},Jm=t=>se(t.did()),mn=class extends Uint8Array{did(){let e=new Uint8Array(this.buffer,this.byteOffset+$f);return`did:${Qt(e)}`}toJSON(){return this.did()}},zf=class extends mn{did(){return`did:key:${le.encode(this)}`}};var yn=85;var Xe={};C(Xe,{BLS12381G1:()=>qf,BLS12381G2:()=>Wf,EIP191:()=>Zf,ES256:()=>Gf,ES256K:()=>Vf,ES384:()=>Kf,ES512:()=>Jf,EdDSA:()=>_r,NON_STANDARD:()=>xn,RS256:()=>mo,Signature:()=>wn,create:()=>bn,createNamed:()=>Qf,createNonStandard:()=>Yf,decode:()=>kn,encode:()=>Xf,format:()=>dv,fromJSON:()=>hv,nameCode:()=>Qm,parse:()=>lv,toJSON:()=>Ym,view:()=>yi});var jf=Te({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Hf=Te({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ne=Te({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),y6=Te({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var xn=53248,Vf=53479,qf=53482,Wf=53483,_r=53485,Gf=13636096,Kf=13636097,Jf=13636098,mo=13636101,Zf=53649,Zm=t=>{switch(t){case Vf:return"ES256K";case qf:return"BLS12381G1";case Wf:return"BLS12381G2";case _r:return"EdDSA";case Gf:return"ES256";case Kf:return"ES384";case Jf:return"ES512";case mo:return"RS256";case Zf:return"EIP191";default:throw new RangeError(`Unknown signature algorithm code 0x${t.toString(16)}`)}},Qm=t=>{switch(t){case"ES256K":return Vf;case"BLS12381G1":return qf;case"BLS12381G2":return Wf;case"EdDSA":return _r;case"ES256":return Gf;case"ES384":return Kf;case"ES512":return Jf;case"RS256":return mo;case"EIP191":return Zf;default:return xn}},wn=class extends Uint8Array{get code(){let[e]=$.decode(this);return Object.defineProperties(this,{code:{value:e}}),e}get size(){let e=uv(this);return Object.defineProperties(this,{size:{value:e}}),e}get algorithm(){let e=fv(this);return Object.defineProperties(this,{algorithm:{value:e}}),e}get raw(){let{buffer:e,byteOffset:r,size:n,code:o}=this,s=$.encodingLength(o),i=$.encodingLength(n),a=new Uint8Array(e,r+s+i,n);return Object.defineProperties(this,{raw:{value:a}}),a}async verify(e,r){try{if(await e.verify(r,this)===!0)return{ok:{}};throw new Error("Invalid signature")}catch(n){return{error:n}}}toJSON(){return Ym(this)}},fv=t=>{let{code:e,raw:r,buffer:n,byteOffset:o}=t;if(e===xn){let s=r.byteLength+$.encodingLength(e)+$.encodingLength(r.byteLength),i=new Uint8Array(n,o+s);return Qt(i)}else return Zm(e)},uv=t=>{let e=$.encodingLength(t.code),[r]=$.decode(new Uint8Array(t.buffer,t.byteOffset+e));return r},bn=(t,e)=>{let r=Zm(t),n=$.encodingLength(t),o=$.encodingLength(e.byteLength),s=new wn(n+o+e.byteLength);return $.encodeTo(t,s),$.encodeTo(e.byteLength,s,n),s.set(e,n+o),Object.defineProperties(s,{code:{value:t},size:{value:e.byteLength}}),s},Qf=(t,e)=>{let r=Qm(t);return r===xn?Yf(t,e):bn(r,e)},Yf=(t,e)=>{let r=xn,n=$.encodingLength(r),o=$.encodingLength(e.byteLength),s=dt(t),i=new wn(n+o+e.byteLength+s.byteLength);return $.encodeTo(r,i),$.encodeTo(e.byteLength,i,n),i.set(e,n+o),i.set(s,n+o+e.byteLength),i},yi=t=>new wn(t.buffer,t.byteOffset,t.byteLength),kn=t=>{if(!(t instanceof Uint8Array))throw new TypeError(`Can only decode Uint8Array into a Signature, instead got ${JSON.stringify(t)}`);let e=yi(t),{code:r,algorithm:n,raw:o}=e;return e},Xf=t=>kn(t),dv=(t,e)=>(e||Ne).encode(t),lv=(t,e)=>kn((e||Ne).decode(t)),Ym=t=>({"/":{bytes:jf.baseEncode(t)}}),hv=t=>kn(jf.baseDecode(t["/"].bytes));var go=t=>ng(t,{readPrincipal:Ev,readProof:kv}),rg=t=>ng(t,{readPrincipal:Av,readProof:vv}),ng=(t,{readPrincipal:e,readProof:r})=>({iss:e(t.iss,"iss"),aud:e(t.aud,"aud"),att:mv(t.att,"att"),prf:eg(t.prf,r,"prf")||[],exp:Tv(t.exp===1/0?null:t.exp,Xm,"exp"),nbf:tg(t.nbf,Xm,"nbf"),fct:eg(t.fct,bv,"fct")||[],nnc:tg(t.nnc,yo,"nnc")}),og=t=>{if(t instanceof Uint8Array)return kn(t);throw new TypeError(`Can only decode Uint8Array into a Signature, instead got ${JSON.stringify(t)}`)},Xm=(t,e)=>Number.isInteger(t)?t:We.throw(`Expected ${e} to be integer, instead got ${JSON.stringify(t)}`),pv=(t,e)=>ig(t,gv,e),mv=(t,e)=>sg(t,pv,e),gv=t=>({...t,can:yv(t.can),with:wv(t.with)}),yv=t=>typeof t!="string"?We.throw(`Capability has invalid 'can: ${JSON.stringify(t)}', value must be a string`):t.slice(1,-1).includes("/")?t.toLocaleLowerCase():t==="*"?t:We.throw(`Capability has invalid 'can: "${t}"', value must have at least one path segment`),wv=t=>typeof t!="string"?We.throw(`Capability has invalid 'with: ${JSON.stringify(t)}', value must be a string`):xv(t)||We.throw(`Capability has invalid 'with: "${t}"', value must be a valid URI string`),xv=t=>{try{return new URL(t),t}catch{return null}},sg=(t,e,r)=>Array.isArray(t)?t.map((n,o)=>e(n,`${r}[${o}]`)):We.throw(`${r} must be an array`),eg=(t,e,r)=>t===void 0?t:sg(t,e,r),ig=(t,e,r)=>t!=null&&typeof t=="object"?e(t):We.throw(`${r} must be of type object, instead got ${t}`),bv=(t,e)=>ig(t,Object,e),kv=(t,e)=>Se(t)?t:xo(`Expected ${e} to be IPLD link, instead got ${JSON.stringify(t)}`),vv=(t,e)=>Sv(yo(t,e)),Sv=t=>{try{return po(t)}catch{return Re(yn,mi.digest(dt(t)))}},Ev=(t,e)=>gi(Iv(t,e)),Av=(t,e)=>se(yo(t,e)),tg=(t,e,r="Field")=>t!==void 0?e(t,r):void 0,Tv=(t,e,r)=>t===null?null:e(t,r),yo=(t,e="Field")=>typeof t=="string"?t:xo(`${e} has invalid value ${t}`),Iv=(t,e)=>t instanceof Uint8Array?t:xo(`Expected ${e} to be Uint8Array, instead got ${JSON.stringify(t)}`),wo=(t,e)=>/\d+\.\d+\.\d+/.test(t)?t:We.throw(`Invalid version '${e}: ${JSON.stringify(t)}'`),ag=(t,e,r)=>t===e?e:We.throw(`Expected ${r} to be a ${JSON.stringify(e)} instead got ${JSON.stringify(t)}`),We=class extends TypeError{get name(){return"ParseError"}static throw(e){throw new this(e)}},xo=t=>We.throw(t);var eu=class extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){let r=this.inRecursive[this.inRecursive.length-1];r&&(r.type===p.array&&(r.elements++,r.elements!==1&&e.push([44])),r.type===p.map&&(r.elements++,r.elements!==1&&(r.elements%2===1?e.push([44]):e.push([58]))))}[p.uint.major](e,r){this.prefix(e);let n=String(r.value),o=[];for(let s=0;s<n.length;s++)o[s]=n.charCodeAt(s);e.push(o)}[p.negint.major](e,r){this[p.uint.major](e,r)}[p.bytes.major](e,r){throw new Error(`${vt} unsupported type: Uint8Array`)}[p.string.major](e,r){this.prefix(e);let n=Ks(JSON.stringify(r.value));e.push(n.length>32?Yn(n):n)}[p.array.major](e,r){this.prefix(e),this.inRecursive.push({type:p.array,elements:0}),e.push([91])}[p.map.major](e,r){this.prefix(e),this.inRecursive.push({type:p.map,elements:0}),e.push([123])}[p.tag.major](e,r){}[p.float.major](e,r){if(r.type.name==="break"){let i=this.inRecursive.pop();if(i){if(i.type===p.array)e.push([93]);else if(i.type===p.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(r.value===void 0)throw new Error(`${vt} unsupported type: undefined`);if(this.prefix(e),r.type.name==="true"){e.push([116,114,117,101]);return}else if(r.type.name==="false"){e.push([102,97,108,115,101]);return}else if(r.type.name==="null"){e.push([110,117,108,108]);return}let n=String(r.value),o=[],s=!1;for(let i=0;i<n.length;i++)o[i]=n.charCodeAt(i),!s&&(o[i]===46||o[i]===101||o[i]===69)&&(s=!0);s||(o.push(46),o.push(48)),e.push(o)}};function Bv(t,e){if(Array.isArray(t[0])||Array.isArray(e[0]))throw new Error(`${vt} complex map keys are not supported`);let r=t[0],n=e[0];if(r.type!==p.string||n.type!==p.string)throw new Error(`${vt} non-string map keys are not supported`);if(r<n)return-1;if(r>n)return 1;throw new Error(`${vt} unexpected duplicate map keys, this is not supported`)}var _v={addBreakTokens:!0,mapSorter:Bv};function tu(t,e){return e=Object.assign({},_v,e),ef(t,new eu,e)}var vn=class{constructor(e,r={}){this._pos=0,this.data=e,this.options=r,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${I} unexpected end of input at position ${this._pos}`);for(let r=0;r<e.length;r++)if(this.data[this._pos++]!==e[r])throw new Error(`${I} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){let e=this._pos,r=!1,n=!1,o=a=>{for(;!this.done();){let c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(r=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new b(p.uint,0,this._pos-e);if(o([48,49,50,51,52,53,54,55,56,57]),r&&this._pos===e+1)throw new Error(`${I} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${I} unexpected token at position ${this._pos}`);n=!0,this._pos++,o([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,o([48,49,50,51,52,53,54,55,56,57]));let s=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),i=parseFloat(s);return n?new b(p.float,i,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(i)?new b(i>=0?p.uint:p.negint,i,this._pos-e):new b(i>=0?p.uint:p.negint,BigInt(s),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${I} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let s=this._pos,i=0;s<this.data.length&&i<65536;s++,i++){let a=this.data[s];if(a===92||a<32||a>=128)break;if(a===34){let c=String.fromCharCode.apply(null,this.data.subarray(this._pos,s));return this._pos=s+1,new b(p.string,c,i)}}let e=this._pos,r=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${I} unexpected end of unicode escape sequence at position ${this._pos}`);let s=0;for(let i=0;i<4;i++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${I} unexpected unicode escape character at position ${this._pos}`);s=s*16+a,this._pos++}return s},o=()=>{let s=this.ch(),i=null,a=s>239?4:s>223?3:s>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${I} unexpected unicode sequence at position ${this._pos}`);let c,u,d,h;switch(a){case 1:s<128&&(i=s);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(h=(s&31)<<6|c&63,h>127&&(i=h));break;case 3:c=this.data[this._pos+1],u=this.data[this._pos+2],(c&192)===128&&(u&192)===128&&(h=(s&15)<<12|(c&63)<<6|u&63,h>2047&&(h<55296||h>57343)&&(i=h));break;case 4:c=this.data[this._pos+1],u=this.data[this._pos+2],d=this.data[this._pos+3],(c&192)===128&&(u&192)===128&&(d&192)===128&&(h=(s&15)<<18|(c&63)<<12|(u&63)<<6|d&63,h>65535&&h<1114112&&(i=h))}i===null?(i=65533,a=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|i&1023),r.push(i),this._pos+=a};for(;!this.done();){let s=this.ch(),i;switch(s){case 92:if(this._pos++,this.done())throw new Error(`${I} unexpected string termination at position ${this._pos}`);switch(i=this.ch(),this._pos++,i){case 34:case 39:case 92:case 47:r.push(i);break;case 98:r.push(8);break;case 116:r.push(9);break;case 110:r.push(10);break;case 102:r.push(12);break;case 114:r.push(13);break;case 117:r.push(n());break;default:throw new Error(`${I} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new b(p.string,Gc(r),this._pos-e);default:if(s<32)throw new Error(`${I} invalid control character at position ${this._pos}`);s<128?(r.push(s),this._pos++):o()}}throw new Error(`${I} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new b(p.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new b(p.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new b(p.null,null,4);case 102:return this.expect([102,97,108,115,101]),new b(p.false,!1,5);case 116:return this.expect([116,114,117,101]),new b(p.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${I} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new b(p.break,void 0,1);if(this.ch()!==44)throw new Error(`${I} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new b(p.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new b(p.break,void 0,1);if(this.ch()!==44)throw new Error(`${I} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new b(p.break,void 0,1);let e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${I} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${I} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}};function ru(t,e){return e=Object.assign({tokenizer:new vn(t,e)},e),so(t,e)}var nu={};C(nu,{base64:()=>wi,base64pad:()=>Cv,base64url:()=>Uv,base64urlpad:()=>Ov});var wi=re({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Cv=re({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Uv=re({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ov=re({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Pv(t){return t instanceof ArrayBuffer?new Uint8Array(t,0,t.byteLength):t}function Rv(t){if(t.asCID!==t&&t["/"]!==t.bytes)return null;let e=G.asCID(t);if(!e)return null;let r=e.toString();return[new b(p.map,1/0,1),new b(p.string,"/",1),new b(p.string,r,r.length),new b(p.break,void 0,1)]}function xi(t){let e=wi.encode(t).slice(1);return[new b(p.map,1/0,1),new b(p.string,"/",1),new b(p.map,1/0,1),new b(p.string,"bytes",5),new b(p.string,e,e.length),new b(p.break,void 0,1),new b(p.break,void 0,1)]}function et(t){return xi(new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}function Nv(t){return xi(new Uint8Array(t))}function $v(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function zv(t){if(Number.isNaN(t))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(t===1/0||t===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}var Fv={typeEncoders:{Object:Rv,Buffer:xi,Uint8Array:xi,Int8Array:et,Uint16Array:et,Int16Array:et,Uint32Array:et,Int32Array:et,Float32Array:et,Float64Array:et,Uint8ClampedArray:et,BigInt64Array:et,BigUint64Array:et,DataView:et,ArrayBuffer:Nv,undefined:$v,number:zv}},ou=class extends vn{constructor(e,r){super(e,r),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){let e=this._next();if(e.type===p.map){let r=this._next();if(r.type===p.string&&r.value==="/"){let n=this._next();if(n.type===p.string){if(this._next().type!==p.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new b(p.tag,42,0)}if(n.type===p.map){let o=this._next();if(o.type===p.string&&o.value==="bytes"){let s=this._next();if(s.type===p.string){for(let a=0;a<2;a++)if(this._next().type!==p.break)throw new Error("Invalid encoded Bytes form");let i=wi.decode(`m${s.value}`);return new b(p.bytes,i,s.value.length)}this.tokenBuffer.push(s)}this.tokenBuffer.push(o)}this.tokenBuffer.push(n)}this.tokenBuffer.push(r)}return e}},su={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};su.tags[42]=G.parse;var bo=t=>tu(t,Fv),iu=t=>{let e=Pv(t),r=Object.assign(su,{tokenizer:new ou(e,su)});return ru(e,r)};var z6=new TextDecoder;var F6=new TextEncoder;var au=t=>{let e=ug(t.v,t.s.algorithm),r=dg(t),n=Mv(t.s);return`${e}.${r}.${n}`},fg=(t,e,r)=>`${ug(e,r)}.${dg(t)}`,ug=(t,e)=>Ne.baseEncode(jv(t,e)),dg=t=>Ne.baseEncode(Hv(t)),Mv=t=>Ne.baseEncode(t.raw),jv=(t,e)=>bo({alg:e,ucv:t,typ:"JWT"}),Hv=t=>bo({iss:gn(t.iss),aud:gn(t.aud),att:t.att,exp:t.exp,prf:t.prf.map(Vv),...t.fct.length>0&&{fct:t.fct},...t.nnc&&{nnc:t.nnc},...t.nbf&&{nbf:t.nbf}}),Vv=t=>t.toString();var qv=t=>JSON.parse(Qt(bo(t))),Sn=class{constructor(e){this.model=e}get version(){return this.model.v}get issuer(){return Mf(this.model.iss)}get audience(){return Mf(this.model.aud)}get capabilities(){return this.model.att}get expiration(){let{exp:e}=this.model;return e===null?1/0:e}get notBefore(){return this.model.nbf}get nonce(){return this.model.nnc}get facts(){return this.model.fct}get proofs(){return this.model.prf}get signature(){return this.model.s}get jwt(){return this.model.jwt}get s(){return this.model.s}get v(){return this.model.v}get iss(){return this.model.iss}get aud(){return this.model.aud}get att(){return this.model.att}get exp(){return this.model.exp}get nbf(){return this.model.nbf}get nnc(){return this.model.nnc}get fct(){return this.model.fct}get prf(){return this.model.prf}toJSON(){let{v:e,iss:r,aud:n,s:o,att:s,prf:i,exp:a,fct:c,nnc:u,nbf:d}=this.model;return{iss:r,aud:n,v:e,s:o,exp:a,...qv({att:s,prf:i,...c.length>0&&{fct:c}}),...u!=null&&{nnc:u},...d&&{nbf:d}}}};var cu=ut,lg=t=>new bi(t),fu=t=>{let{fct:e,nnc:r,nbf:n,...o}=go(t);return be({...e.length>0&&{fct:e},...r!=null&&{nnc:r},...n&&{nbf:n},...o,v:wo(t.v,"v"),s:Wv(t.s,"s")})},Wv=(t,e)=>{try{return Xf(t)}catch(r){throw new Error(`Expected signature ${e}, instead got ${JSON.stringify(t)}`,{cause:r})}},hg=t=>{let e=ke(t);return new bi({...go(e),v:wo(e.v,"v"),s:og(e.s)})};var bi=class extends Sn{get code(){return cu}format(){return au(this.model)}encode(){return fu(this.model)}};var uu=t=>{let e=t.split("."),[r,n,o]=e.length===3?e:xo(`Can't parse UCAN: ${t}: Expected JWT format: 3 dot-separated base64url-encoded values.`),{ucv:s,alg:i}=Kv(r);return{...Jv(n),v:s,s:Qf(i,Ne.baseDecode(o))}},Kv=t=>{let{ucv:e,alg:r,typ:n}=iu(Ne.baseDecode(t));return{typ:ag(n,"JWT","typ"),ucv:wo(e,"ucv"),alg:yo(r,"alg")}},Jv=t=>{let e=iu(Ne.baseDecode(t));return rg(e)};var pg=t=>{let e=Qt(t);return new du({...uu(e),jwt:e})},lu=({jwt:t})=>dt(t),mg=({jwt:t})=>t,du=class extends Sn{constructor(e){super(e),this.model=e}get code(){return yn}format(){return mg(this.model)}encode(){return lu(this.model)}};var gg=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Ie=Nf({name:"sha2-256",code:18,encode:gg("SHA-256")}),nL=Nf({name:"sha2-512",code:19,encode:gg("SHA-512")});var Qv="0.9.1";var Yv=Ie;var yg=t=>{try{return hg(t)}catch{return pg(t)}};var wg=async(t,{hasher:e=Yv}={})=>{let[r,n]=t.jwt?[yn,lu(t)]:[cu,fu(t)],o=await e.digest(n);return{bytes:n,cid:Re(r,o),data:t}};var xg=async({issuer:t,audience:e,capabilities:r,lifetimeInSeconds:n=30,expiration:o=eS()+n,notBefore:s,facts:i=[],proofs:a=[],nonce:c})=>{let u=Qv,d=go({iss:se(t.did()),aud:se(e.did()),att:r,fct:i,exp:o,nbf:s,prf:a,nnc:c}),h=Xv(d,u,t.signatureAlgorithm);return lg({...d,v:u,s:await t.sign(h)})},Xv=(t,e,r)=>dt(fg(t,e,r));var eS=()=>Math.floor(Date.now()/1e3);var tt={};C(tt,{code:()=>ut,contentType:()=>rS,decode:()=>ke,encode:()=>Lr,link:()=>bg,name:()=>mf,write:()=>pu});var rS="application/vnd.ipld.dag-cbor",ki=(t,e)=>{if(e.has(t))throw new TypeError("Can not encode circular structure");if(t===void 0&&e.size===0||t===null||typeof t=="symbol"&&e.size===0)return null;if(Se(t)||ArrayBuffer.isView(t))return t;if(Array.isArray(t)){e.add(t);let r=[];for(let n of t)r.push(n===void 0||typeof n=="symbol"?null:ki(n,e));return r}if(typeof t.toJSON=="function"){e.add(t);let r=t.toJSON();return ki(r,e)}if(typeof t=="object"){e.add(t);let r={};for(let[n,o]of Object.entries(t))o!==void 0&&typeof o!="symbol"&&(r[n]=ki(o,new Set(e)));return r}return t},Lr=t=>be(ki(t,new Set)),bg=async(t,{hasher:e=Ie}={})=>Re(ut,await e.digest(t)),pu=async(t,e)=>{let r=Lr(t);return{cid:await bg(r,e),bytes:r}};var It=function*(t){t&&typeof t=="object"&&"iterateIPLDBlocks"in t&&typeof t.iterateIPLDBlocks=="function"&&(yield*t.iterateIPLDBlocks())},kg=(t=[])=>{let e=new Map;return En(t,e),e},nS=mi.code,Yt=(t,e,r)=>{if(t.multihash.code===nS)return{cid:t,bytes:t.multihash.digest};let n=e.get(`${t}`);return n||(r===void 0?Dt(t):r)};var Dt=t=>{throw new Error(`Block for the ${t} is not found`)},vi=async(t,e,r={})=>{let n=r.codec||tt,o=r.hasher||Ie,s=n.encode(t),i=await o.digest(s),a=Re(n.code,i);return e.set(a.toString(),{bytes:s,cid:a}),{bytes:s,cid:a,data:t}},oS=({cid:t,bytes:e},r)=>(r.set(t.toString(),{bytes:e,cid:t}),{bytes:e,cid:t}),En=(t,e)=>{for(let r of t)oS(r,e)};var X={};C(X,{code:()=>Dg,contentType:()=>wS,createWriter:()=>bS,decode:()=>Ao,encode:()=>Bi,link:()=>Bg,name:()=>xS,write:()=>kS});var Xt=Ht(Ms(),1),er={SHA2_256:18,LENGTH:32,DAG_PB:112},Si=40;function lt(t,e){if(!t.length)throw new Error("Unexpected end of data");let r=Xt.default.decode(t);return e.seek(Xt.default.decode.bytes),r}function Ei(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength),r=0;return{version:2,characteristics:[e.getBigUint64(r,!0),e.getBigUint64(r+=8,!0)],dataOffset:Number(e.getBigUint64(r+=8,!0)),dataSize:Number(e.getBigUint64(r+=8,!0)),indexOffset:Number(e.getBigUint64(r+=8,!0))}}function Ai(t){Xt.default.decode(t);let e=Xt.default.decode.bytes,r=Xt.default.decode(t.subarray(Xt.default.decode.bytes)),n=Xt.default.decode.bytes;return e+n+r}var tr={Null:t=>t===null?t:void 0,Int:t=>Number.isInteger(t)?t:void 0,Float:t=>typeof t=="number"&&Number.isFinite(t)?t:void 0,String:t=>typeof t=="string"?t:void 0,Bool:t=>typeof t=="boolean"?t:void 0,Bytes:t=>t instanceof Uint8Array?t:void 0,Link:t=>t!==null&&typeof t=="object"&&t.asCID===t?t:void 0,List:t=>Array.isArray(t)?t:void 0,Map:t=>t!==null&&typeof t=="object"&&t.asCID!==t&&!Array.isArray(t)&&!(t instanceof Uint8Array)?t:void 0},ko={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":tr.Link,"CarV1HeaderOrV2Pragma > roots (anon)":t=>{if(tr.List(t)!==void 0){for(let e=0;e<t.length;e++){let r=t[e];if(r=ko["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](r),r===void 0)return;if(r!==t[e]){let n=t.slice(0,e);for(let o=e;o<t.length;o++){let s=t[o];if(s=ko["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](s),s===void 0)return;n.push(s)}return n}}return t}},Int:tr.Int,CarV1HeaderOrV2Pragma:t=>{if(tr.Map(t)===void 0)return;let e=Object.entries(t),r=t,n=1;for(let o=0;o<e.length;o++){let[s,i]=e[o];switch(s){case"roots":{let a=ko["CarV1HeaderOrV2Pragma > roots (anon)"](t[s]);if(a===void 0)return;if(a!==i||r!==t){if(r===t){r={};for(let c=0;c<o;c++)r[e[c][0]]=e[c][1]}r.roots=a}}break;case"version":{n--;let a=ko.Int(t[s]);if(a===void 0)return;if(a!==i||r!==t){if(r===t){r={};for(let c=0;c<o;c++)r[e[c][0]]=e[c][1]}r.version=a}}break;default:return}}if(!(n>0))return r}},vo={"CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)":tr.Link,"CarV1HeaderOrV2Pragma > roots (anon)":t=>{if(tr.List(t)!==void 0){for(let e=0;e<t.length;e++){let r=t[e];if(r=vo["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](r),r===void 0)return;if(r!==t[e]){let n=t.slice(0,e);for(let o=e;o<t.length;o++){let s=t[o];if(s=vo["CarV1HeaderOrV2Pragma > roots (anon) > valueType (anon)"](s),s===void 0)return;n.push(s)}return n}}return t}},Int:tr.Int,CarV1HeaderOrV2Pragma:t=>{if(tr.Map(t)===void 0)return;let e=Object.entries(t),r=t,n=1;for(let o=0;o<e.length;o++){let[s,i]=e[o];switch(s){case"roots":{let a=vo["CarV1HeaderOrV2Pragma > roots (anon)"](i);if(a===void 0)return;if(a!==i||r!==t){if(r===t){r={};for(let c=0;c<o;c++)r[e[c][0]]=e[c][1]}r.roots=a}}break;case"version":{n--;let a=vo.Int(i);if(a===void 0)return;if(a!==i||r!==t){if(r===t){r={};for(let c=0;c<o;c++)r[e[c][0]]=e[c][1]}r.version=a}}break;default:return}}if(!(n>0))return r}},Ti={toTyped:ko.CarV1HeaderOrV2Pragma,toRepresentation:vo.CarV1HeaderOrV2Pragma};function vg(t,e){let r=lt(t.upTo(8),t);if(r===0)throw new Error("Invalid CAR header (zero length)");let n=t.exactly(r,!0),o=ke(n);if(Ti.toTyped(o)===void 0)throw new Error("Invalid CAR header format");if(o.version!==1&&o.version!==2||e!==void 0&&o.version!==e)throw new Error(`Invalid CAR version: ${o.version}${e!==void 0?` (expected ${e})`:""}`);if(o.version===1){if(!Array.isArray(o.roots))throw new Error("Invalid CAR header format");return o}if(o.roots!==void 0)throw new Error("Invalid CAR header format");let s=Ei(t.exactly(Si,!0));t.seek(s.dataOffset-t.pos);let i=vg(t,1);return Object.assign(i,s)}function sS(t){let e=t.exactly(2,!1);if(e[0]===er.SHA2_256&&e[1]===er.LENGTH){let i=t.exactly(34,!0),a=Ve(i);return G.create(0,er.DAG_PB,a)}let r=lt(t.upTo(8),t);if(r!==1)throw new Error(`Unexpected CID version (${r})`);let n=lt(t.upTo(8),t),o=t.exactly(Ai(t.upTo(8)),!0),s=Ve(o);return G.create(r,n,s)}function iS(t){let e=t.pos,r=lt(t.upTo(8),t);if(r===0)throw new Error("Invalid CAR section (zero length)");r+=t.pos-e;let n=sS(t),o=r-Number(t.pos-e);return{cid:n,length:r,blockLength:o}}function Sg(t){let e=aS(t),r=vg(e);if(r.version===2){let o=e.pos-r.dataOffset;e=cS(e,r.dataSize-o)}let n=[];for(;e.upTo(8).length>0;){let{cid:o,blockLength:s}=iS(e);n.push({cid:o,bytes:e.exactly(s,!0)})}return{header:r,blocks:n}}function aS(t){let e=0;return{upTo(r){return t.subarray(e,e+Math.min(r,t.length-e))},exactly(r,n=!1){if(r>t.length-e)throw new Error("Unexpected end of data");let o=t.subarray(e,e+r);return n&&(e+=r),o},seek(r){e+=r},get pos(){return e}}}function cS(t,e){let r=0;return{upTo(n){let o=t.upTo(n);return o.length+r>e&&(o=o.subarray(0,e-r)),o},exactly(n,o=!1){let s=t.exactly(n,o);if(s.length+r>e)throw new Error("Unexpected end of data");return o&&(r+=n),s},seek(n){r+=n,t.seek(n)},get pos(){return t.pos}}}var So=class t{constructor(e,r){this._header=e,this._blocks=r,this._cids=void 0}get version(){return this._header.version}getRoots(){return this._header.roots}has(e){return this._blocks.some(r=>r.cid.equals(e))}get(e){return this._blocks.find(r=>r.cid.equals(e))}blocks(){return this._blocks}cids(){return this._cids||(this._cids=this._blocks.map(e=>e.cid)),this._cids}static fromBytes(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");let{header:r,blocks:n}=Sg(e);return new t(r,n)}};var uS=Xc(),dS={float64:!1,quickEncodeToken:ri};function mu(t,e=uS,r=dS){if(Array.isArray(t)){let n=0;for(let o of t)n+=mu(o,e,r);return n}else{let n=e[t.type.major];if(n.encodedSize===void 0||typeof n.encodedSize!="function")throw new Error(`Encoder for ${t.type.name} does not have an encodedSize()`);return n.encodedSize(t,r)}}var Eo=Ht(Ms(),1),yu=class{constructor(e,r){this.bytes=e,this.byteOffset=r,this.roots=[],this.headerSize=r}addRoot(e,r){return lS(this,e,r),this}write(e){return hS(this,e),this}close(e){return pS(this,e)}},lS=(t,e,r={})=>{let{resize:n=!1}=r,{bytes:o,headerSize:s,byteOffset:i,roots:a}=t;t.roots.push(e);let c=Ii(t);if(c>s)if(c-s+i<o.byteLength)if(n)Ag(t,c);else throw a.pop(),new RangeError(`Header of size ${s} has no capacity for new root ${e}.
  However there is a space in the buffer and you could call addRoot(root, { resize: root }) to resize header to make a space for this root.`);else throw a.pop(),new RangeError(`Buffer has no capacity for a new root ${e}`)},wu=({cid:t,bytes:e})=>{let r=t.bytes.byteLength+e.byteLength;return Eo.default.encodingLength(r)+r},hS=(t,{cid:e,bytes:r})=>{let n=e.bytes.byteLength+r.byteLength,o=Eo.default.encode(n);if(t.byteOffset+o.length+n>t.bytes.byteLength)throw new RangeError("Buffer has no capacity for this block");gu(t,o),gu(t,e.bytes),gu(t,r)},pS=(t,e={})=>{let{resize:r=!1}=e,{roots:n,bytes:o,byteOffset:s,headerSize:i}=t,a=be({version:1,roots:n}),c=Eo.default.encode(a.length),u=c.length+a.byteLength;if(i-u===0)return Eg(t,c,a),o.subarray(0,s);if(r)return Ag(t,u),Eg(t,c,a),o.subarray(0,t.byteOffset);throw new RangeError(`Header size was overestimated.
You can use close({ resize: true }) to resize header`)},Ag=(t,e)=>{let{bytes:r,headerSize:n}=t;r.set(r.subarray(n,t.byteOffset),e),t.byteOffset+=e-n,t.headerSize=e},gu=(t,e)=>{t.bytes.set(e,t.byteOffset),t.byteOffset+=e.length},Eg=({bytes:t},e,r)=>{t.set(e),t.set(r,e.length)},mS=[new b(p.map,2),new b(p.string,"version"),new b(p.uint,1),new b(p.string,"roots")],gS=new b(p.tag,42),yS=t=>{let e=[...mS];e.push(new b(p.array,t.length));for(let n of t)e.push(gS),e.push(new b(p.bytes,{length:n+1}));let r=mu(e);return Eo.default.encodingLength(r)+r},Ii=({roots:t})=>yS(t.map(e=>e.bytes.byteLength));var Tg=(t,e={})=>{let{roots:r=[],byteOffset:n=0,byteLength:o=t.byteLength,headerSize:s=Ii({roots:r})}=e,i=new Uint8Array(t,n,o),a=new yu(i,s);for(let c of r)a.addRoot(c);return a};var wS="application/vnd.ipld.car",xS="CAR",Dg=514,Di=class{constructor(e=[],r=0){this.written=new Set,this.blocks=e,this.byteLength=r}write(...e){for(let r of e){let n=r.cid.toString(qe);this.written.has(n)||(this.blocks.push(r),this.byteLength+=wu(r),this.written.add(n))}return this}flush(...e){let r=[];for(let s of e.reverse()){let i=s.cid.toString(qe);this.written.has(i)||(this.blocks.unshift(s),this.byteLength+=wu({cid:s.cid,bytes:s.bytes}),this.written.add(i)),r.unshift(s.cid)}this.byteLength+=Ii({roots:r});let n=new ArrayBuffer(this.byteLength),o=Tg(n,{roots:r});for(let s of this.blocks)o.write(s);return o.close()}},bS=()=>new Di,Bi=({roots:t=[],blocks:e})=>{let r=new Di;return e&&r.write(...e.values()),r.flush(...t)},Ao=t=>{let e=So.fromBytes(t),r=[],n=new Map;for(let o of e.getRoots()){let s=e.get(o);s&&r.push(s)}for(let o of e.blocks())n.set(o.cid.toString(),o);return{roots:r,blocks:n}},Bg=async(t,{hasher:e=Ie}={})=>Re(Dg,await e.digest(t)),kS=async(t,e)=>{let r=Bi(t),n=await Bg(r,e);return{bytes:r,cid:n}};var x={};C(x,{API:()=>j,Bytes:()=>zg,DID:()=>Ur,Link:()=>Ge,Text:()=>nd,URI:()=>ed,and:()=>Rg,array:()=>Ug,boolean:()=>DS,bytes:()=>zS,dictionary:()=>Zu,did:()=>ji,endsWith:()=>Mg,enum:()=>AS,error:()=>J,float:()=>NS,greaterThan:()=>$g,integer:()=>CS,intersection:()=>Pg,lessThan:()=>Ng,link:()=>Lt,literal:()=>Ci,memberError:()=>Cr,never:()=>vS,nullable:()=>Cg,number:()=>BS,ok:()=>O,optional:()=>Oi,or:()=>Og,refine:()=>jg,startsWith:()=>Fg,string:()=>_t,struct:()=>Pi,text:()=>Hi,toString:()=>Io,tuple:()=>ES,typeError:()=>ge,uint64:()=>OS,unknown:()=>SS,uri:()=>Xu,variant:()=>Do});var ed={};C(ed,{from:()=>HS,match:()=>Xu,read:()=>jS,uri:()=>MS});var O=t=>{if(t==null)throw new TypeError(`ok(${t}) is not allowed, consider ok({}) instead`);return{ok:t}},To=t=>{if(t==null)throw new TypeError(`error(${t}) is not allowed, consider passing an error instead`);return{error:t}},_g=t=>{throw new $e(t)},ne=t=>({error:new $e(t)}),$e=class extends Error{describe(){return this.toString()}get message(){return this.describe()}toJSON(){let{name:e,message:r,stack:n}=this;return{name:e,message:r,stack:n}}};var j=class{constructor(e){this.settings=e}toString(){return`new ${this.constructor.name}()`}readWith(e,r){throw new Error("Abstract method readWith must be implemented by subclass")}read(e){return this.readWith(e,this.settings)}is(e){return!this.read(e)?.error}from(e){let r=this.read(e);if(r.error)throw r.error;return r.ok}optional(){return Oi(this)}nullable(){return Cg(this)}array(){return Ug(this)}or(e){return Og(this,e)}and(e){return Rg(this,e)}refine(e){return jg(this,e)}brand(e){return this}default(e){let r=this.from(e);if(r===void 0)throw new Error("Value of type undefined is not a valid default");return new Su({reader:this,value:r})}},xu=class extends j{toString(){return"never()"}read(e){return ge({expect:"never",actual:e})}},vS=()=>new xu,bu=class extends j{read(e){return{ok:e}}toString(){return"unknown()"}},SS=()=>new bu,ku=class extends j{readWith(e,r){let n=r.read(e);return n.error?e===null?{ok:null}:{error:new Ui({causes:[n.error,ge({expect:"null",actual:e}).error]})}:n}toString(){return`${this.settings}.nullable()`}},Cg=t=>new ku(t),vu=class extends j{optional(){return this}readWith(e,r){let n=r.read(e);return n.error&&e===void 0?{ok:void 0}:n}toString(){return`${this.settings}.optional()`}},Su=class extends j{optional(){return this}readWith(e,{reader:r,value:n}){if(e===void 0)return{ok:n};{let o=r.read(e);return o.error||o.ok!==void 0?o:{ok:n}}}toString(){return`${this.settings.reader}.default(${JSON.stringify(this.settings.value)})`}get value(){return this.settings.value}},Oi=t=>new vu(t),Eu=class extends j{readWith(e,r){if(!Array.isArray(e))return ge({expect:"array",actual:e});let n=[];for(let[o,s]of e.entries()){let i=r.read(s);if(i.error)return Cr({at:o,cause:i.error});n.push(i.ok)}return{ok:n}}get element(){return this.settings}toString(){return`array(${this.element})`}},Ug=t=>new Eu(t),Au=class extends j{readWith(e,r){if(!Array.isArray(e))return ge({expect:"array",actual:e});if(e.length!==this.shape.length)return J(`Array must contain exactly ${this.shape.length} elements`);let n=[];for(let[o,s]of r.entries()){let i=s.read(e[o]);if(i.error)return Cr({at:o,cause:i.error});n[o]=i.ok}return{ok:n}}get shape(){return this.settings}toString(){return`tuple([${this.shape.map(e=>e.toString()).join(", ")}])`}},ES=t=>new Au(t),Tu=class t extends j{readWith(e,{key:r,value:n}){if(typeof e!="object"||e===null||Array.isArray(e))return ge({expect:"dictionary",actual:e});let o={};for(let[s,i]of Object.entries(e)){let a=r.read(s);if(a.error)return Cr({at:s,cause:a.error});let c=n.read(i);if(c.error)return Cr({at:s,cause:c.error});c.ok!==void 0&&(o[a.ok]=c.ok)}return{ok:o}}get key(){return this.settings.key}get value(){return this.settings.value}partial(){let{key:e,value:r}=this.settings;return new t({key:e,value:Oi(r)})}toString(){return`dictionary(${this.settings})`}},Zu=({value:t,key:e})=>new Tu({value:t,key:e||_t()}),Iu=class extends j{readWith(e,{variants:r,type:n}){return r.has(e)?{ok:e}:ge({expect:n,actual:e})}toString(){return this.settings.type}},AS=t=>new Iu({type:t.join("|"),variants:new Set(t)});var Du=class extends j{readWith(e,r){let n=[];for(let o of r){let s=o.read(e);if(s.error)n.push(s.error);else return s}return{error:new Ui({causes:n})}}get variants(){return this.settings}toString(){return`union([${this.variants.map(e=>e.toString()).join(", ")}])`}},TS=t=>new Du(t),Og=(t,e)=>TS([t,e]),Bu=class extends j{readWith(e,r){let n=[];for(let o of r){let s=o.read(e);s.error&&n.push(s.error)}return n.length>0?{error:new Ju({causes:n})}:{ok:e}}toString(){return`intersection([${this.settings.map(e=>e.toString()).join(",")}])`}},Pg=t=>new Bu(t),Rg=(t,e)=>Pg([t,e]),_u=class extends j{readWith(e){switch(e){case!0:case!1:return{ok:e};default:return ge({expect:"boolean",actual:e})}}toString(){return"boolean()"}},IS=new _u,DS=()=>IS,_i=class extends j{greaterThan(e){return this.refine($g(e))}lessThan(e){return this.refine(Ng(e))}refine(e){return new Cu({base:this,schema:e})}},Lu=class extends _i{readWith(e){return typeof e=="number"?{ok:e}:ge({expect:"number",actual:e})}toString(){return"number()"}},Qu=new Lu,BS=()=>Qu,Cu=class extends _i{readWith(e,{base:r,schema:n}){let o=r.read(e);return o.error?o:n.read(o.ok)}toString(){return`${this.settings.base}.refine(${this.settings.schema})`}},Uu=class extends j{readWith(e,r){return e<r?{ok:e}:J(`Expected ${e} < ${r}`)}toString(){return`lessThan(${this.settings})`}},Ng=t=>new Uu(t),Ou=class extends j{readWith(e,r){return e>r?{ok:e}:J(`Expected ${e} > ${r}`)}toString(){return`greaterThan(${this.settings})`}},$g=t=>new Ou(t),_S={read(t){return Number.isInteger(t)?{ok:t}:ge({expect:"integer",actual:t})},toString(){return"Integer"}},LS=Qu.refine(_S),CS=()=>LS,Lg=2n**64n-1n,Pu=class extends j{read(e){switch(typeof e){case"bigint":return e>Lg?J(`Integer is too big for uint64, ${e} > ${Lg}`):e<0?J(`Negative integer can not be represented as uint64, ${e} < 0`):{ok:e};case"number":return Number.isInteger(e)?e<0?J(`Negative integer can not be represented as uint64, ${e} < 0`):{ok:BigInt(e)}:ge({expect:"uint64",actual:e});default:return ge({expect:"uint64",actual:e})}}toString(){return"uint64"}},US=new Pu,OS=()=>US,PS={read(t){return Number.isFinite(t)?{ok:t}:ge({expect:"Float",actual:t})},toString(){return"Float"}},RS=Qu.refine(PS),NS=()=>RS,Li=class extends j{refine(e){let r=e;return new Ru({base:this,schema:r})}startsWith(e){return this.refine(Fg(e))}endsWith(e){return this.refine(Mg(e))}toString(){return"string()"}},Ru=class extends Li{readWith(e,{base:r,schema:n}){let o=r.read(e);return o.error?o:n.read(o.ok)}toString(){return`${this.settings.base}.refine(${this.settings.schema})`}},Nu=class extends Li{readWith(e){return typeof e=="string"?{ok:e}:ge({expect:"string",actual:e})}},$S=new Nu,_t=()=>$S,$u=class extends j{readWith(e){return e instanceof Uint8Array?{ok:e}:ge({expect:"Uint8Array",actual:e})}},zg=new $u,zS=()=>zg,zu=class extends j{readWith(e,r){return e.startsWith(r)?{ok:e}:J(`Expect string to start with "${r}" instead got "${e}"`)}get prefix(){return this.settings}toString(){return`startsWith("${this.prefix}")`}},Fg=t=>new zu(t),Fu=class extends j{readWith(e,r){return e.endsWith(r)?{ok:e}:J(`Expect string to end with "${r}" instead got "${e}"`)}get suffix(){return this.settings}toString(){return`endsWith("${this.suffix}")`}},Mg=t=>new Fu(t),Mu=class extends j{readWith(e,{base:r,schema:n}){let o=r.read(e);return o.error?o:n.read(o.ok)}toString(){return`${this.settings.base}.refine(${this.settings.schema})`}},jg=(t,e)=>new Mu({base:t,schema:e}),ju=class extends j{readWith(e,r){return e!==r?{error:new Wu({expect:r,actual:e})}:{ok:r}}get value(){return this.settings}default(e=this.value){return super.default(e)}toString(){return`literal(${Io(this.value)})`}},Ci=t=>new ju(t),Hu=class t extends j{readWith(e,r){if(typeof e!="object"||e===null||Array.isArray(e))return ge({expect:"object",actual:e});let n=e,o={},s=Object.entries(r);for(let[i,a]of s){let c=a.read(n[i]);if(c.error)return Cr({at:i,cause:c.error});c.ok!==void 0&&(o[i]=c.ok)}return{ok:o}}partial(){return new t(Object.fromEntries(Object.entries(this.shape).map(([e,r])=>[e,Oi(r)])))}get shape(){return this.settings}toString(){return["struct({ ",...Object.entries(this.shape).map(([e,r])=>`${e}: ${r}`).join(", ")," })"].join("")}create(e){return this.from(e||{})}extend(e){return new t({...this.shape,...e})}},Pi=t=>{let e={},r=Object.entries(t);for(let[n,o]of r)switch(typeof o){case"number":case"string":case"boolean":e[n]=Ci(o);break;case"object":e[n]=o===null?Ci(null):o;break;default:throw new Error(`Invalid struct field "${n}", expected schema or literal, instead got ${typeof o}`)}return new Hu(e)},Vu=class extends j{readWith(e,r){if(typeof e!="object"||e===null||Array.isArray(e))return ge({expect:"object",actual:e});let n=Object.keys(e),[o]=n.length===1?n:[],s=o?r[o]:void 0;if(s){let i=s.read(e[o]);return i.error?Cr({at:o,cause:i.error}):{ok:{[o]:i.ok}}}else if(r._){let i=r._.read(e);return i.error?i:{ok:{_:i.ok}}}else return J(o?`Expected an object with one of the these keys: ${Object.keys(r).sort().join(", ")} instead got object with key ${o}`:"Expected an object with a single key instead got object with keys "+n.sort().join(", "))}match(e,r){let n=this.read(e);if(n.error){if(r!==void 0)return[null,r];throw n.error}else{let[o]=Object.keys(n.ok),s=n.ok[o];return[o,s]}}create(e){return this.from(e)}},Do=t=>new Vu(t),J=t=>({error:new Bt(t)}),Bt=class extends $e{get name(){return"SchemaError"}describe(){return this.name}},qu=class extends Bt{constructor({expect:e,actual:r}){super(),this.expect=e,this.actual=r}get name(){return"TypeError"}describe(){return`Expected value of type ${this.expect} instead got ${Io(this.actual)}`}},ge=t=>({error:new qu(t)}),Io=t=>{let e=typeof t;switch(e){case"boolean":case"string":return JSON.stringify(t);case"bigint":return`${t}n`;case"number":case"symbol":case"undefined":return String(t);case"object":return t===null?"null":Array.isArray(t)?"array":Symbol.toStringTag in t?t[Symbol.toStringTag]:"object";default:return e}},Wu=class extends Bt{constructor({expect:e,actual:r}){super(),this.expect=e,this.actual=r}get name(){return"LiteralError"}describe(){return`Expected literal ${Io(this.expect)} instead got ${Io(this.actual)}`}},Gu=class extends Bt{constructor({at:e,cause:r}){super(),this.at=e,this.cause=r}get name(){return"ElementError"}describe(){return[`Array contains invalid element at ${this.at}:`,Ri(this.cause.message)].join(`
`)}},Ku=class extends Bt{constructor({at:e,cause:r}){super(),this.at=e,this.cause=r}get name(){return"FieldError"}describe(){return[`Object contains invalid field "${this.at}":`,Ri(this.cause.message)].join(`
`)}},Cr=({at:t,cause:e})=>typeof t=="string"?{error:new Ku({at:t,cause:e})}:{error:new Gu({at:t,cause:e})},Ui=class extends Bt{constructor({causes:e}){super(),this.causes=e}get name(){return"UnionError"}describe(){let{causes:e}=this;return["Value does not match any type of the union:",...e.map(r=>Ri(r.message))].join(`
`)}},Ju=class extends Bt{constructor({causes:e}){super(),this.causes=e}get name(){return"IntersectionError"}describe(){let{causes:e}=this;return["Value does not match following types of the intersection:",...e.map(r=>Ri(r.message))].join(`
`)}},FS=(t,e="  ")=>`${e}${t.split(`
`).join(`
${e}`)}`,Ri=t=>FS(`- ${t}`);var $i=class extends j{readWith(e,{protocol:r}={}){if(typeof e!="string"&&!(e instanceof URL))return J(`Expected URI but got ${e===null?"null":typeof e}`);try{let n=new URL(String(e));return r!=null&&n.protocol!==r?J(`Expected ${r} URI instead got ${n.href}`):{ok:n.href}}catch{return J("Invalid URI")}}},Yu=new $i({}),MS=()=>Yu,jS=t=>Yu.read(t),Xu=t=>new $i(t),HS=t=>Yu.from(t);var Ge={};C(Ge,{create:()=>Re,createLegacy:()=>Pf,isLink:()=>Se,link:()=>VS,match:()=>Lt,optional:()=>WS,parse:()=>po,read:()=>qS,schema:()=>Fi});var zi=class extends j{readWith(e,{code:r,multihash:n={},version:o}){if(e==null)return J(`Expected link but got ${e} instead`);if(Se(e)){if(r!=null&&e.code!==r)return J(`Expected link to be CID with 0x${r.toString(16)} codec`);if(n.code!=null&&e.multihash.code!==n.code)return J(`Expected link to be CID with 0x${n.code.toString(16)} hashing algorithm`);if(o!=null&&e.version!==o)return J(`Expected link to be CID version ${o} instead of ${e.version}`);let[s,i]=n.digest!=null?[qe.baseEncode(n.digest),qe.baseEncode(e.multihash.digest)]:["",""];return s!==i?J(`Expected link with "${s}" hash digest instead of "${i}"`):{ok:e}}else return J(`Expected link to be a CID instead of ${e}`)}},Fi=new zi({}),VS=()=>Fi,Lt=(t={})=>new zi(t),qS=t=>Fi.read(t),WS=()=>Fi.optional();var Ur={};C(Ur,{did:()=>GS,from:()=>JS,match:()=>ji,read:()=>KS});var Mi=class extends j{readWith(e,r){let n=r?`did:${r}:`:"did:";return e.startsWith(n)?{ok:e}:J(`Expected a ${n} but got "${e}" instead`)}},Hg=_t().refine(new Mi),GS=()=>Hg,KS=t=>Hg.read(t),ji=(t={})=>_t().refine(new Mi(t.method)),JS=t=>ji({}).from(t);var nd={};C(nd,{match:()=>Hi,read:()=>QS,text:()=>ZS});var td=_t(),Hi=t=>t?td.refine(new rd(t.pattern)):td,ZS=Hi,QS=t=>td.read(t),rd=class extends j{readWith(e,r){return r.test(e)?{ok:e}:J(`Expected to match ${r} but got "${e}" instead`)}};var YS=Se,Ct=t=>!Se(t),XS=(...t)=>{let e={};for(let r of t)for(let{with:n,can:o,nb:s}of Vg(r)){let i=e[n]||(e[n]={});(i[o]||(i[o]=[])).push({...s})}return e},Vg=function*({issuer:t,capabilities:e,proofs:r}){for(let n of e)if(n.with==="ucan:*"){yield{...n,with:t.did()};for(let o of r)if(Ct(o))for(let s of Vg(o)){let i=e2(s.can,n.can);i&&(yield{...s,can:i,nb:{...s.nb,...Object(n.nb)}})}}else yield n},e2=(t,e)=>t==="*"?e:e==="*"||e.endsWith("/*")&&t.startsWith(e.slice(0,-1))?t:t.endsWith("/*")&&e.startsWith(t.slice(0,-1))?e:t===e?t:null,rr=class{constructor(e,r=new Map){this.root=e,this.blocks=r,Object.defineProperties(this,{blocks:{enumerable:!1}})}get attachedLinks(){let e=new Set,r=this.data;for(let n of r.capabilities){let o=o2(n);for(let s of o)e.add(`${s}`)}for(let n of r.facts)if(Se(n))e.add(`${n}`);else{let o=Object.values(n).filter(s=>Se(s));for(let s of o)e.add(`${s}`)}return e}get version(){return this.data.version}get signature(){return this.data.signature}get cid(){return this.root.cid}link(){return this.root.cid}get asCID(){return this.cid}get bytes(){return this.root.bytes}get data(){let e=Vi(this.root);return Object.defineProperties(this,{data:{value:e,enumerable:!1}}),e}attach(e){if(!this.attachedLinks.has(`${e.cid.link()}`))throw new Error(`given block with ${e.cid} is not an attached link`);this.blocks.set(`${e.cid}`,e)}export(){return sd(this.root,this.blocks,this.attachedLinks)}archive(){return qg(this)}iterateIPLDBlocks(){return sd(this.root,this.blocks,this.attachedLinks)}get proofs(){return n2(this)}get issuer(){return this.data.issuer}get audience(){return this.data.audience}get capabilities(){return this.data.capabilities}get expiration(){return this.data.expiration}get notBefore(){return this.data.notBefore}get nonce(){return this.data.nonce}get facts(){return this.data.facts}iterate(){return Gg(this)}delegate(){return this}buildIPLDView(){return this}toJSON(){return{...this.data.toJSON(),"/":this.cid.toString(),prf:this.proofs.map(e=>Ct(e)?e:{"/":e.toString()})}}},qg=async t=>{try{let e=new Map;for(let o of t.iterateIPLDBlocks())e.set(`${o.cid}`,o);let r=await pu({[`ucan@${t.version}`]:t.root.cid});e.set(`${r.cid}`,r);let n=Bi({roots:[r],blocks:e});return O(n)}catch(e){return To(e)}},Wg=Do({"ucan@0.9.1":Lt({version:1})}),t2=async t=>{try{let{roots:e,blocks:r}=Ao(t),[n]=e;if(n==null)return J("CAR archive does not contain a root block");let{bytes:o}=n,s=ke(o),[,i]=Wg.match(s);return O(qi({root:i,blocks:r}))}catch(e){return To(e)}},Gg=function*(t){for(let e of t.proofs)Ct(e)&&(yield*Gg(e),yield e)},od=new WeakMap,Vi=({bytes:t})=>{let e=od.get(t);if(!e){let r=yg(t);return od.set(t,r),r}return e},Or=async({issuer:t,audience:e,proofs:r=[],attachedBlocks:n=new Map,...o},s)=>{let i=[],a=new Map;for(let w of r)if(!Ct(w))i.push(w);else{i.push(w.cid);for(let f of w.export())a.set(f.cid.toString(),f)}let c=await xg({...o,issuer:t,audience:e,proofs:i}),{cid:u,bytes:d}=await wg(c,s);od.set(u,c);let h=new rr({cid:u,bytes:d},a);Object.defineProperties(h,{proofs:{value:r}});for(let w of n.values())h.attach(w);return h},sd=function*(t,e,r){for(let n of Vi(t).proofs){let o=e.get(`${n}`);o&&(yield*Kg(o,e))}for(let n of r.values()){let o=e.get(n);o&&(yield o)}yield t},Kg=function*(t,e){for(let r of Vi(t).proofs){let n=e.get(`${r}`);n&&(yield*Kg(n,e))}yield t},r2=t=>{let e=[];for(let n of t)e.push([n.cid.toString(),n]);let r=e.pop();if(r){let[,n]=r;return new rr(n,new Map(e))}else throw new RangeError("Empty DAG can not be turned into a delegation")},id=({root:t,blocks:e})=>new rr(t,e),qi=({root:t,blocks:e},r)=>{let n=Yt(t,e,null);return n==null?r!==void 0?r:Dt(t):id({root:n,blocks:e})},n2=t=>{let e=[],{root:r,blocks:n}=t;for(let o of Vi(r).proofs){let s=n.get(o.toString());e.push(s?id({root:s,blocks:n}):o)}return Object.defineProperty(t,"proofs",{value:e}),e};function o2(t){let e=[];function r(n){for(let o in n){let s=n[o];Se(s)?e.push(s):s&&typeof s=="object"&&r(s)}}return r(t),e}var Rr={};C(Rr,{Invocation:()=>Wi,create:()=>Jg,invoke:()=>Bo,isInvocation:()=>s2,view:()=>_o});var s2=t=>Ct(t),Bo=t=>new ad(t),Jg=({root:t,blocks:e})=>new Wi(t,e),_o=({root:t,blocks:e},r)=>{let n=Yt(t,e,null);return n==null?r!==void 0?r:Dt(t):Jg({root:n,blocks:e})},ad=class{constructor({issuer:e,audience:r,capability:n,proofs:o=[],expiration:s,lifetimeInSeconds:i,notBefore:a,nonce:c,facts:u=[]}){this.issuer=e,this.audience=r,this.proofs=o,this.capabilities=[n],this.expiration=s,this.lifetimeInSeconds=i,this.notBefore=a,this.nonce=c,this.facts=u,this.attachedBlocks=new Map}attach(e){this.attachedBlocks.set(`${e.cid}`,e)}delegate(){return Or(this)}buildIPLDView(){return Or(this)}async execute(e){let r=this,[n]=await e.execute(r);return n}},Wi=class extends rr{};var ht={};C(ht,{MessageSchema:()=>Zg,build:()=>c2,view:()=>f2});var nr={};C(nr,{issue:()=>a2,view:()=>Ki});var Ki=({root:t,blocks:e},r)=>{let n=Yt(t,e,null);if(n==null)return r!==void 0?r:Dt(t);let o=ke(n.bytes);return new Gi({root:{...n,data:o},store:e})},Gi=class{constructor({root:e,store:r,ran:n,issuer:o,signature:s,proofs:i}){this.store=r,this.root=e,this._ran=n,this._fx=void 0,this._signature=s,this._proofs=i,this._issuer=o}get ran(){let e=this._ran;if(e)return e;{let r=_o({root:this.root.data.ocm.ran,blocks:this.store},this.root.data.ocm.ran);return this._ran=r,r}}get proofs(){let e=this._proofs;if(e)return e;{let{store:r,root:n}=this,{prf:o}=n.data.ocm,s=[];if(o)for(let i of o){let a=qi({root:i,blocks:r},i);s.push(a)}return this._proofs=s,s}}link(){return this.root.cid}get meta(){return this.root.data.ocm.meta}get issuer(){let e=this._issuer;if(e)return e;{let{iss:r}=this.root.data.ocm;if(r){let n=se(r);return this._issuer=n,n}}}get out(){return this.root.data.ocm.out}get fx(){let e=this._fx;if(!e){let{store:r}=this,{fork:n,join:o}=this.root.data.ocm.fx;e={fork:n.map(s=>_o({root:s,blocks:r},s))},o&&(e.join=_o({root:o,blocks:r},o)),this._fx=e}return e}get signature(){let e=this._signature;if(e)return e;{let r=yi(this.root.data.sig);return this._signature=r,r}}verifySignature(e){return this.signature.verify(e,Lr(this.root.data.ocm))}buildIPLDView(){return this}*iterateIPLDBlocks(){let{ran:e,fx:r,proofs:n,root:o}=this;yield*It(e);for(let s of r.fork)yield*It(s);r.join&&(yield*It(r.join));for(let s of n)yield*It(s);yield o}},cd=class{constructor({issuer:e,result:r,ran:n,fx:o=i2,proofs:s=[],meta:i={}}){this.issuer=e,this.result=r,this.ran=n,this.fx=o,this.proofs=s,this.meta=i}async buildIPLDView({hasher:e=Ie,codec:r=tt}={}){let n=kg();En(It(this.ran),n);let o=[];for(let d of this.proofs)En(It(d),n),o.push(d.link());let s={fork:[]};for(let d of this.fx.fork)En(It(d),n),s.fork.push(d.link());this.fx.join&&(En(It(this.fx.join),n),s.join=this.fx.join.link());let i={ran:this.ran.link(),out:this.result,fx:s,meta:this.meta,iss:this.issuer.did(),prf:o},a=await this.issuer.sign(Lr(i)),u=await vi({ocm:i,sig:a},n,{hasher:e,codec:r});return new Gi({root:u,store:n,signature:a,proofs:this.proofs,ran:this.ran})}},i2=Object.freeze({fork:Object.freeze([])}),a2=t=>new cd(t).buildIPLDView();var Zg=Do({"ucanto/message@7.0.0":Pi({execute:Lt().array().optional(),delegate:Zu({key:_t(),value:Lt()}).array().optional()})}),c2=({invocations:t,receipts:e})=>new fd({invocations:t,receipts:e}).buildIPLDView(),f2=({root:t,store:e},r)=>{let n=Yt(t,e,null);if(n===null)return r!==void 0?r:Dt(t);let o=tt.decode(n.bytes),[s,i]=Zg.match(o,r);switch(s){case"ucanto/message@7.0.0":return new Ji({root:{...n,data:o},store:e});default:return i}},fd=class{constructor({invocations:e,receipts:r}){this.invocations=e,this.receipts=r}async buildIPLDView(e){let r=new Map,{invocations:n,...o}=await u2(this.invocations||[],r),{receipts:s,...i}=await d2(this.receipts||[],r),a=await vi({"ucanto/message@7.0.0":{...o,...i}},r,e);return new Ji({root:a,store:r},{receipts:s,invocations:n})}},u2=async(t,e)=>{let r=[],n=[];for(let o of t){let s=await o.buildIPLDView();n.push(s.link()),r.push(s);for(let i of s.iterateIPLDBlocks())e.set(`${i.cid}`,i)}return{invocations:r,...n.length>0?{execute:n}:{}}},d2=async(t,e)=>{if(t.length===0)return{};let r=new Map,n={};for(let[o,s]of t.entries()){let i=await s.buildIPLDView();for(let c of i.iterateIPLDBlocks())e.set(`${c.cid}`,c);let a=`${i.ran.link()}`;a in n?r.set(`${a}@${o}`,i):(n[a]=i.root.cid,r.set(a,i))}return{receipts:r,report:n}},Ji=class{constructor({root:e,store:r},{invocations:n,receipts:o}={}){this.root=e,this.store=r,this._invocations=n,this._receipts=o}*iterateIPLDBlocks(){for(let e of this.invocations)yield*e.iterateIPLDBlocks();for(let e of this.receipts.values())yield*e.iterateIPLDBlocks();yield this.root}get(e,r){let o=(this.root.data["ucanto/message@7.0.0"].report||{})[`${e}`];return o?Ki({root:o,blocks:this.store}):r!==void 0?r:_g(`Message does not include receipt for ${e}`)}get invocationLinks(){return this.root.data["ucanto/message@7.0.0"].execute||[]}get invocations(){let e=this._invocations;return e||(e=this.invocationLinks.map(r=>Rr.view({root:r,blocks:this.store}))),e}get receipts(){let e=this._receipts;if(!e){e=new Map;let r=this.root.data["ucanto/message@7.0.0"].report||{};for(let[n,o]of Object.entries(r)){let s=Ki({root:o,blocks:this.store});e.set(`${s.ran.link()}`,s)}}return e}};var pt=t=>new ud(t),ud=class{constructor(e){this.id=e.id,this.options=e,this.codec=e.codec,this.channel=e.channel,this.hasher=e.hasher||Ie}async execute(...e){return l2(e,this)}},l2=async(t,e)=>{let r=await ht.build({invocations:t}),n=await e.codec.encode(r,e),o=await e.channel.request(n);try{let s=await e.codec.decode(o);return r.invocationLinks.map(a=>s.get(a))}catch(s){let{message:i,name:a="Error",...c}=s,u=[];for await(let d of r.invocationLinks){let h=await nr.issue({ran:d,result:{error:{...c,name:a,message:i}},issuer:{did(){return e.id.did()},sign(){return Xe.createNonStandard("",new Uint8Array)}}});u.push(h)}return u}};var u3=Pr.delegate;var ye={};C(ye,{codec:()=>X,contentType:()=>Qi,inbound:()=>k2,outbound:()=>v2,request:()=>Nr,response:()=>$r});var Nr={};C(Nr,{codec:()=>X,contentType:()=>Tn,decode:()=>m2,encode:()=>p2});var Tn=X.contentType,h2=Object.freeze({"content-type":Tn,accept:Tn}),p2=(t,e)=>{let r=new Map;for(let o of t.iterateIPLDBlocks())r.set(`${o.cid}`,o);let n=X.encode({roots:[t.root],blocks:r});return{headers:e?.headers||{...h2},body:n}},m2=async({headers:t,body:e})=>{let{roots:r,blocks:n}=X.decode(e);return ht.view({root:r[0].cid,store:n})};var $r={};C($r,{codec:()=>X,contentType:()=>Lo,decode:()=>w2,encode:()=>y2});var Lo=X.contentType,g2=Object.freeze({"content-type":Lo}),y2=(t,e)=>{let r=new Map;for(let o of t.iterateIPLDBlocks())r.set(`${o.cid}`,o);let n=X.encode({roots:[t.root],blocks:r});return{headers:{...g2},body:n}},w2=async({headers:t,body:e})=>{let{roots:r,blocks:n}=X.decode(e);return ht.view({root:r[0].cid,store:n})};var Zi=t=>new dd(t),dd=class{accept({headers:e}){let r=e["content-type"]||e["Content-Type"],n=this.decoders[r];if(!n)return{error:{status:415,message:"The server cannot process the request because the payload format is not supported. Please check the content-type header and try again with a supported media type.",headers:{accept:Object.keys(this.decoders).join(", ")}}};let o=b2(e.accept||e.Accept||"*/*");for(let{category:s,type:i}of o)for(let a of this.encoders)if((s==="*"||s===a.category)&&(i==="*"||i===a.type))return{ok:{...a,decoder:n}};return{error:{status:406,message:"The requested resource cannot be served in the requested content type. Please specify a supported content type using the Accept header.",headers:{accept:Yg(Object.values(this.encoders))}}}}constructor({decoders:e={},encoders:r={}}){if(this.decoders=e,Object.keys(e).length===0)throw new Error("At least one decoder MUST be provided");if(this.encoders=Object.entries(r).map(([n,o])=>({...hd(n),encoder:o})).sort((n,o)=>o.preference-n.preference),this.encoders.length===0)throw new Error("At least one encoder MUST be provided")}},Qg=t=>new ld(t),ld=class{constructor({decoders:e={},encoders:r={}}){if(this.decoders=e,Object.keys(e).length===0)throw new Error("At least one decoder MUST be provided");if(this.encoders=Object.entries(r).map(([n,o])=>({...hd(n),encoder:o})).sort((n,o)=>o.preference-n.preference),this.acceptType=Yg(this.encoders),this.encoders.length===0)throw new Error("At least one encoder MUST be provided");this.encoder=this.encoders[0].encoder}encode(e){return this.encoder.encode(e,{accept:this.acceptType})}decode(e){let{headers:r}=e,n=r["content-type"]||r["Content-Type"],o=this.decoders[n]||this.decoders["*/*"];switch(e.status){case 415:case 406:throw Object.assign(new RangeError(new TextDecoder().decode(e.body)),{status:e.status,headers:e.headers})}if(!o)throw Object.assign(TypeError(`Can not decode response with content-type '${n}' because no matching transport decoder is configured.`),{error:!0});return o.decode(e)}},hd=t=>{let[e="*/*",r=""]=t.trim().split(";"),[n="*",o="*"]=e.split("/"),s=new URLSearchParams(r),i=parseFloat(s.get("q")||"0");return{category:n,type:o,preference:isNaN(i)?0:i}},x2=({category:t,type:e,preference:r})=>`${t}/${e}${r?`;q=${r}`:""}`,b2=t=>t.split(",").map(hd).sort((e,r)=>r.preference-e.preference),Yg=t=>t.map(x2).join(", ");var Qi=X.contentType,k2=Zi({decoders:{[Tn]:Nr},encoders:{[Lo]:$r}}),v2=Qg({encoders:{[Tn]:Nr},decoders:{[Lo]:$r}});var Ke={};C(Ke,{open:()=>S2});var S2=({url:t,method:e="POST",fetch:r})=>{if(!r)if(typeof globalThis.fetch<"u")r=globalThis.fetch.bind(globalThis);else throw new TypeError("ucanto HTTP transport got undefined `fetch`. Try passing in a `fetch` implementation explicitly.");return new md({url:t,method:e,fetch:r})},md=class{constructor({url:e,fetch:r,method:n}){this.fetch=r,this.method=n,this.url=e}async request({headers:e,body:r}){let n=await this.fetch(this.url.href,{headers:e,body:r,method:this.method}),o=n.ok?await n.arrayBuffer():gd.throw(`HTTP Request failed. ${this.method} ${this.url.href} \u2192 ${n.status}`,n);return{headers:n.headers.entries?Object.fromEntries(n.headers.entries()):{},body:new Uint8Array(o)}}},gd=class extends Error{static throw(e,r){throw new this(e,r)}constructor(e,{url:r,status:n=500,statusText:o="Server error"}){super(e),this.name="HTTPError",this.url=r,this.status=n,this.statusText=o}};var y3=new TextEncoder,w3=new TextDecoder;var yd={};C(yd,{contentType:()=>Xg,encode:()=>T2});var Xg="application/cbor",A2=Object.freeze({"content-type":Xg}),T2=(t,e)=>{let r=[];for(let o of t.receipts.values()){let s=o.out;s.ok?r.push(s.ok):r.push({...s.error,error:!0})}let n=Lr(r);return{headers:A2,body:n}};var Yi={};C(Yi,{contentType:()=>I2,decode:()=>D2});var I2="application/car",D2=async({body:t})=>{let{roots:e,blocks:r}=Ao(t),n=[];for(let{cid:s}of e){let i=Rr.view({root:s,blocks:r});n.push(i)}return await ht.build({invocations:n})};var{contentType:B2}=Yi;var b3=Zi({decoders:{[B2]:Yi,[Qi]:Nr},encoders:{"*/*;q=0.1":yd,[Qi]:$r}});var Co=t=>t,ey=t=>Object.entries(t),ty=([t,...e])=>{let r=t.map(n=>[n]);for(let n of e){let o=r.splice(0);for(let s of n)for(let i of o)r.push([...i,s])}return r},wd=(t,e)=>{let[r,n]=t.length<e.length?[new Set(t),new Set(e)]:[new Set(e),new Set(t)];for(let o of r)n.has(o)||r.delete(o);return[...r]};var Uo=class extends $e{constructor(e,r,n){super(),this.claimed=e,this.delegated=r,this.cause=n,this.name=Co("EscalatedCapability")}describe(){return`Constraint violation: ${this.cause.message}`}},Ut=class extends $e{constructor(e,r){super(),this.name=Co("InvalidClaim"),this.causes=e,this.context=r}describe(){return[`Can not derive ${this.context} from delegated capabilities:`,...this.causes.map(e=>xd(e.message))].join(`
`)}get cause(){if(this.causes.length!==1)return this;{let[e]=this.causes,r=e.name==="InvalidClaim"?e.cause:e;return Object.defineProperties(this,{cause:{value:r}}),r}}};var or=class extends $e{constructor(e,r){super(),this.name=Co("MalformedCapability"),this.capability=e,this.cause=r}describe(){return[`Encountered malformed '${this.capability.can}' capability: ${ry(this.capability)}`,xd(this.cause.message)].join(`
`)}},In=class extends $e{constructor(e){super(),this.name=Co("UnknownCapability"),this.capability=e}describe(){return`Encountered unknown capability: ${ry(this.capability)}`}};var ry=(t,e)=>JSON.stringify(t,(r,n)=>Se(n)?n.toString():n,e),L2=(t,e="  ")=>`${e}${t.split(`
`).join(`
${e}`)}`,xd=t=>L2(`- ${t}`);var N=({derives:t=j2,nb:e=C2,...r})=>new bd({derives:t,nb:e,...r}),C2=x.struct({}),U2=(t,e)=>new kd(t,e),O2=(...t)=>new vd(t),P2=({from:t,to:e,derives:r})=>new Sd(t,e,r),Xi=class{match(e){return{error:new In(e.capability)}}select(e){return M2(this,e)}derive({derives:e,to:r}){return P2({derives:e,to:r,from:this})}},Oo=class extends Xi{or(e){return U2(this,e)}and(e){return O2(this,e)}},bd=class extends Oo{constructor(e){super(),this.descriptor=e,this.schema=x.struct({can:x.literal(e.can),with:e.with,nb:e.nb})}create(e){let{descriptor:r,can:n}=this,o=r.nb,s=e.nb||{},i=r.with.read(e.with);if(i.error)throw Object.assign(new Error(`Invalid 'with' - ${i.error.message}`),{cause:i});let a=r.nb.read(s);if(a.error)throw Object.assign(new Error(`Invalid 'nb' - ${a.error.message}`),{cause:a});return ny({can:n,with:i.ok,nb:a.ok})}invoke({with:e,nb:r,...n}){return Bo({...n,capability:this.create({with:e,nb:r})})}async delegate({nb:e={},with:r,...n}){let{descriptor:o,can:s}=this,i=o.nb,a=o.with.read(r);if(a.error)throw Object.assign(new Error(`Invalid 'with' - ${a.error.message}`),{cause:a});let c=o.nb.partial().read(e);if(c.error)throw Object.assign(new Error(`Invalid 'nb' - ${c.error.message}`),{cause:c});return Or({capabilities:[ny({can:s,with:a.ok,nb:c.ok})],...n})}get can(){return this.descriptor.can}match(e){let r=z2(this.descriptor,e);return r.error?r:{ok:new Ed(e,r.ok,this.descriptor)}}toString(){return JSON.stringify({can:this.descriptor.can})}},ny=({can:t,with:e,nb:r})=>({can:t,with:e,...R2(r)?{}:{nb:r}}),R2=t=>{for(let e in t)return!1;return!0},kd=class extends Oo{constructor(e,r){super(),this.left=e,this.right=r}match(e){let r=this.left.match(e);if(r.error){let n=this.right.match(e);return n.error?n.error.name==="MalformedCapability"?n:r:n}else return r}toString(){return`${this.left.toString()}|${this.right.toString()}`}},vd=class t extends Xi{constructor(e){super(),this.selectors=e}match(e){let r=[];for(let n of this.selectors){let o=n.match(e);if(o.error)return o;r.push(o.ok)}return{ok:new ea(r)}}select(e){return oy(this,e)}and(e){return new t([...this.selectors,e])}toString(){return`[${this.selectors.map(String).join(", ")}]`}},Sd=class extends Oo{constructor(e,r,n){super(),this.from=e,this.to=r,this.derives=n}create(e){return this.to.create(e)}invoke(e){return this.to.invoke(e)}delegate(e){return this.to.delegate(e)}get can(){return this.to.can}match(e){let r=this.to.match(e);return r.error?r:{ok:new Ad(r.ok,this.from,this.derives)}}toString(){return this.to.toString()}},Ed=class t{constructor(e,r,n){this.source=[e],this.value=r,this.descriptor=n}get can(){return this.value.can}get proofs(){let e=[this.source[0].delegation];return Object.defineProperties(this,{proofs:{value:e}}),e}prune(e){return e.canIssue(this.value,this.source[0].delegation.issuer.did())?null:this}select(e){let r=[],n=[],o=[];for(let s of e){let i=F2(this.descriptor,this.value,s);if(i.ok){let a=this.descriptor.derives(this.value,i.ok);a.error?n.push(new Ut([new Uo(this.value,i.ok,a.error)],this)):o.push(new t(s,i.ok,this.descriptor))}else switch(i.error.name){case"UnknownCapability":r.push(i.error.capability);break;case"MalformedCapability":default:n.push(new Ut([i.error],this))}}return{matches:o,unknown:r,errors:n}}toString(){let{nb:e}=this.value;return JSON.stringify({can:this.descriptor.can,with:this.value.with,nb:e&&Object.keys(e).length>0?e:void 0})}},Ad=class t{constructor(e,r,n){this.selected=e,this.from=r,this.derives=n}get can(){return this.value.can}get source(){return this.selected.source}get proofs(){let e=[];for(let{delegation:r}of this.selected.source)e.push(r);return Object.defineProperties(this,{proofs:{value:e}}),e}get value(){return this.selected.value}prune(e){let r=this.selected.prune(e);return r?new t(r,this.from,this.derives):null}select(e){let{derives:r,selected:n,from:o}=this,{value:s}=n,i=n.select(e),a=o.select(e),c=[],u=[];for(let d of a.matches){let h=r(s,d.value);h.error?u.push(new Ut([new Uo(s,d.value,h.error)],this)):c.push(d)}return{unknown:wd(i.unknown,a.unknown),errors:[...u,...i.errors,...a.errors.map(d=>new Ut([d],this))],matches:[...i.matches.map(d=>new t(d,o,r)),...c]}}toString(){return this.selected.toString()}},ea=class t{constructor(e){this.matches=e}get selectors(){return this.matches}get source(){let e=[];for(let r of this.matches)e.push(...r.source);return Object.defineProperties(this,{source:{value:e}}),e}prune(e){let r=[];for(let n of this.matches){let o=n.prune(e);o&&r.push(o)}return r.length===0?null:new t(r)}get proofs(){let e=[];for(let{delegation:r}of this.source)e.push(r);return Object.defineProperties(this,{proofs:{value:e}}),e}get value(){let e=[];for(let r of this.matches)e.push(r.value);return Object.defineProperties(this,{value:{value:e}}),e}select(e){return oy(this,e)}toString(){return`[${this.matches.map(e=>e.toString()).join(", ")}]`}},N2=(t,e,r)=>{switch(t){case e:case"*":return e;default:return t.endsWith("/*")&&e.startsWith(t.slice(0,-1))?e:r}},$2=(t,e,r)=>{switch(t){case e:case"ucan:*":return e;default:return r}},z2=(t,e)=>{let{delegation:r}=e,n=e.capability;if(t.can!==n.can)return{error:new In(n)};let o=t.with.read(n.with);if(o.error)return{error:new or(n,o.error)};let s=t.nb.read(n.nb||{});return s.error?{error:new or(n,s.error)}:{ok:new ta(t.can,o.ok,s.ok,r)}},F2=(t,e,{capability:r,delegation:n})=>{let o=N2(r.can,e.can,null);if(o==null)return{error:new In(r)};let s=$2(r.with,e.with,r.with),i=t.with.read(s);if(i.error)return{error:new or(r,i.error)};let a=t.nb.read({...e.nb,...r.nb});return a.error?{error:new or(r,a.error)}:{ok:new ta(o,i.ok,a.ok,n)}},ta=class{constructor(e,r,n,o){this.can=e,this.with=r,this.delegation=o,this.nb=n}},M2=(t,e)=>{let r=[],n=[],o=[];for(let s of e){let i=t.match(s);if(i.error)switch(i.error.name){case"UnknownCapability":r.push(i.error.capability);break;case"MalformedCapability":default:o.push(new Ut([i.error],i.error.capability))}else n.push(i.ok)}return{matches:n,errors:o,unknown:r}},oy=(t,e)=>{let r,n=[],o=[];for(let i of t.selectors){let a=i.select(e);r=r?wd(r,a.unknown):a.unknown;for(let c of a.errors)o.push(new Ut([c],t));n.push(a.matches)}let s=ty(n).map(i=>new ea(i));return{unknown:r||[],errors:o,matches:s}},j2=(t,e)=>{if(e.with.endsWith("*")){if(!t.with.startsWith(e.with.slice(0,-1)))return x.error(`Resource ${t.with} does not match delegated ${e.with} `)}else if(e.with!==t.with)return x.error(`Resource ${t.with} is not contained by ${e.with}`);let r=e.nb||{},n=t.nb||{},o=ey(r);for(let[s,i]of o)if(n[s]!=i)return x.error(`${String(s)}: ${n[s]} violates ${i}`);return{ok:!0}};var V2=4113,q2=85,ze=x.link({code:q2,version:1,multihash:{code:V2}});function Ot(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}var eC=Ur.match({method:"web"}),P=Ur.match({method:"key"}),tC=Ur.match({method:"mailto"}),Po=x.struct({"ucan/await":x.tuple([x.string(),x.link()])});function M(t,e){return t.with===e.with?O({}):ne(`Can not derive ${t.can} with ${t.with} from ${e.with}`)}function fe(t,e,r){return e===void 0||e==="*"?O({}):String(t)===String(e)?O({}):ne(`Constrain violation: ${t} violates imposed ${r} constraint ${e}`)}var ra=(t,e)=>t.with!==e.with?ne(`Expected 'with: "${e.with}"' instead got '${t.with}'`):e.nb.link&&`${e.nb.link}`!=`${t.nb.link}`?ne(`Link ${t.nb.link?`${t.nb.link}`:""} violates imposed ${e.nb.link} constraint.`):O({}),Ro=(t,e)=>t.with!==e.with?ne(`Expected 'with: "${e.with}"' instead got '${t.with}'`):e.nb.blob.digest&&!Ot(e.nb.blob.digest,t.nb.blob.digest)?ne(`Link ${t.nb.blob.digest?`${t.nb.blob.digest}`:""} violates imposed ${e.nb.blob.digest} constraint.`):t.nb.blob.size!==void 0&&e.nb.blob.size!==void 0?t.nb.blob.size>e.nb.blob.size?ne(`Size constraint violation: ${t.nb.blob.size} > ${e.nb.blob.size}`):O({}):O({}),sy=(t,e)=>t.with!==e.with?ne(`Expected 'with: "${e.with}"' instead got '${t.with}'`):e.nb.body.digest&&!Ot(e.nb.body.digest,t.nb.body.digest)?ne(`Link ${t.nb.body.digest?`${t.nb.body.digest}`:""} violates imposed ${e.nb.body.digest} constraint.`):t.nb.body.size!==void 0&&e.nb.body.size!==void 0?t.nb.body.size>e.nb.body.size?ne(`Size constraint violation: ${t.nb.body.size} > ${e.nb.body.size}`):O({}):O({});var Y=(t,e,r)=>fe(String(t),e===void 0?void 0:String(e),r),_=t=>t.error?t:void 0;var iy=N({can:"filecoin/offer",with:x.did(),nb:x.struct({content:x.link(),piece:ze}),derives:(t,e)=>_(M(t,e))||_(Y(t.nb.content,e.nb.content,"nb.content"))||_(Y(t.nb.piece,e.nb.piece,"nb.piece"))||O({})}),ay=N({can:"filecoin/submit",with:x.did(),nb:x.struct({content:x.link(),piece:ze}),derives:(t,e)=>_(M(t,e))||_(Y(t.nb.content,e.nb.content,"nb.content"))||_(Y(t.nb.piece,e.nb.piece,"nb.piece"))||O({})}),cy=N({can:"filecoin/accept",with:x.did(),nb:x.struct({content:x.link(),piece:ze}),derives:(t,e)=>_(M(t,e))||_(Y(t.nb.content,e.nb.content,"nb.content"))||_(Y(t.nb.piece,e.nb.piece,"nb.piece"))||O({})}),fy=N({can:"filecoin/info",with:x.did(),nb:x.struct({piece:ze}),derives:(t,e)=>_(M(t,e))||_(Y(t.nb.piece,e.nb.piece,"nb.piece"))||O({})});var Ee={STOREFRONT:{url:new URL("https://up.web3.storage"),principal:se("did:web:web3.storage")},AGGREGATOR:{url:new URL("https://aggregator.web3.storage"),principal:se("did:web:web3.storage")},DEALER:{url:new URL("https://dealer.web3.storage"),principal:se("did:web:web3.storage")},DEAL_TRACKER:{url:new URL("https://tracker.web3.storage"),principal:se("did:web:web3.storage")}};var No=pt({id:Ee.STOREFRONT.principal,codec:ye.outbound,channel:Ke.open({url:Ee.STOREFRONT.url,method:"POST"})});async function G2({issuer:t,with:e,proofs:r,audience:n},o,s,i={}){let a=i.connection??No;return await iy.invoke({issuer:t,audience:n??Ee.STOREFRONT.principal,with:e,nb:{content:o,piece:s},proofs:r,expiration:1/0}).execute(a)}async function K2({issuer:t,with:e,proofs:r,audience:n},o,s,i={}){let a=i.connection??No;return await ay.invoke({issuer:t,audience:n??Ee.STOREFRONT.principal,with:e,nb:{content:o,piece:s},proofs:r,expiration:1/0}).execute(a)}async function J2({issuer:t,with:e,proofs:r,audience:n},o,s,i={}){let a=i.connection??No;return await cy.invoke({issuer:t,audience:n??Ee.STOREFRONT.principal,with:e,nb:{content:o,piece:s},proofs:r,expiration:1/0}).execute(a)}async function Z2({issuer:t,with:e,proofs:r,audience:n},o,s={}){let i=s.connection??No;return await fy.invoke({issuer:t,audience:n??Ee.STOREFRONT.principal,with:e,nb:{piece:o},proofs:r}).execute(i)}var Q2=N({can:"piece/offer",with:x.did(),nb:x.struct({piece:ze,group:x.text()}),derives:(t,e)=>_(M(t,e))||_(Y(t.nb.piece,e.nb.piece,"nb.piece"))||_(fe(t.nb.group,e.nb.group,"nb.group"))||O({})}),Y2=N({can:"piece/accept",with:x.did(),nb:x.struct({piece:ze,group:x.text()}),derives:(t,e)=>_(M(t,e))||_(Y(t.nb.piece,e.nb.piece,"nb.piece"))||_(fe(t.nb.group,e.nb.group,"nb.group"))||O({})});var gC=pt({id:Ee.AGGREGATOR.principal,codec:ye.outbound,channel:Ke.open({url:Ee.AGGREGATOR.url,method:"POST"})});var tE=N({can:"aggregate/offer",with:x.did(),nb:x.struct({aggregate:ze,pieces:x.link({version:1})}),derives:(t,e)=>_(M(t,e))||_(Y(t.nb.aggregate,e.nb.aggregate,"nb.aggregate"))||_(Y(t.nb.pieces,e.nb.pieces,"nb.pieces"))||O({})}),rE=N({can:"aggregate/accept",with:x.did(),nb:x.struct({aggregate:ze,pieces:x.link()}),derives:(t,e)=>_(M(t,e))||_(Y(t.nb.aggregate,e.nb.aggregate,"nb.aggregate"))||_(Y(t.nb.pieces,e.nb.pieces,"nb.pieces"))||O({})});var EC=pt({id:Ee.DEALER.principal,codec:ye.outbound,channel:Ke.open({url:Ee.DEALER.url,method:"POST"})});var sE=N({can:"deal/info",with:x.did(),nb:x.struct({piece:ze}),derives:(t,e)=>_(M(t,e))||_(Y(t.nb.piece,e.nb.piece,"nb.piece"))||O({})});var LC=pt({id:Ee.DEAL_TRACKER.principal,codec:ye.outbound,channel:Ke.open({url:Ee.DEAL_TRACKER.url,method:"POST"})});function cE(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<t.length;o++){var s=t.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";for(var m=0,D=0,g=0,y=l.length;g!==y&&l[g]===0;)g++,m++;for(var S=(y-g)*d+1>>>0,v=new Uint8Array(S);g!==y;){for(var A=l[g],B=0,E=S-1;(A!==0||B<D)&&E!==-1;E--,B++)A+=256*v[E]>>>0,v[E]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");D=B,g++}for(var U=S-D;U!==S&&v[U]===0;)U++;for(var oe=c.repeat(m);U<S;++U)oe+=t.charAt(v[U]);return oe}function w(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;var m=0;if(l[m]!==" "){for(var D=0,g=0;l[m]===c;)D++,m++;for(var y=(l.length-m)*u+1>>>0,S=new Uint8Array(y);l[m];){var v=r[l.charCodeAt(m)];if(v===255)return;for(var A=0,B=y-1;(v!==0||A<g)&&B!==-1;B--,A++)v+=a*S[B]>>>0,S[B]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");g=A,m++}if(l[m]!==" "){for(var E=y-g;E!==y&&S[E]===0;)E++;for(var U=new Uint8Array(D+(y-E)),oe=D;E!==y;)U[oe++]=S[E++];return U}}}function f(l){var m=w(l);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:w,decode:f}}var fE=cE,uE=fE,uy=uE;var OC=new Uint8Array(0);var dy=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0},Pt=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};var Td=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Id=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ly(this,e)}},Dd=class{constructor(e){this.decoders=e}or(e){return ly(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},ly=(t,e)=>new Dd({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}}),Bd=class{constructor(e,r,n,o){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Td(e,r,n),this.decoder=new Id(e,r,o)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},hy=({name:t,prefix:e,encode:r,decode:n})=>new Bd(t,e,r,n),_d=({prefix:t,name:e,alphabet:r})=>{let{encode:n,decode:o}=uy(r,e);return hy({prefix:t,name:e,encode:n,decode:s=>Pt(o(s))})},dE=(t,e,r,n)=>{let o={};for(let d=0;d<e.length;++d)o[e[d]]=d;let s=t.length;for(;t[s-1]==="=";)--s;let i=new Uint8Array(s*r/8|0),a=0,c=0,u=0;for(let d=0;d<s;++d){let h=o[t[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,i[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return i},lE=(t,e,r)=>{let n=e[e.length-1]==="=",o=(1<<r)-1,s="",i=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],i+=8;i>r;)i-=r,s+=e[o&a>>i];if(i&&(s+=e[o&a<<r-i]),n)for(;s.length*r&7;)s+="=";return s},mt=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>hy({prefix:e,name:t,encode(o){return lE(o,n,r)},decode(o){return dE(o,n,r,t)}});var $o=mt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),FC=mt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),MC=mt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),jC=mt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),HC=mt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),VC=mt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),qC=mt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),WC=mt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),GC=mt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Rt=_d({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ZC=_d({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var hE=gy,py=128,pE=127,mE=~pE,gE=Math.pow(2,31);function gy(t,e,r){e=e||[],r=r||0;for(var n=r;t>=gE;)e[r++]=t&255|py,t/=128;for(;t&mE;)e[r++]=t&255|py,t>>>=7;return e[r]=t|0,gy.bytes=r-n+1,e}var yE=Ld,wE=128,my=127;function Ld(t,n){var r=0,n=n||0,o=0,s=n,i,a=t.length;do{if(s>=a)throw Ld.bytes=0,new RangeError("Could not decode varint");i=t[s++],r+=o<28?(i&my)<<o:(i&my)*Math.pow(2,o),o+=7}while(i>=wE);return Ld.bytes=s-n,r}var xE=Math.pow(2,7),bE=Math.pow(2,14),kE=Math.pow(2,21),vE=Math.pow(2,28),SE=Math.pow(2,35),EE=Math.pow(2,42),AE=Math.pow(2,49),TE=Math.pow(2,56),IE=Math.pow(2,63),DE=function(t){return t<xE?1:t<bE?2:t<kE?3:t<vE?4:t<SE?5:t<EE?6:t<AE?7:t<TE?8:t<IE?9:10},BE={encode:hE,decode:yE,encodingLength:DE},_E=BE,zo=_E;var Fo=(t,e=0)=>[zo.decode(t,e),zo.decode.bytes],Dn=(t,e,r=0)=>(zo.encode(t,e,r),e),Bn=t=>zo.encodingLength(t);var Mo=(t,e)=>{let r=e.byteLength,n=Bn(t),o=n+Bn(r),s=new Uint8Array(o+r);return Dn(t,s,0),Dn(r,s,n),s.set(e,o),new _n(t,r,e,s)},wy=t=>{let e=Pt(t),[r,n]=Fo(e),[o,s]=Fo(e.subarray(n)),i=e.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new _n(r,o,i,e)},xy=(t,e)=>{if(t===e)return!0;{let r=e;return t.code===r.code&&t.size===r.size&&r.bytes instanceof Uint8Array&&dy(t.bytes,r.bytes)}},_n=class{constructor(e,r,n,o){this.code=e,this.size=r,this.digest=n,this.bytes=o}};var Cd=(t,e)=>{let{bytes:r,version:n}=t;switch(n){case 0:return CE(r,Ud(t),e||Rt.encoder);default:return UE(r,Ud(t),e||$o.encoder)}};var ky=new WeakMap,Ud=t=>{let e=ky.get(t);if(e==null){let r=new Map;return ky.set(t,r),r}return e},oa=class t{constructor(e,r,n,o){this.code=r,this.version=e,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:r}=this;if(e!==jo)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==OE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return t.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,n=Mo(e,r);return t.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return t.equals(this,e)}static equals(e,r){let n=r;return n&&e.code===n.code&&e.version===n.version&&xy(e.multihash,n.multihash)}toString(e){return Cd(this,e)}toJSON(){return{"/":Cd(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let r=e;if(r instanceof t)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new t(n,o,s,i||vy(n,o,s.bytes))}else if(r[PE]===!0){let{version:n,multihash:o,code:s}=r,i=wy(o);return t.create(n,s,i)}else return null}static create(e,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(r!==jo)throw new Error(`Version 0 CID must use dag-pb (code: ${jo}) block encoding`);return new t(e,r,n,n.bytes)}case 1:{let o=vy(e,r,n.bytes);return new t(e,r,n,o)}default:throw new Error("Invalid version")}}static createV0(e){return t.create(0,jo,e)}static createV1(e,r){return t.create(1,e,r)}static decode(e){let[r,n]=t.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=t.inspectBytes(e),n=r.size-r.multihashSize,o=Pt(e.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new _n(r.multihashCode,r.digestSize,s,o);return[r.version===0?t.createV0(i):t.createV1(r.codec,i),e.subarray(r.size)]}static inspectBytes(e){let r=0,n=()=>{let[h,w]=Fo(e.subarray(r));return r+=w,h},o=n(),s=jo;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,a=n(),c=n(),u=r+c,d=u-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:d,size:u}}static parse(e,r){let[n,o]=LE(e,r),s=t.decode(o);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Ud(s).set(n,e),s}},LE=(t,e)=>{switch(t[0]){case"Q":{let r=e||Rt;return[Rt.prefix,r.decode(`${Rt.prefix}${t}`)]}case Rt.prefix:{let r=e||Rt;return[Rt.prefix,r.decode(t)]}case $o.prefix:{let r=e||$o;return[$o.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}},CE=(t,e,r)=>{let{prefix:n}=r;if(n!==Rt.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=e.get(n);if(o==null){let s=r.encode(t).slice(1);return e.set(n,s),s}else return o},UE=(t,e,r)=>{let{prefix:n}=r,o=e.get(n);if(o==null){let s=r.encode(t);return e.set(n,s),s}else return o},jo=112,OE=18,vy=(t,e,r)=>{let n=Bn(t),o=n+Bn(e),s=new Uint8Array(o+r.byteLength);return Dn(t,s,0),Dn(e,s,n),s.set(r,o),s},PE=Symbol.for("@ipld/js-cid/CID");var Ho=(t,e)=>oa.create(1,t,e);var Vo={};C(Vo,{code:()=>sa,decode:()=>zE,encode:()=>$E,name:()=>NE});var NE="raw",sa=85,$E=t=>Pt(t),zE=t=>Pt(t);var Pd=({name:t,code:e,encode:r})=>new Od(t,e,r),Od=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?Mo(this.code,r):r.then(n=>Mo(this.code,n))}else throw Error("Unknown type, must be binary type")}};var Sy=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Rd=Pd({name:"sha2-256",code:18,encode:Sy("SHA-256")}),hU=Pd({name:"sha2-512",code:19,encode:Sy("SHA-512")});var Ly={};C(Ly,{add:()=>KE,get:()=>JE,list:()=>ZE,remove:()=>QE});var FE=514,Nd=x.link({code:FE,version:1}),yU=N({can:"store/*",with:P,derives:M}),ia=N({can:"store/add",with:P,nb:x.struct({link:Nd,size:x.integer(),origin:Ge.optional()}),derives:(t,e)=>{let r=ra(t,e);return r.error?r:t.nb.size!==void 0&&e.nb.size!==void 0?t.nb.size>e.nb.size?ne(`Size constraint violation: ${t.nb.size} > ${e.nb.size}`):O({}):O({})}}),$d=N({can:"store/get",with:P,nb:x.struct({link:Nd.optional()}),derives:ra}),aa=N({can:"store/remove",with:P,nb:x.struct({link:Nd}),derives:ra}),ca=N({can:"store/list",with:P,nb:x.struct({cursor:x.string().optional(),size:x.integer().optional(),pre:x.boolean().optional()}),derives:(t,e)=>t.with!==e.with?ne(`Expected 'with: "${e.with}"' instead got '${t.with}'`):O({})}),wU=ia.or(aa).or(ca);var _y=Ht(Dy(),1),HE=new Set(["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed"]),rt=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},VE=(t,e,r)=>{let n=r.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=n,t},qE=t=>HE.has(t),By=t=>globalThis.DOMException===void 0?new Error(t):new DOMException(t);async function Ae(t,e){return new Promise((r,n)=>{e={onFailedAttempt(){},retries:10,...e};let o=_y.default.operation(e);o.attempt(async s=>{try{r(await t(s))}catch(i){if(!(i instanceof Error)){n(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof rt)o.stop(),n(i.originalError);else if(i instanceof TypeError&&!qE(i.message))o.stop(),n(i);else{VE(i,s,e);try{await e.onFailedAttempt(i)}catch(a){n(a);return}o.retry(i)||n(o.mainError())}}}),e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",()=>{o.stop();let s=e.signal.reason===void 0?By("The operation was aborted."):e.signal.reason;n(s instanceof Error?s:By(s))},{once:!0})})}var WE=new URL("https://up.web3.storage"),Z=se("did:web:web3.storage"),zd="https://up.web3.storage/receipt/",ee=pt({id:Z,codec:ye.outbound,channel:Ke.open({url:WE,method:"POST"})});function GE(t,e){function r({total:n,loaded:o,lengthComputable:s}){return e({total:n,loaded:o,lengthComputable:s,url:t})}return r}async function KE({issuer:t,with:e,proofs:r,audience:n},o,s={}){let i=o instanceof Uint8Array?o:new Uint8Array(await o.arrayBuffer()),a=await ye.codec.link(i),c=s.connection??ee,u=await Ae(async()=>await ia.invoke({issuer:t,audience:n??Z,with:P.from(e),nb:{link:a,size:i.length},proofs:r,nonce:s.nonce}).execute(c),{onFailedAttempt:console.warn,retries:s.retries??3});if(!u.out.ok)throw new Error(`failed ${ia.can} invocation`,{cause:u.out.error});if(u.out.ok.status==="done")return a;let d=u.out.ok,h=s.fetchWithUploadProgress||s.fetch||globalThis.fetch.bind(globalThis),w=!1,f=await Ae(async()=>{try{let l=await h(d.url,{method:"PUT",body:o,headers:d.headers,signal:s.signal,onUploadProgress:m=>{w=!0,s.onUploadProgress&&GE(d.url,s.onUploadProgress)(m)},duplex:"half"});if(l.status>=400&&l.status<500)throw new rt(`upload failed: ${l.status}`);return l}catch(l){throw s.signal?.aborted===!0?new rt("upload aborted"):l}},{retries:s.retries??3});if(!w&&s.onUploadProgress){let l=new Blob([o]);s.onUploadProgress({total:l.size,loaded:l.size,lengthComputable:!1})}if(!f.ok)throw new Error(`upload failed: ${f.status}`);return a}async function JE({issuer:t,with:e,proofs:r,audience:n},o,s={}){let i=s.connection??ee,a=await Ae(async()=>await $d.invoke({issuer:t,audience:n??Z,with:P.from(e),nb:{link:o},proofs:r,nonce:s.nonce}).execute(i),{onFailedAttempt:console.warn,retries:s.retries??3});if(!a.out.ok)throw new Error(`failed ${$d.can} invocation`,{cause:a.out.error});return a.out.ok}async function ZE({issuer:t,with:e,proofs:r,audience:n},o={}){let s=o.connection??ee,i=await ca.invoke({issuer:t,audience:n??Z,with:P.from(e),proofs:r,nb:{cursor:o.cursor,size:o.size,pre:o.pre},nonce:o.nonce}).execute(s);if(!i.out.ok)throw new Error(`failed ${ca.can} invocation`,{cause:i.out.error});return i.out.ok}async function QE({issuer:t,with:e,proofs:r,audience:n},o,s={}){let i=s.connection??ee,a=await aa.invoke({issuer:t,audience:n??Z,with:P.from(e),nb:{link:o},proofs:r,nonce:s.nonce}).execute(i);if(!a.out.ok)throw new Error(`failed ${aa.can} invocation`,{cause:a.out.error});return a.out}var kw={};C(kw,{add:()=>es,get:()=>ww,list:()=>xw,remove:()=>bw});var ba={};C(ba,{PUB_KEY_OFFSET:()=>tl,Signer:()=>sl,Verifier:()=>Ln,code:()=>jr,decode:()=>xa,derive:()=>rl,encode:()=>ol,format:()=>Xy,from:()=>nl,generate:()=>Yy,name:()=>Jy,or:()=>wa,parse:()=>ew,signatureAlgorithm:()=>el,signatureCode:()=>Zy});var sl={};C(sl,{PUB_KEY_OFFSET:()=>tl,code:()=>jr,decode:()=>xa,derive:()=>rl,encode:()=>ol,format:()=>Xy,from:()=>nl,generate:()=>Yy,name:()=>Jy,or:()=>wa,parse:()=>ew,signatureAlgorithm:()=>el,signatureCode:()=>Zy});Fc();var he=BigInt(0),V=BigInt(1),ar=BigInt(2),YE=BigInt(8),Cy=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),Q=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:Cy,n:Cy,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")});var Ny=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),qo=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),CU=BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),XE=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),eA=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),tA=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),rA=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),ue=class t{constructor(e,r,n,o){this.x=e,this.y=r,this.z=n,this.t=o}static fromAffine(e){if(!(e instanceof ie))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(ie.ZERO)?t.ZERO:new t(e.x,e.y,V,k(e.x*e.y))}static toAffineBatch(e){let r=sA(e.map(n=>n.z));return e.map((n,o)=>n.toAffine(r[o]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){Oy(e);let{x:r,y:n,z:o}=this,{x:s,y:i,z:a}=e,c=k(r*a),u=k(s*o),d=k(n*a),h=k(i*o);return c===u&&d===h}negate(){return new t(k(-this.x),this.y,this.z,k(-this.t))}double(){let{x:e,y:r,z:n}=this,{a:o}=Q,s=k(e*e),i=k(r*r),a=k(ar*k(n*n)),c=k(o*s),u=e+r,d=k(k(u*u)-s-i),h=c+i,w=h-a,f=c-i,l=k(d*w),m=k(h*f),D=k(d*f),g=k(w*h);return new t(l,m,g,D)}add(e){Oy(e);let{x:r,y:n,z:o,t:s}=this,{x:i,y:a,z:c,t:u}=e,d=k((n-r)*(a+i)),h=k((n+r)*(a-i)),w=k(h-d);if(w===he)return this.double();let f=k(o*ar*u),l=k(s*ar*c),m=l+f,D=h+d,g=l-f,y=k(m*w),S=k(D*g),v=k(m*g),A=k(w*D);return new t(y,S,A,v)}subtract(e){return this.add(e.negate())}precomputeWindow(e){let r=1+256/e,n=[],o=this,s=o;for(let i=0;i<r;i++){s=o,n.push(s);for(let a=1;a<2**(e-1);a++)s=s.add(o),n.push(s);o=s.double()}return n}wNAF(e,r){!r&&this.equals(t.BASE)&&(r=ie.BASE);let n=r&&r._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let o=r&&Vd.get(r);o||(o=this.precomputeWindow(n),r&&n!==1&&(o=t.normalizeZ(o),Vd.set(r,o)));let s=t.ZERO,i=t.BASE,a=1+256/n,c=2**(n-1),u=BigInt(2**n-1),d=2**n,h=BigInt(n);for(let w=0;w<a;w++){let f=w*c,l=Number(e&u);e>>=h,l>c&&(l-=d,e+=V);let m=f,D=f+Math.abs(l)-1,g=w%2!==0,y=l<0;l===0?i=i.add(Uy(g,o[m])):s=s.add(Uy(y,o[D]))}return t.normalizeZ([s,i])[0]}multiply(e,r){return this.wNAF(ua(e,Q.l),r)}multiplyUnsafe(e){let r=ua(e,Q.l,!1),n=t.BASE,o=t.ZERO;if(r===he)return o;if(this.equals(o)||r===V)return this;if(this.equals(n))return this.wNAF(r);let s=o,i=this;for(;r>he;)r&V&&(s=s.add(i)),i=i.double(),r>>=V;return s}isSmallOrder(){return this.multiplyUnsafe(Q.h).equals(t.ZERO)}isTorsionFree(){let e=this.multiplyUnsafe(Q.l/ar).double();return Q.l%ar&&(e=e.add(this)),e.equals(t.ZERO)}toAffine(e){let{x:r,y:n,z:o}=this,s=this.equals(t.ZERO);e==null&&(e=s?YE:da(o));let i=k(r*e),a=k(n*e),c=k(o*e);if(s)return ie.ZERO;if(c!==V)throw new Error("invZ was invalid");return new ie(i,a)}fromRistrettoBytes(){Md()}toRistrettoBytes(){Md()}fromRistrettoHash(){Md()}};ue.BASE=new ue(Q.Gx,Q.Gy,V,k(Q.Gx*Q.Gy));ue.ZERO=new ue(he,V,V,he);function Uy(t,e){let r=e.negate();return t?r:e}function Oy(t){if(!(t instanceof ue))throw new TypeError("ExtendedPoint expected")}function Fd(t){if(!(t instanceof Fr))throw new TypeError("RistrettoPoint expected")}function Md(){throw new Error("Legacy method: switch to RistrettoPoint")}var Fr=class t{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){let{d:r}=Q,n=k(qo*e*e),o=k((n+V)*tA),s=BigInt(-1),i=k((s-r*n)*k(n+r)),{isValid:a,value:c}=Wd(o,i),u=k(c*e);ir(u)||(u=k(-u)),a||(c=u),a||(s=n);let d=k(s*(n-V)*rA-i),h=c*c,w=k((c+c)*i),f=k(d*XE),l=k(V-h),m=k(V+h);return new ue(k(w*m),k(l*f),k(f*m),k(w*l))}static hashToCurve(e){e=cr(e,64);let r=jd(e.slice(0,32)),n=this.calcElligatorRistrettoMap(r),o=jd(e.slice(32,64)),s=this.calcElligatorRistrettoMap(o);return new t(n.add(s))}static fromHex(e){e=cr(e,32);let{a:r,d:n}=Q,o="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",s=jd(e);if(!aA(Go(s),e)||ir(s))throw new Error(o);let i=k(s*s),a=k(V+r*i),c=k(V-r*i),u=k(a*a),d=k(c*c),h=k(r*n*u-d),{isValid:w,value:f}=Ry(k(h*d)),l=k(f*c),m=k(f*l*h),D=k((s+s)*l);ir(D)&&(D=k(-D));let g=k(a*m),y=k(D*g);if(!w||ir(y)||g===he)throw new Error(o);return new t(new ue(D,g,V,y))}toRawBytes(){let{x:e,y:r,z:n,t:o}=this.ep,s=k(k(n+r)*k(n-r)),i=k(e*r),a=k(i*i),{value:c}=Ry(k(s*a)),u=k(c*s),d=k(c*i),h=k(u*d*o),w;if(ir(o*h)){let l=k(r*qo),m=k(e*qo);e=l,r=m,w=k(u*eA)}else w=d;ir(e*h)&&(r=k(-r));let f=k((n-r)*w);return ir(f)&&(f=k(-f)),Go(f)}toHex(){return Ko(this.toRawBytes())}toString(){return this.toHex()}equals(e){Fd(e);let r=this.ep,n=e.ep,o=k(r.x*n.y)===k(r.y*n.x),s=k(r.y*n.y)===k(r.x*n.x);return o||s}add(e){return Fd(e),new t(this.ep.add(e.ep))}subtract(e){return Fd(e),new t(this.ep.subtract(e.ep))}multiply(e){return new t(this.ep.multiply(e))}multiplyUnsafe(e){return new t(this.ep.multiplyUnsafe(e))}};Fr.BASE=new Fr(ue.BASE);Fr.ZERO=new Fr(ue.ZERO);var Vd=new WeakMap,ie=class t{constructor(e,r){this.x=e,this.y=r}_setWindowSize(e){this._WINDOW_SIZE=e,Vd.delete(this)}static fromHex(e,r=!0){let{d:n,P:o}=Q;e=cr(e,32);let s=e.slice();s[31]=e[31]&-129;let i=Jo(s);if(r&&i>=o)throw new Error("Expected 0 < hex < P");if(!r&&i>=Ny)throw new Error("Expected 0 < hex < 2**256");let a=k(i*i),c=k(a-V),u=k(n*a+V),{isValid:d,value:h}=Wd(c,u);if(!d)throw new Error("Point.fromHex: invalid y coordinate");let w=(h&V)===V;return(e[31]&128)!==0!==w&&(h=k(-h)),new t(h,i)}static async fromPrivateKey(e){return(await la(e)).point}toRawBytes(){let e=Go(this.y);return e[31]|=this.x&V?128:0,e}toHex(){return Ko(this.toRawBytes())}toX25519(){let{y:e}=this,r=k((V+e)*da(V-e));return Go(r)}isTorsionFree(){return ue.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new t(k(-this.x),this.y)}add(e){return ue.fromAffine(this).add(ue.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return ue.fromAffine(this).multiply(e,this).toAffine()}};ie.BASE=new ie(Q.Gx,Q.Gy);ie.ZERO=new ie(he,V);var Wo=class t{constructor(e,r){this.r=e,this.s=r,this.assertValidity()}static fromHex(e){let r=cr(e,64),n=ie.fromHex(r.slice(0,32),!1),o=Jo(r.slice(32,64));return new t(n,o)}assertValidity(){let{r:e,s:r}=this;if(!(e instanceof ie))throw new Error("Expected Point instance");return ua(r,Q.l,!1),this}toRawBytes(){let e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(Go(this.s),32),e}toHex(){return Ko(this.toRawBytes())}};function Py(...t){if(!t.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(t.length===1)return t[0];let e=t.reduce((n,o)=>n+o.length,0),r=new Uint8Array(e);for(let n=0,o=0;n<t.length;n++){let s=t[n];r.set(s,o),o+=s.length}return r}var nA=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ko(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=nA[t[r]];return e}function qd(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");let e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++){let n=r*2,o=t.slice(n,n+2),s=Number.parseInt(o,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[r]=s}return e}function $y(t){let r=t.toString(16).padStart(64,"0");return qd(r)}function Go(t){return $y(t).reverse()}function ir(t){return(k(t)&V)===V}function Jo(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Ko(Uint8Array.from(t).reverse()))}var oA=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function jd(t){return k(Jo(t)&oA)}function k(t,e=Q.P){let r=t%e;return r>=he?r:e+r}function da(t,e=Q.P){if(t===he||e<=he)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=k(t,e),n=e,o=he,s=V,i=V,a=he;for(;r!==he;){let u=n/r,d=n%r,h=o-i*u,w=s-a*u;n=r,r=d,o=i,s=a,i=h,a=w}if(n!==V)throw new Error("invert: does not exist");return k(o,e)}function sA(t,e=Q.P){let r=new Array(t.length),n=t.reduce((s,i,a)=>i===he?s:(r[a]=s,k(s*i,e)),V),o=da(n,e);return t.reduceRight((s,i,a)=>i===he?s:(r[a]=k(s*r[a],e),k(s*i,e)),o),r}function gt(t,e){let{P:r}=Q,n=t;for(;e-- >he;)n*=n,n%=r;return n}function iA(t){let{P:e}=Q,r=BigInt(5),n=BigInt(10),o=BigInt(20),s=BigInt(40),i=BigInt(80),c=t*t%e*t%e,u=gt(c,ar)*c%e,d=gt(u,V)*t%e,h=gt(d,r)*d%e,w=gt(h,n)*h%e,f=gt(w,o)*w%e,l=gt(f,s)*f%e,m=gt(l,i)*l%e,D=gt(m,i)*l%e,g=gt(D,n)*h%e;return{pow_p_5_8:gt(g,ar)*t%e,b2:c}}function Wd(t,e){let r=k(e*e*e),n=k(r*r*e),o=iA(t*n).pow_p_5_8,s=k(t*r*o),i=k(e*s*s),a=s,c=k(s*qo),u=i===t,d=i===k(-t),h=i===k(-t*qo);return u&&(s=a),(d||h)&&(s=c),ir(s)&&(s=k(-s)),{isValid:u||d,value:s}}function Ry(t){return Wd(V,t)}function fa(t){return k(Jo(t),Q.l)}function aA(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function cr(t,e){let r=t instanceof Uint8Array?Uint8Array.from(t):qd(t);if(typeof e=="number"&&r.length!==e)throw new Error(`Expected ${e} bytes`);return r}function ua(t,e,r=!0){if(!e)throw new TypeError("Specify max value");if(typeof t=="number"&&Number.isSafeInteger(t)&&(t=BigInt(t)),typeof t=="bigint"&&t<e){if(r){if(he<t)return t}else if(he<=t)return t}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function cA(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function fA(t){if(t=typeof t=="bigint"||typeof t=="number"?$y(ua(t,Ny)):cr(t),t.length!==32)throw new Error("Expected 32 bytes");return t}function uA(t){let e=cA(t.slice(0,32)),r=t.slice(32,64),n=fa(e),o=ie.BASE.multiply(n),s=o.toRawBytes();return{head:e,prefix:r,scalar:n,point:o,pointBytes:s}}var Hd;async function la(t){return uA(await fr.sha512(fA(t)))}async function zy(t){return(await la(t)).pointBytes}async function Fy(t,e){t=cr(t);let{prefix:r,scalar:n,pointBytes:o}=await la(e),s=fa(await fr.sha512(r,t)),i=ie.BASE.multiply(s),a=fa(await fr.sha512(i.toRawBytes(),o,t)),c=k(s+a*n,Q.l);return new Wo(i,c).toRawBytes()}function dA(t,e,r){e=cr(e),r instanceof ie||(r=ie.fromHex(r,!1));let{r:n,s:o}=t instanceof Wo?t.assertValidity():Wo.fromHex(t),s=ue.BASE.multiplyUnsafe(o);return{r:n,s:o,SB:s,pub:r,msg:e}}function lA(t,e,r,n){let o=fa(n),s=ue.fromAffine(t).multiplyUnsafe(o);return ue.fromAffine(e).add(s).subtract(r).multiplyUnsafe(Q.h).equals(ue.ZERO)}async function My(t,e,r){let{r:n,SB:o,msg:s,pub:i}=dA(t,e,r),a=await fr.sha512(n.toRawBytes(),i.toRawBytes(),s);return lA(i,n,o,a)}ie.BASE._setWindowSize(8);var sr={node:Zh,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},fr={bytesToHex:Ko,hexToBytes:qd,concatBytes:Py,getExtendedPublicKey:la,mod:k,invert:da,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:t=>{if(t=cr(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return k(Jo(t),Q.l-V)+V},randomBytes:(t=32)=>{if(sr.web)return sr.web.getRandomValues(new Uint8Array(t));if(sr.node){let{randomBytes:e}=sr.node;return new Uint8Array(e(t).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>fr.randomBytes(32),sha512:async(...t)=>{let e=Py(...t);if(sr.web){let r=await sr.web.subtle.digest("SHA-512",e.buffer);return new Uint8Array(r)}else{if(sr.node)return Uint8Array.from(sr.node.createHash("sha512").update(e).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(t=8,e=ie.BASE){let r=e.equals(ie.BASE)?e:new ie(e.x,e.y);return r._setWindowSize(t),r.multiply(ar),r},sha512Sync:void 0};Object.defineProperties(fr,{sha512Sync:{configurable:!1,get(){return Hd},set(t){Hd||(Hd=t)}}});var Ln={};C(Ln,{code:()=>yt,decode:()=>ma,encode:()=>mA,format:()=>pA,name:()=>Zd,or:()=>gA,parse:()=>Wy,signatureAlgorithm:()=>pa,signatureCode:()=>Qo});var hA=(t,e)=>{if(t.startsWith("did:")){for(let r of e)try{return r.parse(t)}catch{}throw new Error(`Unsupported did ${t}`)}else throw new Error(`Expected did instead got ${t}`)},ha=(t,e)=>new Gd([t,e]),Gd=class t{constructor(e){this.variants=e}parse(e){return hA(e,this.variants)}or(e){return new t([...this.variants,e])}},Zo=(t,e)=>new Kd(e,t),Kd=class{constructor(e,r){this.id=e,this.key=r}did(){return this.id}toDIDKey(){return this.key.toDIDKey()}verify(e,r){return this.key.verify(e,r)}withDID(e){return Zo(this.key,e)}};var yt=237,Zd="Ed25519",Qo=_r,pa="EdDSA",qy=$.encodingLength(yt),Vy=32+qy,Wy=t=>ma(se(t)),ma=t=>{let[e]=$.decode(t);if(e!==yt)throw new RangeError(`Unsupported key algorithm with multicode 0x${yt.toString(16)}`);if(t.byteLength!==Vy)throw new RangeError(`Expected Uint8Array with byteLength ${Vy}, instead got Uint8Array with byteLength ${t.byteLength}`);return new Jd(t.buffer,t.byteOffset,t.byteLength)},pA=t=>gn(t),mA=t=>Jm(t),Jd=class extends Uint8Array{get code(){return yt}get signatureCode(){return Qo}get signatureAlgorithm(){return pa}get publicKey(){let e=new Uint8Array(this.buffer,this.byteOffset+qy);return Object.defineProperties(this,{publicKey:{value:e}}),e}did(){return`did:key:${le.encode(this)}`}verify(e,r){return r.code===Qo&&My(r.raw,e,this.publicKey)}withDID(e){return Zo(this,e)}toDIDKey(){return this.did()}},gA=t=>ha({parse:Wy},t);var ga=(t,e)=>new Qd([t,e]),Qd=class t{constructor(e){this.variants=e,this.from=yA(e)}or(e){return new t([e,...this.variants])}},yA=t=>r=>{if(r.id.startsWith("did:key:"))return Gy(r,t);for(let[n,o]of Object.entries(r.keys)){let s=n;return Gy({id:s,keys:{[s]:o}},t).withDID(r.id)}throw new Error(`Archive ${r.id} contains no keys`)},Gy=(t,e)=>{for(let r of e)try{return r.from(t)}catch{}throw new Error("Unsupported signer")},Cn=({signer:t,verifier:e},r)=>new Yd(t,e.withDID(r)),Yd=class{constructor(e,r){this.key=e,this.verifier=r}get signer(){return this}get signatureAlgorithm(){return this.key.signatureAlgorithm}get signatureCode(){return this.key.signatureCode}did(){return this.verifier.did()}toDIDKey(){return this.verifier.toDIDKey()}withDID(e){return Cn(this.key,e)}sign(e){return this.key.sign(e)}verify(e,r){return this.verifier.verify(e,r)}toArchive(){let{keys:e}=this.key.toArchive();return{id:this.did(),keys:e}}};var jr=4864,Jy=Zd,el=pa,Zy=Qo,Mr=$.encodingLength(jr),Qy=$.encodingLength(yt),Nt=32,Xd=Mr+Nt+Qy+Nt,tl=Mr+Nt,Yy=()=>rl(fr.randomPrivateKey()),rl=async t=>{if(t.byteLength!==Nt)throw new Error(`Expected Uint8Array with byteLength of ${Nt} instead not ${t.byteLength}`);let e=await zy(t),r=new ya(Xd);return $.encodeTo(jr,r,0),r.set(t,Mr),$.encodeTo(yt,r,Mr+Nt),r.set(e,Mr+Nt+Qy),r},nl=({id:t,keys:e})=>{if(t.startsWith("did:key:")){let r=e[t];if(r instanceof Uint8Array)return xa(r)}throw new TypeError("Unsupported archive format")},wa=t=>ga({from:nl},t),xa=t=>{if(t.byteLength!==Xd)throw new Error(`Expected Uint8Array with byteLength of ${Xd} instead not ${t.byteLength}`);{let[e]=$.decode(t);if(e!==jr)throw new Error(`Given bytes must be a multiformat with ${jr} tag`)}{let[e]=$.decode(t.subarray(tl));if(e!==yt)throw new Error(`Given bytes must contain public key in multiformats with ${yt} tag`)}return new ya(t)},ol=t=>t.encode(),Xy=(t,e)=>(e||Hf).encode(ol(t)),ew=(t,e)=>xa((e||Hf).decode(t)),ya=class extends Uint8Array{get code(){return jr}get signer(){return this}get verifier(){let e=new Uint8Array(this.buffer,Mr+Nt),r=ma(e);return Object.defineProperties(this,{verifier:{value:r}}),r}get secret(){let e=new Uint8Array(this.buffer,Mr,Nt);return Object.defineProperties(this,{secret:{value:e}}),e}did(){return this.verifier.did()}toDIDKey(){return this.verifier.toDIDKey()}withDID(e){return Cn(this,e)}async sign(e){let r=await Fy(e,this.secret);return bn(this.signatureCode,r)}verify(e,r){return this.verifier.verify(e,r)}get signatureAlgorithm(){return el}get signatureCode(){return _r}encode(){return this}toArchive(){let e=this.did();return{id:e,keys:{[e]:this.encode()}}}};var pl={};C(pl,{Verifier:()=>dr,code:()=>Yo,decode:()=>lw,from:()=>dw,generate:()=>IA,name:()=>EA,or:()=>DA,signatureAlgorithm:()=>ll,signatureCode:()=>Xo});var wA=globalThis||window||self,ur=wA.crypto;var ka=(t,e)=>{let r=$.encodingLength(t),n=new Uint8Array(e.byteLength+r);return $.encodeTo(t,n,0),n.set(e,r),n},va=(t,e,r=0)=>{let n=r!==0?e.subarray(r):e,[o,s]=$.decode(n);if(o!==t)throw new Error(`Expected multiformat with 0x${t.toString(16)} tag instead got 0x${o.toString(16)}`);return new Uint8Array(n.buffer,n.byteOffset+s)},MU=$.encodingLength,jU=$.encodeTo,HU=$.decode;var Sa=t=>{if(t<=127)return new Uint8Array([t]);let e=[];for(;t!==0;)e.push(t&255),t=t>>>8;return e.reverse(),new Uint8Array([128|e.length&255,...e])},xA=(t,e=0)=>{if(!(t[e]&128))return{number:t[e],consumed:1};let r=t[e]&127;if(t.length<r+1)throw new Error(`ASN parsing error: Too few bytes. Expected encoded length's length to be at least ${r}`);let n=0;for(let o=0;o<r;o++)n=n<<8,n=n|t[e+o+1];return{number:n,consumed:r+1}},tw=(t,e,r)=>{let n=Un(t,e,r);return n.position+n.length},Un=(t,e,r)=>{let n=t[r];if(n!==e)throw new Error(`ASN parsing error: Expected tag 0x${e.toString(16)} at position ${r}, but got 0x${n.toString(16)}.`);let o=xA(t,r+1);return{position:r+1+o.consumed,length:o.number}},rw=t=>{let e=Sa(t.byteLength+1),r=new Uint8Array(1+e.byteLength+1+t.byteLength),n=0;return r[n]=3,n+=1,r.set(e,n),n+=e.byteLength,r[n]=0,n+=1,r.set(t,n),r},nw=t=>{let e=Sa(t.byteLength),r=new Uint8Array(1+e.byteLength+t.byteLength),n=0;return r[n]=4,n+=1,r.set(e,n),n+=e.byteLength,r.set(t,n),r},Hr=t=>{let e=0;for(let s of t)e+=s.byteLength;let r=Sa(e),n=new Uint8Array(1+r.byteLength+e),o=0;n[o]=48,o+=1,n.set(r,o),o+=r.byteLength;for(let s of t)n.set(s,o),o+=s.byteLength;return n},bA=(t,e=0)=>{let{position:r,length:n}=Un(t,48,e);return new Uint8Array(t.buffer,t.byteOffset+r,n)},Ea=t=>{let e=t.byteLength===0||t[0]&128?1:0,r=Sa(t.byteLength+e),n=new Uint8Array(1+r.byteLength+t.byteLength+e),o=0;return n[o]=2,o+=1,n.set(r,o),o+=r.byteLength,e>0&&(n[o]=0,o+=e),n.set(t,o),n},Aa=(t,e=0)=>Un(t,48,e).position,Ta=(t,e=0)=>tw(t,48,e),ow=(t,e=0)=>tw(t,2,e),sw=(t,e=0)=>{let{position:r,length:n}=Un(t,3,e),o=t[r];if(o!==0)throw new Error(`Can not read bitstring, expected length to be multiple of 8, but got ${o} unused bits in last byte.`);return new Uint8Array(t.buffer,t.byteOffset+r+1,n-1)},nt=(t,e=0)=>{let{position:r,length:n}=Un(t,2,e),o=0;for(;t[r+o]===0;)o++;return new Uint8Array(t.buffer,t.byteOffset+r+o,n-o)},iw=(t,e=0)=>{let{position:r,length:n}=Un(t,4,e);return new Uint8Array(t.buffer,t.byteOffset+r,n)},il=(t,e,r=0)=>{let n=[],o=bA(e,r),s=0;for(let i of t){let a=i(o,s);n.push(a),s=a.byteOffset+a.byteLength-o.byteOffset}return n};var kA=new Uint8Array([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]),Ia=t=>Hr([kA,rw(t)]),al=t=>{let e=Aa(t,0),r=Ta(t,e);return sw(t,r)};var vA=new Uint8Array([2,1,0,48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]),fl=t=>{let e=0;return e=Aa(t,e),e=ow(t,e),e=Ta(t,e),iw(t,e)},ul=t=>Hr([vA,nw(t)]);var dl=({n:t,e})=>Hr([Ea(t),Ea(e)]);var e5=new Uint8Array,fw=(t,e=0)=>{let[r,n,o,s,i,a,c,u,d]=il([nt,nt,nt,nt,nt,nt,nt,nt,nt],t,e);return{v:r,n,e:o,d:s,p:i,q:a,dp:c,dq:u,qi:d}};var EA="RSA",Yo=4869,Da=4613,Xo=mo,ll="RS256",Ca="RSASSA-PKCS1-v1_5",hl="SHA-256",AA=2048,TA=128,uw={name:Ca,hash:{name:hl}},IA=async({size:t=AA,extractable:e=!1}={})=>{let{publicKey:r,privateKey:n}=await ur.subtle.generateKey({name:Ca,modulusLength:t,publicExponent:new Uint8Array([1,0,1]),hash:{name:hl}},e,["sign","verify"]),o=await ur.subtle.exportKey("spki",r),s=ka(Da,al(new Uint8Array(o))),i=new dr({bytes:s,publicKey:r});if(e){let a=await ur.subtle.exportKey("pkcs8",n),c=ka(Yo,fl(new Uint8Array(a)));return new _a({privateKey:n,bytes:c,verifier:i})}else return new La({privateKey:n,verifier:i})},dw=({id:t,keys:e})=>{if(t.startsWith("did:key:")){let r=t,n=e[r];return n instanceof Uint8Array?lw(n):new La({privateKey:n,verifier:dr.parse(r)})}else throw new TypeError(`RSA can not import from ${t} archive, try generic Signer instead`)},DA=t=>ga({from:dw},t),lw=t=>{let e=fw(va(Yo,t)),r=ka(Da,dl(e));return new _a({bytes:t,privateKey:ur.subtle.importKey("pkcs8",ul(va(Yo,t)),uw,!0,["sign"]),verifier:dr.decode(r)})},dr=class t{constructor({publicKey:e,bytes:r}){this.publicKey=e,this.bytes=r}withDID(e){return Zo(this,e)}toDIDKey(){return this.did()}static decode(e){return new this({bytes:e,publicKey:ur.subtle.importKey("spki",Ia(va(Da,e)),uw,!0,["verify"])})}static parse(e){return t.decode(se(e))}static or(e){return ha(this,e)}get code(){return Da}get signatureCode(){return Xo}get signatureAlgorithm(){return ll}did(){return`did:key:${le.encode(this.bytes)}`}async verify(e,r){return r.code!==Xo?!1:ur.subtle.verify({name:Ca,hash:{name:hl}},await this.publicKey,r.raw,e)}};var Ba=class{constructor({privateKey:e,verifier:r}){this.verifier=r,this.privateKey=e}get signer(){return this}get code(){return Yo}get signatureCode(){return Xo}get signatureAlgorithm(){return ll}did(){return this.verifier.did()}toDIDKey(){return this.verifier.toDIDKey()}verify(e,r){return this.verifier.verify(e,r)}async sign(e){let r=await ur.subtle.sign({name:Ca,saltLength:TA},await this.privateKey,e);return bn(Xo,new Uint8Array(r))}},_a=class extends Ba{constructor(e){super(e),this.bytes=e.bytes}withDID(e){return Cn(this,e)}toArchive(){let e=this.did();return{id:e,keys:{[e]:this.bytes}}}},La=class extends Ba{constructor(e){super(e),this.privateKey=e.privateKey}withDID(e){return Cn(this,e)}toArchive(){let e=this.did();return{id:e,keys:{[e]:this.privateKey}}}};var i5=Ln.or(dr),a5=wa(pl);var hw=x.link({version:1}),l5=N({can:"ucan/*",with:x.did(),derives:M}),h5=N({can:"ucan/revoke",with:x.did(),nb:x.struct({ucan:hw,proof:hw.array().optional()}),derives:(t,e)=>_(M(t,e))??_(Y(t.nb.ucan,e.nb.ucan,"nb.ucan"))??fe((t.nb.proof??[]).join("/"),(e.nb.proof??[]).join("/"),"nb.proof")}),Ua=N({can:"ucan/conclude",with:x.did(),nb:x.struct({receipt:x.link()}),derives:(t,e)=>_(M(t,e))||_(Y(t.nb.receipt,e.nb.receipt,"nb.receipt"))||O({})}),p5=N({can:"ucan/attest",with:x.did(),nb:x.struct({proof:x.link({version:1})}),derives:(t,e)=>_(M(t,e))??Y(t.nb.proof,e.nb.proof,"nb.proof")});var w5=N({can:"space/blob/*",with:P,derives:M}),On=x.struct({digest:x.bytes(),size:x.integer()}),Pn=N({can:"space/blob/add",with:P,nb:x.struct({blob:On}),derives:Ro}),Oa=N({can:"space/blob/remove",with:P,nb:x.struct({digest:x.bytes()}),derives:(t,e)=>t.with!==e.with?ne(`Expected 'with: "${e.with}"' instead got '${t.with}'`):e.nb.digest&&!Ot(e.nb.digest,t.nb.digest)?ne(`Link ${t.nb.digest?`${t.nb.digest}`:""} violates imposed ${e.nb.digest} constraint.`):O({})}),Pa=N({can:"space/blob/list",with:P,nb:x.struct({cursor:x.string().optional(),size:x.integer().optional()}),derives:(t,e)=>t.with!==e.with?ne(`Expected 'with: "${e.with}"' instead got '${t.with}'`):O({})}),Ra=N({can:"space/blob/get/0/1",with:P,nb:x.struct({digest:x.bytes()}),derives:(t,e)=>t.with!==e.with?ne(`Expected 'with: "${e.with}"' instead got '${t.with}'`):e.nb.digest&&!Ot(e.nb.digest,t.nb.digest)?ne(`Link ${t.nb.digest?`${t.nb.digest}`:""} violates imposed ${e.nb.digest} constraint.`):O({})});var v5=N({can:"web3.storage/blob/*",with:P,derives:M}),pw=N({can:"web3.storage/blob/allocate",with:x.did(),nb:x.struct({blob:On,cause:Ge,space:P}),derives:(t,e)=>_(M(t,e))||_(Ro(t,e))||_(Y(t.nb.cause,e.nb.cause,"cause"))||_(fe(t.nb.space,e.nb.space,"space"))||O({})}),mw=N({can:"web3.storage/blob/accept",with:x.did(),nb:x.struct({blob:On,ttl:x.integer().optional(),space:P,_put:Po}),derives:(t,e)=>_(M(t,e))||_(Ro(t,e))||_(fe(t.nb.ttl,e.nb.ttl,"ttl"))||_(fe(t.nb.space,e.nb.space,"space"))||O({})});var gw=N({can:"http/put",with:P,nb:x.struct({body:On,url:x.string().or(Po),headers:x.dictionary({value:x.string()}).or(Po)}),derives:(t,e)=>_(M(t,e))||_(sy(t,e))||_(fe(t.nb.url,e.nb,"url"))||_(fe(t.nb.headers,e.nb,"headers"))||O({})});var yw={};C(yw,{ReceiptMissing:()=>za,ReceiptNotFound:()=>$a,poll:()=>ml});var $a=class extends Error{constructor(e){super(),this.taskCid=e}get reason(){return`receipt not found for task ${this.taskCid} in the indexed workflow`}get name(){return"ReceiptNotFound"}},za=class extends Error{constructor(e){super(),this.taskCid=e}get reason(){return`receipt missing for task ${this.taskCid}`}get name(){return"ReceiptMissing"}};async function ml(t,e={}){return await Ae(async()=>{let r=await UA(t,e);if(r.error)throw r.error.name==="ReceiptNotFound"?r.error:new rt(new Error("failed to fetch blob/accept receipt",{cause:r.error}));return r.ok},{onFailedAttempt:console.warn,retries:e.retries??3})}async function UA(t,e={}){let r=new URL(t.toString(),e.receiptsEndpoint??zd),o=await(e.fetch??globalThis.fetch.bind(globalThis))(r);if(o.status===404)return{error:new $a(t)};let s=new Uint8Array(await o.arrayBuffer()),a=(await ye.request.decode({body:s,headers:{}})).receipts.get(t.toString());return a?{ok:a}:{error:new za(t)}}function OA(t,e){return({total:n,loaded:o,lengthComputable:s})=>e({total:n,loaded:o,lengthComputable:s,url:t})}function PA(t){let e=new Map;for(let r of t.iterateIPLDBlocks())e.set(`${r.cid}`,r);return nr.view({root:t.capabilities[0].nb.receipt,blocks:e})}function RA(t){let e=t.fx.fork,r=e.find(d=>d.capabilities[0].can===pw.can),n=e.filter(d=>d.capabilities[0].can===Ua.can),o=e.find(d=>d.capabilities[0].can===gw.can),s=e.find(d=>d.capabilities[0].can===mw.can);if(!r||!n.length||!o||!s)throw new Error("mandatory effects not received");let i=n.map(d=>PA(d)),a=i.find(d=>d.ran.link().equals(r.cid)),c=i.find(d=>d.ran.link().equals(o.cid)),u=i.find(d=>d.ran.link().equals(s.cid));if(!a)throw new Error("mandatory effects not received");return{allocate:{task:r,receipt:a},put:{task:o,receipt:c},accept:{task:s,receipt:u}}}function NA(t,e,r){let n=[],o=[];for(let i of r.iterateIPLDBlocks())n.push(i),o.push(i.cid);let s=Ua.invoke({issuer:t,audience:e,with:t.toDIDKey(),nb:{receipt:r.link()},expiration:1/0,facts:[{...o}]});for(let i of n)s.attach(i);return s}async function es({issuer:t,with:e,proofs:r,audience:n},o,s,i={}){let a=s instanceof Uint8Array?s:new Uint8Array(await s.arrayBuffer()),c=a.length,u=i.connection??ee,d=await Ae(async()=>await Pn.invoke({issuer:t,audience:n??Z,with:P.from(e),nb:Fa(o,c),proofs:r,nonce:i.nonce}).execute(u),{onFailedAttempt:console.warn,retries:i.retries??3});if(!d.out.ok)throw new Error(`failed ${Pn.can} invocation`,{cause:d.out.error});let h=RA(d),{receipt:w}=h.allocate;if(!w.out.ok)throw new Error(`failed ${Pn.can} invocation`,{cause:w.out.error});let{address:f}=w.out.ok;if(f){let y=i.fetchWithUploadProgress||i.fetch||globalThis.fetch.bind(globalThis),S=!1,{status:v}=await Ae(async()=>{try{let A=await y(f.url,{method:"PUT",mode:"cors",body:a,headers:f.headers,signal:i.signal,onUploadProgress:B=>{S=!0,i.onUploadProgress&&OA(f.url,i.onUploadProgress)(B)},duplex:"half"});if(A.status>=400&&A.status<500)throw new rt(`upload failed: ${A.status}`);return A}catch(A){throw i.signal?.aborted===!0?new rt("upload aborted"):A}},{retries:i.retries??3});if(v!==200)throw new Error(`upload failed: ${v}`);if(!S&&i.onUploadProgress){let A=new Blob([a]);i.onUploadProgress({total:A.size,loaded:A.size,lengthComputable:!1})}}let{receipt:l}=h.put;if(!l?.out.ok){let y=ba.from(h.put.task.facts[0].keys);if(l=await nr.issue({issuer:y,ran:h.put.task.cid,result:{ok:{}}}),!(await NA(t,n??Z,l).execute(u)).out.ok)throw new Error(`failed ${Pn.can} invocation`,{cause:d.out.error})}let{receipt:m}=h.accept;m?.out.ok||(m=await ml(h.accept.task.link(),i));let D=new Map([...m.iterateIPLDBlocks()].map(y=>[`${y.cid}`,y]));return{site:Pr.view({root:m.out.ok?.site,blocks:D})}}var gl=Pn.can,Fa=(t,e)=>({blob:{digest:t.bytes,size:e}});async function ww({issuer:t,with:e,proofs:r,audience:n},o,s={}){let i=s.connection??ee,a=await Ra.invoke({issuer:t,audience:n??Z,with:P.from(e),nb:zA(o),proofs:r,nonce:s.nonce}).execute(i);if(!a.out.ok)throw new Error(`failed ${Ra.can} invocation`,{cause:a.out.error});return a.out}var F5=Ra.can,zA=t=>({digest:t.bytes});async function xw({issuer:t,with:e,proofs:r,audience:n},o={}){let s=o.connection??ee,i=await Pa.invoke({issuer:t,audience:n??Z,with:P.from(e),proofs:r,nb:FA(o.cursor,o.size),nonce:o.nonce}).execute(s);if(!i.out.ok)throw new Error(`failed ${Pa.can} invocation`,{cause:i.out.error});return i.out.ok}var V5=Pa.can,FA=(t,e)=>({cursor:t,size:e});async function bw({issuer:t,with:e,proofs:r,audience:n},o,s={}){let i=s.connection??ee,a=await Oa.invoke({issuer:t,audience:n??Z,with:P.from(e),nb:MA(o),proofs:r,nonce:s.nonce}).execute(i);if(!a.out.ok)throw new Error(`failed ${Oa.can} invocation`,{cause:a.out.error});return a.out}var K5=Oa.can,MA=t=>({digest:t.bytes});var Sw={};C(Sw,{add:()=>ja});var n4=N({can:"space/index/*",with:P,derives:M}),Ma=N({can:"space/index/add",with:P,nb:x.struct({index:x.link({code:X.code,version:1})}),derives:(t,e)=>_(M(t,e))||_(fe(t.nb.index,e.nb.index,"index"))||O({})});async function ja({issuer:t,with:e,proofs:r,audience:n},o,s={}){let i=s.connection??ee,a=await Ae(async()=>await Ma.invoke({issuer:t,audience:n??Z,with:P.from(e),nb:yl(o),proofs:r}).execute(i),{onFailedAttempt:console.warn,retries:s.retries??3});if(!a.out.ok)throw new Error(`failed ${Ma.can} invocation`,{cause:a.out.error});return a.out.ok}var vw=Ma.can,yl=t=>({index:t});var Dw={};C(Dw,{add:()=>qa,get:()=>Aw,list:()=>Tw,remove:()=>Iw});var l4=N({can:"upload/*",with:P,derives:M}),VA=Ge.match({code:X.code,version:1}),ts=N({can:"upload/add",with:P,nb:x.struct({root:Ge,shards:VA.array().optional()}),derives:(t,e)=>_(M(t,e))||_(fe(t.nb.root,e.nb.root,"root"))||_(fe(t.nb.shards,e.nb.shards,"shards"))||O({})}),Ha=N({can:"upload/get",with:P,nb:x.struct({root:Ge.optional()}),derives:(t,e)=>{let r=M(t,e);return r.error||!e.nb.root?r:fe(t.nb.root,e.nb.root,"root")}}),rs=N({can:"upload/remove",with:P,nb:x.struct({root:Ge}),derives:(t,e)=>_(M(t,e))||_(fe(t.nb.root,e.nb.root,"root"))||O({})}),ns=N({can:"upload/list",with:P,nb:x.struct({cursor:x.string().optional(),size:x.integer().optional(),pre:x.boolean().optional()})}),h4=ts.or(rs).or(ns);async function qa({issuer:t,with:e,proofs:r,audience:n},o,s,i={}){let a=i.connection??ee,c=await Ae(async()=>await ts.invoke({issuer:t,audience:n??Z,with:P.from(e),nb:wl(o,s),proofs:r,nonce:i.nonce}).execute(a),{onFailedAttempt:console.warn,retries:i.retries??3});if(!c.out.ok)throw new Error(`failed ${ts.can} invocation`,{cause:c.out.error});return c.out.ok}var Ew=ts.can,wl=(t,e)=>({root:t,shards:e});async function Aw({issuer:t,with:e,proofs:r,audience:n},o,s={}){let i=s.connection??ee,a=await Ae(async()=>await Ha.invoke({issuer:t,audience:n??Z,with:P.from(e),nb:WA(o),proofs:r,nonce:s.nonce}).execute(i),{onFailedAttempt:console.warn,retries:s.retries??3});if(!a.out.ok)throw new Error(`failed ${Ha.can} invocation`,{cause:a.out.error});return a.out.ok}var v4=Ha.can,WA=t=>({root:t});async function Tw({issuer:t,with:e,proofs:r,audience:n},o={}){let s=o.connection??ee,i=await ns.invoke({issuer:t,audience:n??Z,with:P.from(e),proofs:r,nb:GA(o.cursor,o.size,o.pre),nonce:o.nonce}).execute(s);if(!i.out.ok)throw new Error(`failed ${ns.can} invocation`,{cause:i.out.error});return i.out.ok}var T4=ns.can,GA=(t,e,r)=>({cursor:t,size:e,pre:r});async function Iw({issuer:t,with:e,proofs:r,audience:n},o,s={}){let i=s.connection??ee,a=await rs.invoke({issuer:t,audience:n??Z,with:P.from(e),nb:KA(o),proofs:r,nonce:s.nonce}).execute(i);if(!a.out.ok)throw new Error(`failed ${rs.can} invocation`,{cause:a.out.error});return a.out.ok}var _4=rs.can,KA=t=>({root:t});var Jb={};C(Jb,{createDirectoryEncoderStream:()=>Tc,createFileEncoderStream:()=>Ac,encodeDirectory:()=>cI,encodeFile:()=>aI});var Fn={};C(Fn,{DEFAULT_DIRECTORY_MODE:()=>vx,DEFAULT_FILE_MODE:()=>kx,NodeType:()=>z,code:()=>zn,createAdvancedFile:()=>m8,createComplexFile:()=>y8,createDirectoryShard:()=>Nl,createEmptyFile:()=>h8,createFileChunk:()=>p8,createFileShard:()=>g8,createFlatDirectory:()=>Xa,createRaw:()=>Sx,createShardedDirectory:()=>Ax,createSimpleFile:()=>Ex,createSymlink:()=>Ix,cumulativeContentByteLength:()=>xt,cumulativeDagByteLength:()=>gr,decode:()=>_x,decodeMetadata:()=>Wr,encode:()=>Bx,encodeAdvancedFile:()=>Fl,encodeComplexFile:()=>Ml,encodeDirectory:()=>rc,encodeDirectoryMetadata:()=>Vl,encodeFile:()=>Tx,encodeFileChunk:()=>zl,encodeFileShard:()=>w8,encodeHAMTShard:()=>nc,encodeLink:()=>ec,encodeMetadata:()=>fs,encodeMode:()=>Cx,encodeRaw:()=>$l,encodeSimpleFile:()=>tc,encodeSymlink:()=>Dx,filesize:()=>v8,matchFile:()=>k8,name:()=>Rl});var JA=new TextDecoder;function xl(t,e){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=t.length)throw new Error("protobuf: unexpected end of data");let o=t[e++];if(r+=n<28?(o&127)<<n:(o&127)*2**n,o<128)break}return[r,e]}function Wa(t,e){let r;[r,e]=xl(t,e);let n=e+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>t.length)throw new Error("protobuf: unexpected end of data");return[t.subarray(e,n),n]}function Bw(t,e){let r;return[r,e]=xl(t,e),[r&7,r>>3,e]}function ZA(t){let e={},r=t.length,n=0;for(;n<r;){let o,s;if([o,s,n]=Bw(t,n),s===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=Wa(t,n)}else if(s===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(o!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let i;[i,n]=Wa(t,n),e.Name=JA.decode(i)}else if(s===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(o!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${o}) for Tsize`);[e.Tsize,n]=xl(t,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`)}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function _w(t){let e=t.length,r=0,n,o=!1,s;for(;r<e;){let a,c;if([a,c,r]=Bw(t,r),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(s)throw new Error("protobuf: (PBNode) duplicate Data section");[s,r]=Wa(t,r),n&&(o=!0)}else if(c===2){if(o)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let u;[u,r]=Wa(t,r),n.push(ZA(u))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(r>e)throw new Error("protobuf: (PBNode) unexpected end of data");let i={};return s&&(i.Data=s),i.Links=n||[],i}var Cw=new TextEncoder,Lw=2**32,QA=2**31;function YA(t,e){let r=e.length;if(typeof t.Tsize=="number"){if(t.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(t.Tsize))throw new Error("Tsize too large for encoding");r=os(e,r,t.Tsize)-1,e[r]=24}if(typeof t.Name=="string"){let n=Cw.encode(t.Name);r-=n.length,e.set(n,r),r=os(e,r,n.length)-1,e[r]=18}return t.Hash&&(r-=t.Hash.length,e.set(t.Hash,r),r=os(e,r,t.Hash.length)-1,e[r]=10),e.length-r}function Uw(t){let e=e8(t),r=new Uint8Array(e),n=e;if(t.Data&&(n-=t.Data.length,r.set(t.Data,n),n=os(r,n,t.Data.length)-1,r[n]=10),t.Links)for(let o=t.Links.length-1;o>=0;o--){let s=YA(t.Links[o],r.subarray(0,n));n-=s,n=os(r,n,s)-1,r[n]=18}return r}function XA(t){let e=0;if(t.Hash){let r=t.Hash.length;e+=1+r+Rn(r)}if(typeof t.Name=="string"){let r=Cw.encode(t.Name).length;e+=1+r+Rn(r)}return typeof t.Tsize=="number"&&(e+=1+Rn(t.Tsize)),e}function e8(t){let e=0;if(t.Data){let r=t.Data.length;e+=1+r+Rn(r)}if(t.Links)for(let r of t.Links){let n=XA(r);e+=1+n+Rn(n)}return e}function os(t,e,r){e-=Rn(r);let n=e;for(;r>=QA;)t[e++]=r&127|128,r/=128;for(;r>=128;)t[e++]=r&127|128,r>>>=7;return t[e]=r,n}function Rn(t){return t%2===0&&t++,Math.floor((t8(t)+6)/7)}function t8(t){let e=0;return t>=Lw&&(t=Math.floor(t/Lw),e=32),t>=65536&&(t>>>=16,e+=16),t>=256&&(t>>>=8,e+=8),e+r8[t]}var r8=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];var n8=["Data","Links"],o8=["Hash","Name","Tsize"],bl=new TextEncoder;function Pw(t,e){if(t===e)return 0;let r=t.Name?bl.encode(t.Name):[],n=e.Name?bl.encode(e.Name):[],o=r.length,s=n.length;for(let i=0,a=Math.min(o,s);i<a;++i)if(r[i]!==n[i]){o=r[i],s=n[i];break}return o<s?-1:s<o?1:0}function Ow(t,e){return!Object.keys(t).some(r=>!e.includes(r))}function s8(t){if(typeof t.asCID=="object"){let r=G.asCID(t);if(!r)throw new TypeError("Invalid DAG-PB form");return{Hash:r}}if(typeof t!="object"||Array.isArray(t))throw new TypeError("Invalid DAG-PB form");let e={};if(t.Hash){let r=G.asCID(t.Hash);try{r||(typeof t.Hash=="string"?r=G.parse(t.Hash):t.Hash instanceof Uint8Array&&(r=G.decode(t.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}r&&(e.Hash=r)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof t.Name=="string"&&(e.Name=t.Name),typeof t.Tsize=="number"&&(e.Tsize=t.Tsize),e}function kl(t){if((t instanceof Uint8Array||typeof t=="string")&&(t={Data:t}),typeof t!="object"||Array.isArray(t))throw new TypeError("Invalid DAG-PB form");let e={};if(t.Data!==void 0)if(typeof t.Data=="string")e.Data=bl.encode(t.Data);else if(t.Data instanceof Uint8Array)e.Data=t.Data;else throw new TypeError("Invalid DAG-PB form");if(t.Links!==void 0)if(Array.isArray(t.Links))e.Links=t.Links.map(s8),e.Links.sort(Pw);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function Rw(t){if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form");if(!Ow(t,n8))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(t.Data!==void 0&&!(t.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(t.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<t.Links.length;e++){let r=t.Links[e];if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!Ow(r,o8))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(r.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(r.Hash==null||!r.Hash["/"]||r.Hash["/"]!==r.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(r.Name!==void 0&&typeof r.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(r.Tsize!==void 0){if(typeof r.Tsize!="number"||r.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(r.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&Pw(r,t.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function Nw(t){return t instanceof ArrayBuffer?new Uint8Array(t,0,t.byteLength):t}var Ga=112;function $w(t){Rw(t);let e={};return t.Links&&(e.Links=t.Links.map(r=>{let n={};return r.Hash&&(n.Hash=r.Hash.bytes),r.Name!==void 0&&(n.Name=r.Name),r.Tsize!==void 0&&(n.Tsize=r.Tsize),n})),t.Data&&(e.Data=t.Data),Uw(e)}function zw(t){let e=Nw(t),r=_w(e),n={};return r.Data&&(n.Data=r.Data),r.Links&&(n.Links=r.Links.map(o=>{let s={};try{s.Hash=G.decode(o.Hash)}catch{}if(!s.Hash)throw new Error("Invalid Hash field found in link, expected CID");return o.Name!==void 0&&(s.Name=o.Name),o.Tsize!==void 0&&(s.Tsize=o.Tsize),s})),n}var $t=Ht(yx(),1),Nn=$t.default.Reader,Ol=$t.default.Writer,R=$t.default.util,we=$t.default.roots.unixfs||($t.default.roots.unixfs={}),$n=we.Data=(()=>{function t(e){if(this.blocksizes=[],e)for(var r=Object.keys(e),n=0;n<r.length;++n)e[r[n]]!=null&&(this[r[n]]=e[r[n]])}return t.prototype.Type=0,t.prototype.Data=R.newBuffer([]),t.prototype.filesize=R.Long?R.Long.fromBits(0,0,!0):0,t.prototype.blocksizes=R.emptyArray,t.prototype.hashType=R.Long?R.Long.fromBits(0,0,!0):0,t.prototype.fanout=R.Long?R.Long.fromBits(0,0,!0):0,t.prototype.mode=0,t.prototype.mtime=null,t.encode=function(r,n){if(n||(n=Ol.create()),n.uint32(8).int32(r.Type),r.Data!=null&&Object.hasOwnProperty.call(r,"Data")&&n.uint32(18).bytes(r.Data),r.filesize!=null&&Object.hasOwnProperty.call(r,"filesize")&&n.uint32(24).uint64(r.filesize),r.blocksizes!=null&&r.blocksizes.length)for(var o=0;o<r.blocksizes.length;++o)n.uint32(32).uint64(r.blocksizes[o]);return r.hashType!=null&&Object.hasOwnProperty.call(r,"hashType")&&n.uint32(40).uint64(r.hashType),r.fanout!=null&&Object.hasOwnProperty.call(r,"fanout")&&n.uint32(48).uint64(r.fanout),r.mode!=null&&Object.hasOwnProperty.call(r,"mode")&&n.uint32(56).uint32(r.mode),r.mtime!=null&&Object.hasOwnProperty.call(r,"mtime")&&we.UnixTime.encode(r.mtime,n.uint32(66).fork()).ldelim(),n},t.decode=function(r,n){r instanceof Nn||(r=Nn.create(r));for(var o=n===void 0?r.len:r.pos+n,s=new we.Data;r.pos<o;){var i=r.uint32();switch(i>>>3){case 1:s.Type=r.int32();break;case 2:s.Data=r.bytes();break;case 3:s.filesize=r.uint64();break;case 4:if(s.blocksizes&&s.blocksizes.length||(s.blocksizes=[]),(i&7)===2)for(var a=r.uint32()+r.pos;r.pos<a;)s.blocksizes.push(r.uint64());else s.blocksizes.push(r.uint64());break;case 5:s.hashType=r.uint64();break;case 6:s.fanout=r.uint64();break;case 7:s.mode=r.uint32();break;case 8:s.mtime=we.UnixTime.decode(r,r.uint32());break;default:r.skipType(i&7);break}}if(!s.hasOwnProperty("Type"))throw R.ProtocolError("missing required 'Type'",{instance:s});return s},t.fromObject=function(r){if(r instanceof we.Data)return r;var n=new we.Data;switch(r.Type){case"Raw":case 0:n.Type=0;break;case"Directory":case 1:n.Type=1;break;case"File":case 2:n.Type=2;break;case"Metadata":case 3:n.Type=3;break;case"Symlink":case 4:n.Type=4;break;case"HAMTShard":case 5:n.Type=5;break}if(r.Data!=null&&(typeof r.Data=="string"?R.base64.decode(r.Data,n.Data=R.newBuffer(R.base64.length(r.Data)),0):r.Data.length&&(n.Data=r.Data)),r.filesize!=null&&(R.Long?(n.filesize=R.Long.fromValue(r.filesize)).unsigned=!0:typeof r.filesize=="string"?n.filesize=parseInt(r.filesize,10):typeof r.filesize=="number"?n.filesize=r.filesize:typeof r.filesize=="object"&&(n.filesize=new R.LongBits(r.filesize.low>>>0,r.filesize.high>>>0).toNumber(!0))),r.blocksizes){if(!Array.isArray(r.blocksizes))throw TypeError(".Data.blocksizes: array expected");n.blocksizes=[];for(var o=0;o<r.blocksizes.length;++o)R.Long?(n.blocksizes[o]=R.Long.fromValue(r.blocksizes[o])).unsigned=!0:typeof r.blocksizes[o]=="string"?n.blocksizes[o]=parseInt(r.blocksizes[o],10):typeof r.blocksizes[o]=="number"?n.blocksizes[o]=r.blocksizes[o]:typeof r.blocksizes[o]=="object"&&(n.blocksizes[o]=new R.LongBits(r.blocksizes[o].low>>>0,r.blocksizes[o].high>>>0).toNumber(!0))}if(r.hashType!=null&&(R.Long?(n.hashType=R.Long.fromValue(r.hashType)).unsigned=!0:typeof r.hashType=="string"?n.hashType=parseInt(r.hashType,10):typeof r.hashType=="number"?n.hashType=r.hashType:typeof r.hashType=="object"&&(n.hashType=new R.LongBits(r.hashType.low>>>0,r.hashType.high>>>0).toNumber(!0))),r.fanout!=null&&(R.Long?(n.fanout=R.Long.fromValue(r.fanout)).unsigned=!0:typeof r.fanout=="string"?n.fanout=parseInt(r.fanout,10):typeof r.fanout=="number"?n.fanout=r.fanout:typeof r.fanout=="object"&&(n.fanout=new R.LongBits(r.fanout.low>>>0,r.fanout.high>>>0).toNumber(!0))),r.mode!=null&&(n.mode=r.mode>>>0),r.mtime!=null){if(typeof r.mtime!="object")throw TypeError(".Data.mtime: object expected");n.mtime=we.UnixTime.fromObject(r.mtime)}return n},t.toObject=function(r,n){n||(n={});var o={};if((n.arrays||n.defaults)&&(o.blocksizes=[]),n.defaults){if(o.Type=n.enums===String?"Raw":0,n.bytes===String?o.Data="":(o.Data=[],n.bytes!==Array&&(o.Data=R.newBuffer(o.Data))),R.Long){var s=new R.Long(0,0,!0);o.filesize=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else o.filesize=n.longs===String?"0":0;if(R.Long){var s=new R.Long(0,0,!0);o.hashType=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else o.hashType=n.longs===String?"0":0;if(R.Long){var s=new R.Long(0,0,!0);o.fanout=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else o.fanout=n.longs===String?"0":0;o.mode=0,o.mtime=null}if(r.Type!=null&&r.hasOwnProperty("Type")&&(o.Type=n.enums===String?we.Data.DataType[r.Type]:r.Type),r.Data!=null&&r.hasOwnProperty("Data")&&(o.Data=n.bytes===String?R.base64.encode(r.Data,0,r.Data.length):n.bytes===Array?Array.prototype.slice.call(r.Data):r.Data),r.filesize!=null&&r.hasOwnProperty("filesize")&&(typeof r.filesize=="number"?o.filesize=n.longs===String?String(r.filesize):r.filesize:o.filesize=n.longs===String?R.Long.prototype.toString.call(r.filesize):n.longs===Number?new R.LongBits(r.filesize.low>>>0,r.filesize.high>>>0).toNumber(!0):r.filesize),r.blocksizes&&r.blocksizes.length){o.blocksizes=[];for(var i=0;i<r.blocksizes.length;++i)typeof r.blocksizes[i]=="number"?o.blocksizes[i]=n.longs===String?String(r.blocksizes[i]):r.blocksizes[i]:o.blocksizes[i]=n.longs===String?R.Long.prototype.toString.call(r.blocksizes[i]):n.longs===Number?new R.LongBits(r.blocksizes[i].low>>>0,r.blocksizes[i].high>>>0).toNumber(!0):r.blocksizes[i]}return r.hashType!=null&&r.hasOwnProperty("hashType")&&(typeof r.hashType=="number"?o.hashType=n.longs===String?String(r.hashType):r.hashType:o.hashType=n.longs===String?R.Long.prototype.toString.call(r.hashType):n.longs===Number?new R.LongBits(r.hashType.low>>>0,r.hashType.high>>>0).toNumber(!0):r.hashType),r.fanout!=null&&r.hasOwnProperty("fanout")&&(typeof r.fanout=="number"?o.fanout=n.longs===String?String(r.fanout):r.fanout:o.fanout=n.longs===String?R.Long.prototype.toString.call(r.fanout):n.longs===Number?new R.LongBits(r.fanout.low>>>0,r.fanout.high>>>0).toNumber(!0):r.fanout),r.mode!=null&&r.hasOwnProperty("mode")&&(o.mode=r.mode),r.mtime!=null&&r.hasOwnProperty("mtime")&&(o.mtime=we.UnixTime.toObject(r.mtime,n)),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,$t.default.util.toJSONOptions)},t.DataType=function(){let e={},r=Object.create(e);return r[e[0]="Raw"]=0,r[e[1]="Directory"]=1,r[e[2]="File"]=2,r[e[3]="Metadata"]=3,r[e[4]="Symlink"]=4,r[e[5]="HAMTShard"]=5,r}(),t})(),nO=we.UnixTime=(()=>{function t(e){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)e[r[n]]!=null&&(this[r[n]]=e[r[n]])}return t.prototype.Seconds=R.Long?R.Long.fromBits(0,0,!1):0,t.prototype.FractionalNanoseconds=0,t.encode=function(r,n){return n||(n=Ol.create()),n.uint32(8).int64(r.Seconds),r.FractionalNanoseconds!=null&&Object.hasOwnProperty.call(r,"FractionalNanoseconds")&&n.uint32(21).fixed32(r.FractionalNanoseconds),n},t.decode=function(r,n){r instanceof Nn||(r=Nn.create(r));for(var o=n===void 0?r.len:r.pos+n,s=new we.UnixTime;r.pos<o;){var i=r.uint32();switch(i>>>3){case 1:s.Seconds=r.int64();break;case 2:s.FractionalNanoseconds=r.fixed32();break;default:r.skipType(i&7);break}}if(!s.hasOwnProperty("Seconds"))throw R.ProtocolError("missing required 'Seconds'",{instance:s});return s},t.fromObject=function(r){if(r instanceof we.UnixTime)return r;var n=new we.UnixTime;return r.Seconds!=null&&(R.Long?(n.Seconds=R.Long.fromValue(r.Seconds)).unsigned=!1:typeof r.Seconds=="string"?n.Seconds=parseInt(r.Seconds,10):typeof r.Seconds=="number"?n.Seconds=r.Seconds:typeof r.Seconds=="object"&&(n.Seconds=new R.LongBits(r.Seconds.low>>>0,r.Seconds.high>>>0).toNumber())),r.FractionalNanoseconds!=null&&(n.FractionalNanoseconds=r.FractionalNanoseconds>>>0),n},t.toObject=function(r,n){n||(n={});var o={};if(n.defaults){if(R.Long){var s=new R.Long(0,0,!1);o.Seconds=n.longs===String?s.toString():n.longs===Number?s.toNumber():s}else o.Seconds=n.longs===String?"0":0;o.FractionalNanoseconds=0}return r.Seconds!=null&&r.hasOwnProperty("Seconds")&&(typeof r.Seconds=="number"?o.Seconds=n.longs===String?String(r.Seconds):r.Seconds:o.Seconds=n.longs===String?R.Long.prototype.toString.call(r.Seconds):n.longs===Number?new R.LongBits(r.Seconds.low>>>0,r.Seconds.high>>>0).toNumber():r.Seconds),r.FractionalNanoseconds!=null&&r.hasOwnProperty("FractionalNanoseconds")&&(o.FractionalNanoseconds=r.FractionalNanoseconds),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,$t.default.util.toJSONOptions)},t})(),oO=we.Metadata=(()=>{function t(e){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)e[r[n]]!=null&&(this[r[n]]=e[r[n]])}return t.prototype.MimeType="",t.encode=function(r,n){return n||(n=Ol.create()),r.MimeType!=null&&Object.hasOwnProperty.call(r,"MimeType")&&n.uint32(10).string(r.MimeType),n},t.decode=function(r,n){r instanceof Nn||(r=Nn.create(r));for(var o=n===void 0?r.len:r.pos+n,s=new we.Metadata;r.pos<o;){var i=r.uint32();switch(i>>>3){case 1:s.MimeType=r.string();break;default:r.skipType(i&7);break}}return s},t.fromObject=function(r){if(r instanceof we.Metadata)return r;var n=new we.Metadata;return r.MimeType!=null&&(n.MimeType=String(r.MimeType)),n},t.toObject=function(r,n){n||(n={});var o={};return n.defaults&&(o.MimeType=""),r.MimeType!=null&&r.hasOwnProperty("MimeType")&&(o.MimeType=r.MimeType),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,$t.default.util.toJSONOptions)},t})();var z=$n.DataType;var bx=Object.freeze([]),Pl=new Uint8Array(0),Fe=Object.freeze({}),kx=parseInt("0644",8),vx=parseInt("0755",8),zn=Ga,Rl="UnixFS",mr=(t,e)=>(Object(globalThis).debug&&console.log({data:t,links:e}),$w(kl({Data:$n.encode(t).finish(),Links:e}))),Sx=t=>({type:z.Raw,content:t}),h8=t=>Ex(Pl,t),Ex=(t,e)=>({type:z.File,layout:"simple",content:t,metadata:Wr(e)}),p8=t=>({type:z.File,layout:"simple",content:t}),m8=(t,e)=>({type:z.File,layout:"advanced",parts:t,metadata:Wr(e)}),g8=t=>({type:z.File,layout:"advanced",parts:t}),y8=(t,e,r)=>({type:z.File,layout:"complex",content:t,parts:e,metadata:Wr(r)}),Xa=(t,e)=>({type:z.Directory,metadata:Wr(e),entries:t}),Ax=(t,e,r,n,o=Fe)=>({type:z.HAMTShard,bitfield:e,fanout:jl(r),hashType:Hl(n),entries:t,metadata:Wr(o)}),Nl=(t,e,r,n)=>({type:z.HAMTShard,bitfield:e,fanout:jl(r),hashType:Hl(n),entries:t}),$l=t=>mr({Type:z.Raw,Data:t.byteLength>0?t:void 0,filesize:t.byteLength,blocksizes:bx},[]),Tx=(t,e=!1)=>{let r=e?Fe:Object(t).metadata;switch(t.layout){case"simple":return tc(t.content,r);case"advanced":return Fl(t.parts,r);case"complex":return Ml(t.content,t.parts,r);default:throw new TypeError(`File with unknown layout "${Object(t).layout}" was passed`)}},zl=t=>tc(t,Fe),w8=t=>mr({Type:z.File,blocksizes:t.map(cs),filesize:xt(t)},t.map(ec)),Fl=(t,e=Fe)=>mr({Type:z.File,blocksizes:t.map(cs),filesize:xt(t),...fs(e)},t.map(ec)),ec=t=>({Name:"",Tsize:t.dagByteLength,Hash:t.cid}),tc=(t,e=Fe)=>mr({Type:z.File,Data:t.byteLength>0?t:void 0,filesize:t.byteLength,blocksizes:[],...fs(e)},[]),Ml=(t,e,r=Fe)=>mr({Type:z.File,Data:t,filesize:t.byteLength+xt(e),blocksizes:e.map(cs)},e.map(ec)),rc=t=>mr({Type:t.type,...Vl(t.metadata||Fe)},t.entries.map(Lx)),nc=({bitfield:t,fanout:e,hashType:r,entries:n,metadata:o=Fe})=>mr({Type:z.HAMTShard,Data:t.byteLength>0?t:void 0,fanout:jl(e),hashType:Hl(r),...Vl(o)},n.map(Lx)),jl=t=>{if(Math.log2(t)%1===0)return t;throw new TypeError(`Expected hamt size to be a power of two instead got ${t}`)},Hl=t=>{if(Number.isInteger(t))return t;throw new TypeError(`Expected an integer value instead got ${t}`)};var Ix=(t,e=Fe)=>({type:z.Symlink,content:t,metadata:Wr(e)}),Dx=(t,e=!1)=>{let r=e?Fe:Object(t).metadata;return mr({Type:z.Symlink,Data:t.content,...fs(r||Fe)},[])},Bx=(t,e=!0)=>{switch(t.type){case z.Raw:return $l(t.content);case z.File:return Tx(t);case z.Directory:return rc(t);case z.HAMTShard:return nc(t);case z.Symlink:return Dx(t);default:throw new Error(`Unknown node type ${Object(t).type}`)}},_x=t=>{let e=zw(t),r=$n.decode(e.Data),{Type:n,Data:o,mtime:s,mode:i,blocksizes:a,...c}=$n.toObject(r,{defaults:!1,arrays:!0,longs:Number,objects:!1}),u={...i&&{mode:i},...x8(s)},d=e.Links;switch(r.Type){case z.Raw:return Sx(o);case z.File:return d.length===0?new Za(o,u):o.byteLength===0?new Qa(wx(c.blocksizes,d),u):new Ya(o,wx(c.blocksizes,d),u);case z.Directory:return Xa(xx(d),u);case z.HAMTShard:return Ax(xx(d),o||Pl,c.fanout,c.hashType,u);case z.Symlink:return Ix(o,u);default:throw new TypeError(`Unsupported node type ${r.Type}`)}},x8=t=>t==null?void 0:{mtime:{secs:t.Seconds,nsecs:t.FractionalNanoseconds||0}};var wx=(t,e)=>{let r=[],n=t.length,o=0;for(;o<n;)r.push({cid:e[o].Hash,dagByteLength:e[o].Tsize||0,contentByteLength:t[o]});return r},xx=t=>t.map(e=>({cid:e.Hash,name:e.Name||"",dagByteLength:e.Tsize||0})),xt=t=>t.reduce((e,r)=>e+r.contentByteLength,0),gr=(t,e)=>e.reduce((r,n)=>r+n.dagByteLength,t.byteLength),cs=t=>t.contentByteLength,Lx=({name:t,dagByteLength:e,cid:r})=>({Name:t,Tsize:e,Hash:r}),Vl=t=>fs(t,vx),fs=({mode:t,mtime:e},r=kx)=>({mode:t!=null?Cx(t,r):void 0,mtime:e!=null?b8(e):void 0}),Wr=t=>t==null?Fe:{...t.mode==null?void 0:{mode:Ux(t.mode)},...t.mtime==null?void 0:{mtime:t.mtime}},b8=t=>t==null?void 0:t.nsecs!==0?{Seconds:t.secs,FractionalNanoseconds:t.nsecs}:{Seconds:t.secs},Cx=(t,e)=>{let r=t==null?void 0:Ux(t);return r===e||r==null?void 0:r},Ux=t=>t&4095|t&4294963200,k8=({content:t=Pl,parts:e=bx,metadata:r=Fe,...n})=>e.length===0?new Za(t,r):t.byteLength===0?new Qa(e,r):new Ya(t,e,r),Za=class{constructor(e,r){this.content=e,this.metadata=r,this.layout="simple",this.type=z.File}get filesize(){return this.content.byteLength}encode(){return tc(this.content,this.metadata)}},Qa=class{constructor(e,r){this.parts=e,this.metadata=r}get layout(){return"advanced"}get type(){return z.File}get fileSize(){return xt(this.parts)}get blockSizes(){return this.parts.map(cs)}encode(){return Fl(this.parts,this.metadata)}},Ya=class{constructor(e,r,n){this.content=e,this.parts=r,this.metadata=n}get layout(){return"complex"}get type(){return z.File}get fileSize(){return this.content.byteLength+xt(this.parts)}get blockSizes(){return this.parts.map(cs)}encode(){return Ml(this.content,this.parts,this.metadata)}},v8=t=>{switch(t.type){case z.Raw:case z.Symlink:return t.content.byteLength;case z.File:switch(t.layout){case"simple":return t.content.byteLength;case"advanced":return xt(t.parts);case"complex":return t.content.byteLength+xt(t.parts)}default:return 0}};var S8=function*(t){let e=yield*t;yield*sc(e)};function*Jl(){return yield cc}var jn=function*(){yield fc};var oc=function*(t){let e=yield*Jl();if(A8(t)){let r=!1,n;if(t.then(o=>{r=!1,n=o,yr(e)},o=>{r=!0,n=o,yr(e)}),yield*jn(),r)throw n;return n}else return B8(E8(e)),yield*jn(),t};function*E8(t){yr(t)}var A8=t=>t!=null&&typeof t.then=="function",sc=function*(t){yield t},ic=function*(t){let e=[];for(let r of Object.entries(t)){let[n,o]=r;o!==ls&&e.push(yield*Vn(I8(o,n)))}yield*Ql(e)},ac=t=>t.length>0?T8(t.map(S8)):ls;function*T8(t){let e=[];for(let r of t)e.push(yield*Vn(r));yield*Ql(e)}var I8=(t,e)=>t===ls?ls:t instanceof us?new us([...t.tags,e],t.source):new us([e],t),us=class{constructor(e,r){this.tags=e,this.source=r,this.controller}[Symbol.iterator](){return this.controller||(this.controller=this.source[Symbol.iterator]()),this}box(e){if(e.done)return e;switch(e.value){case fc:case cc:return e;default:{let r=e,{value:n}=r;for(let o of this.tags)n=D8(o,n);return r.value=n,r}}}next(e){return this.box(this.controller.next(e))}throw(e){return this.box(this.controller.throw(e))}return(e){return this.box(this.controller.return(e))}get[Symbol.toStringTag](){return"TaggedEffect"}},hs=()=>ls;var D8=(t,e)=>({type:t,[t]:e});var cc=Symbol("current"),fc=Symbol("suspend");var zt=class t{static of(e){return e.group||Mn}static enqueue(e,r){e.group=r,r.stack.active.push(e)}constructor(e,r=[],n=new Set,o=new Hn(r,n)){this.driver=e,this.parent=t.of(e),this.stack=o,this.id=++Nx}},ql=class{constructor(){this.status=ds,this.stack=new Hn,this.id=0}},Hn=class{constructor(e=[],r=new Set){this.active=e,this.idle=r}static size({active:e,idle:r}){return e.length+r.size}},B8=t=>yr(t[Symbol.iterator]()),yr=t=>{let e=zt.of(t);for(e.stack.active.push(t),e.stack.idle.delete(t);e.parent;){let{idle:r,active:n}=e.parent.stack;if(r.has(e.driver))r.delete(e.driver),n.push(e.driver);else break;e=e.parent}if(Mn.status===ds)for(Mn.status=$x;;)try{for(let r of Zl(Mn));Mn.status=ds;break}catch{Mn.stack.active.shift()}},_8=t=>yr(t),Zl=function*(t){let{active:e}=t.stack,r=e[0];for(t.stack.idle.delete(r);r;){let n=zx;e:for(;!n.done&&r===e[0];){let o=n.value;switch(o){case fc:t.stack.idle.add(r);break e;case cc:n=r.next(r);break;default:n=r.next(yield o);break}}e.shift(),r=e[0],t.stack.idle.delete(r)}};var Vn=(t,e)=>new Kl(t,e),L8=(t,e)=>Px(t,{ok:!0,value:e});var Wl=(t,e)=>Px(t,{ok:!1,error:e});function*Px(t,e){try{let r=t,n=e.ok?r.return(e.value):r.throw(e.error);if(!n.done)if(n.value===fc){let{idle:o}=zt.of(r).stack;o.add(r)}else yr(r)}catch{}}function*Ql(t){if(t.length===0)return;let e=yield*Jl(),r=new zt(e),n=null;for(let o of t){let{result:s}=o;if(s){!s.ok&&!n&&(n=s);continue}C8(o,r)}try{if(n)throw n.error;for(;yield*Zl(r),Hn.size(r.stack)>0;)yield*jn()}catch(o){for(let s of r.stack.active)yield*Wl(s,o);for(let s of r.stack.idle)yield*Wl(s,o),yr(s);throw o}}var C8=(t,e)=>{let r=zt.of(t);if(r!==e){let{active:n,idle:o}=r.stack,s=e.stack;if(t.group=e,o.has(t))o.delete(t),s.idle.add(t);else{let i=n.indexOf(t);i>=0&&(n.splice(i,1),s.active.push(t))}}};function*Yl(t){t.status===ds&&(yield*t),t.result||(yield*Ql([t]));let e=t.result;if(e.ok)return e.value;throw e.error}var Gl=class{constructor(e){this.handler=e,this.result}get promise(){let{result:e}=this,r=e==null?new Promise((n,o)=>{this.handler.onsuccess=n,this.handler.onfailure=o}):e.ok?Promise.resolve(e.value):Promise.reject(e.error);return Object.defineProperty(this,"promise",{value:r}),r}then(e,r){return this.activate().promise.then(e,r)}catch(e){return this.activate().promise.catch(e)}finally(e){return this.activate().promise.finally(e)}activate(){return this}},Kl=class extends Gl{constructor(e,r=U8,n={},o=zx){super(n),this.id=++Nx,this.name=r.name||"",this.task=e,this.state=o,this.status=ds,this.result,this.handler=n,this.controller}*resume(){_8(this)}join(){return Yl(this)}abort(e){return Wl(this,e)}exit(e){return L8(this,e)}get[Symbol.toStringTag](){return"Fork"}*[Symbol.iterator](){return this.activate()}activate(){return this.controller=this.task[Symbol.iterator](),this.status=$x,yr(this),this}panic(e){this.result={ok:!1,error:e},this.status=Ox;let{handler:r}=this;throw r.onfailure&&r.onfailure(e),e}step(e){if(this.state=e,e.done){this.result={ok:!0,value:e.value},this.status=Ox;let{handler:r}=this;r.onsuccess&&r.onsuccess(e.value)}return e}next(e){try{return this.step(this.controller.next(e))}catch(r){return this.panic(r)}}return(e){try{return this.step(this.controller.return(e))}catch(r){return this.panic(r)}}throw(e){try{return this.step(this.controller.throw(e))}catch(r){return this.panic(r)}}},Rx=function*(t,e){let r=yield*Jl(),n=new zt(r);for(zt.enqueue(t[Symbol.iterator](),n);;){for(let o of Zl(n))zt.enqueue(e(o)[Symbol.iterator](),n);if(Hn.size(n.stack)>0)yield*jn();else break}},Nx=0,ds="idle",$x="active",Ox="finished",zx={done:!1,value:cc},U8={},ls=function*(){}(),Mn=new ql;function Xl(){}Object.defineProperties(Xl,{prototype:{value:new Proxy(Object.prototype,{get(t,e,r){return typeof e=="symbol"?Reflect.get(t,e,r):r.get(e)}})}});var eh=()=>new ps;var Mx=(t,e=0,r=t.byteLength)=>{let n=[],o=e<0?t.byteLength-e:e,s=r<0?t.byteLength-r:r;if(o===0&&s>=t.byteLength)return t;if(o>s||o>t.byteLength||s<=0)return eh();let i=0,a=0;for(let c of t.segments){let u=a+c.byteLength;if(i===0){if(s<=u){let d=c.subarray(o-a,s-a);n.push(d),i=d.byteLength;break}else if(o<u){let d=o===a?c:c.subarray(o-a);n.push(d),i=d.byteLength}}else if(s<=u){let d=s===u?c:c.subarray(0,s-a);n.push(d),i+=d.byteLength;break}else n.push(c),i+=c.byteLength;a=u}return new ps(n,t.byteOffset+o,i)},O8=(t,e)=>e.byteLength>0?(t.segments.push(e),new ps(t.segments,t.byteOffset,t.byteLength+e.byteLength)):t,P8=(t,e)=>{if(e<t.byteLength){let r=0;for(let n of t.segments){if(e<r+n.byteLength)return n[e-r];r+=n.byteLength}}},R8=(t,e,r)=>{let n=r;for(let o of t.segments)e.set(o,n),n+=o.byteLength;return e};function*N8(t){for(let e of t.segments)yield*e}var ps=class extends Xl{constructor(e=[],r=0,n=0){super(),this.segments=e,this.byteLength=n,this.length=n,this.byteOffset=r}[Symbol.iterator](){return N8(this)}slice(e,r){return Mx(this,e,r)}subarray(e,r){return Mx(this,e,r)}push(e){return O8(this,e)}get(e){return P8(this,e)}copyTo(e,r){return R8(this,e,r)}};var ms=t=>{throw new Error(t)},jx=(t,e,...r)=>ms(String.raw(t,JSON.stringify(e),...r)),Hx=new Uint8Array(0),Vx=[];var qx=t=>({config:t,buffer:eh()}),Wx=(t,e)=>e.byteLength>0?Kx(t.config,t.buffer.push(e),!1):{...t,chunks:Vx},Gx=t=>Kx(t.config,t.buffer,!0),Kx=(t,e,r)=>{let n=t.chunker,o=[],s=0;for(let i of n.cut(n.context,e,r))if(i>0){let a=e.subarray(s,s+i);o.push(a),s+=i}return{config:t,chunks:o,buffer:e.subarray(s)}};var Jx=()=>({mutable:!0,needs:{},nodes:{},links:{},linked:nh});var oh=(t,e)=>{let r=qn(e,{});for(let n of t){let{ready:o,has:s,wants:i}=Qx(n.children,r.links);i.length===0?r=qn(r,{links:rh(void 0,s),linked:[{id:n.id,links:o}]}):r=qn(r,{needs:rh(n.id,i),nodes:{[n.id]:{children:n.children,count:i.length}}})}return r},Zx=(t,e,r)=>{let n=r.needs[t],o=r.nodes[n];if(o!=null)if(o.count===1){let{ready:s,has:i}=Qx(o.children,{...r.links,[t]:e});return qn(r,{needs:{[t]:void 0},links:rh(void 0,i),nodes:{[n]:void 0},linked:[{id:n,links:s}]})}else return qn(r,{needs:{[t]:void 0},links:{[t]:e},nodes:{[n]:{...o,count:o.count-1}}});else return qn(r,{links:{[t]:e}})},qn=(t,{needs:e,nodes:r,links:n,linked:o})=>{let s=t.mutable?t:{...t},i=t.mutable?M8:void 0;return e&&(s.needs=th(t.needs,e,i)),r&&(s.nodes=th(t.nodes,r,i)),n&&(s.links=th(t.links,n,i)),s.linked=o?F8(t.linked||nh,o,nh):t.linked||[],s},rh=(t,e)=>{let r={};for(let n of e)r[n]=t;return r},th=(t,e,r=t)=>{let n=t===r?{...t}:t;for(let o of Object.entries(e)){let[s,i]=o;i==null?delete n[s]:n[s]=i}return n};var F8=(t,e,r=t)=>{if(t===r)return[...t,...e];for(let n of e)t.push(n);return t},Qx=(t,e)=>{let r=[],n=[],o=[];for(let s of t){let i=e[s];i?(r.push(s),o.push(i)):n.push(s)}return{has:r,wants:n,ready:o}},nh=Object.freeze([]),M8=Object.freeze({});var Yx=(t,e)=>{switch(t.type){case"write":return H8(e,t.bytes);case"link":return V8(e,t.link);case"block":return{state:e,effect:hs()};case"close":return q8(e);case"end":return{state:e,effect:hs()};default:return jx`File Writer got unknown message ${t}`}},Xx=(t,e,r)=>({status:"open",metadata:e,config:r,writer:t,chunker:qx({chunker:r.chunker}),layout:r.fileLayout.open(),nodeQueue:Jx()}),H8=(t,e)=>{if(t.status==="open"){let{chunks:r,...n}=Wx(t.chunker,e),{nodes:o,leaves:s,layout:i}=t.config.fileLayout.write(t.layout,r),{linked:a,...c}=oh(o,t.nodeQueue),u=[...eb(s,t.config),...sh(a,t.config)];return{state:{...t,chunker:n,layout:i,nodeQueue:c},effect:ic({link:ac(u)})}}else return ms("Unable to perform write on closed file")},V8=(t,{id:e,link:r,block:n})=>{let{linked:o,...s}=Zx(e,r,t.nodeQueue),i=sh(o,t.config),a=t.status==="closed"&&e===t.rootID?{...t,status:"linked",link:r,nodeQueue:s}:{...t,nodeQueue:s},c=t.status==="closed"&&e===t.rootID&&t.end?t.end.resume():hs();return{state:a,effect:ic({link:ac(i),block:K8(t.writer,n),end:c})}},q8=t=>{if(t.status==="open"){let{chunks:e}=Gx(t.chunker),{layout:r,...n}=t.config.fileLayout.write(t.layout,e),{root:o,...s}=t.config.fileLayout.close(r,t.metadata),[i,a]=Z8(o)?[[...n.nodes,...s.nodes],[...n.leaves,...s.leaves,o]]:[[...n.nodes,...s.nodes,o],[...n.leaves,...s.leaves]],{linked:c,...u}=oh(i,t.nodeQueue),d=[...eb(a,t.config),...sh(c,t.config)],h=Vn(jn());return{state:{...t,chunker:null,layout:null,rootID:o.id,status:"closed",end:h,nodeQueue:u},effect:ic({link:ac(d),end:Yl(h)})}}else return{state:t,effect:hs()}},eb=(t,e)=>t.map(r=>W8(e,r,e.fileChunkEncoder)),W8=function*({hasher:t,linker:e},{id:r,content:n},o){let s=o.encode(n?J8(n):Hx),i=yield*oc(t.digest(s)),a=e.createLink(o.code,i),c={cid:a,bytes:s},u={cid:a,contentByteLength:n?n.byteLength:0,dagByteLength:s.byteLength};return{id:r,block:c,link:u}},sh=(t,e)=>t.map(r=>G8(e,r)),G8=function*(t,{id:e,links:r},n){let o=t.fileEncoder.encode({type:z.File,layout:"advanced",parts:r,metadata:n}),s=yield*oc(Promise.resolve(t.hasher.digest(o))),i=t.linker.createLink(t.fileEncoder.code,s),a={bytes:o,cid:i},c={cid:i,contentByteLength:xt(r),dagByteLength:gr(o,r)};return{id:e,block:a,link:c}},K8=function*(t,e){(t.desiredSize||0)<=0&&(yield*oc(t.ready)),t.write(e)},J8=t=>t instanceof Uint8Array?t:t.copyTo(new Uint8Array(t.byteLength),0),Z8=t=>t.children==null;var ah={};C(ah,{context:()=>Y8,cut:()=>rb,name:()=>tb,type:()=>X8,withMaxChunkSize:()=>ih});var tb="fixed",Y8={maxChunkSize:262144},X8="Stateless",ih=t=>({type:"Stateless",context:{maxChunkSize:t},name:tb,cut:rb}),rb=({maxChunkSize:t},{byteLength:e},r)=>{let n=e/t|0,o=new Array(n).fill(t),s=r?e-n*t:0;return s>0&&o.push(s),o};var gs=class{constructor(e,r,n){this.id=e,this.children=r,this.metadata=n}},uc=t=>({open:()=>tT({width:t}),write:rT,close:nT}),eT={width:174},tT=({width:t}=eT)=>({width:t,head:null,leafIndex:[],nodeIndex:[],lastID:0}),rT=(t,e)=>{if(e.length===0)return{layout:t,nodes:_e,leaves:_e};{let{lastID:r}=t,[n,o]=t.head?[null,(e.unshift(t.head),e)]:e.length===1&&t.leafIndex.length===0?[e[0],_e]:[null,e];if(o.length===0)return{layout:{...t,head:n},nodes:_e,leaves:_e};{let s=[...t.leafIndex],i=[];for(let a of o){let c={id:++r,content:a};i.push(c),s.push(c.id)}return s.length>t.width?ob({...t,leafIndex:s,head:n,lastID:r},i):{layout:{...t,head:n,leafIndex:s,lastID:r},leaves:i,nodes:_e}}}},ob=(t,e=_e,r=[],n=!1)=>{let{lastID:o}=t,s=t.nodeIndex.map(u=>[...u]),i=[...t.leafIndex],{width:a}=t;for(;i.length>a||i.length>0&&n;){nb(s,1);let u=new gs(++o,i.splice(0,a));s[0].push(u.id),r.push(u)}let c=0;for(;c<s.length;){let u=s[c];for(c++;u.length>a||u.length>0&&n&&c<s.length;){let d=new gs(++o,u.splice(0,a));nb(s,c+1),s[c].push(d.id),r.push(d)}}return{layout:{...t,lastID:o,leafIndex:i,nodeIndex:s},leaves:e,nodes:r}},nT=(t,e)=>{let r=t;if(t.head)return{root:{id:1,content:t.head,metadata:e},leaves:_e,nodes:_e};if(t.leafIndex.length===0)return{root:{id:1,metadata:e},leaves:_e,nodes:_e};{let{nodes:n,layout:o}=ob(r,_e,[],!0),{nodeIndex:s}=o,i=s.length-1,a=s[i];if(a.length===1){let c=n[n.length-1];return n.length=n.length-1,{root:c,nodes:n,leaves:_e}}else return{root:new gs(o.lastID+1,a,e),nodes:n,leaves:_e}}},nb=(t,e)=>{for(;t.length<e;)t.push([]);return t},_e=[];var Ft=()=>({chunker:ah,fileChunkEncoder:ch,smallFileEncoder:ch,fileEncoder:Fn,fileLayout:uc(174),hasher:Ie,linker:{createLink:ve.createV1}}),wr=t=>({...Ft(),...t}),ch={code:zn,name:Rl,encode:zl};var ys=({writer:t,metadata:e={},settings:r=Ft()})=>new fh(Xx(t,e,wr(r))),sb=async(t,e)=>(await ab(t,sc({type:"write",bytes:e})),t),ib=async(t,{releaseLock:e=!1,closeWriter:r=!1}={})=>{await ab(t,sc({type:"close"}));let{state:n}=t;if(n.status==="linked")return r?await t.state.writer.close():e&&t.state.writer.releaseLock(),n.link;ms(`Expected writer to be in 'linked' state after close, but it is in "${n.status}" instead`)},ab=(t,e)=>Vn(Rx(e,r=>{let{state:n,effect:o}=Yx(r,t.state);return t.state=n,o})),fh=class{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.config}write(e){return sb(this,e)}close(e){return ib(this,e)}};var sT=Ft,ws=({writer:t,settings:e=sT(),metadata:r={}})=>new dc({writer:t,metadata:r,settings:e,entries:new Map,closed:!1}),xs=(t,e,r,{overwrite:n=!1}={})=>{let o=dh(t.state);if(e.includes("/"))throw new Error(`Directory entry name "${e}" contains forbidden "/" character`);if(!n&&o.entries.has(e))throw new Error(`Directory already contains entry with name "${e}"`);return o.entries.set(e,r),t},bs=(t,e)=>(dh(t.state).entries.delete(e),t),dh=t=>{if(t.closed)throw new Error("Can not change written directory, but you can .fork() and make changes to it");return t},cb=async(t,{closeWriter:e=!1,releaseLock:r=!1}={})=>{let{writer:n,settings:o,metadata:s}=dh(t.state);t.state.closed=!0;let i=[...fb(t)],a=Xa(i,s),c=rc(a),u=await o.hasher.digest(c),d=o.linker.createLink(zn,u);return(n.desiredSize||0)<=0&&await n.ready,n.write({cid:d,bytes:c}),e?await n.close():r&&n.releaseLock(),{cid:d,dagByteLength:gr(c,i)}},fb=function*({state:t}){for(let[e,{dagByteLength:r,cid:n}]of t.entries)yield{name:e,dagByteLength:r,cid:n}},ub=({state:t},{writer:e=t.writer,metadata:r=t.metadata,settings:n=t.settings}={})=>new dc({writer:e,metadata:r,settings:n,entries:new Map(t.entries.entries()),closed:!1}),dc=class{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.settings}links(){return fb(this)}set(e,r,n){return xs(this,e,r,n)}remove(e){return bs(this,e)}fork(e){return ub(this,e)}close(e){return cb(this,e)}entries(){return this.state.entries.entries()}has(e){return this.state.entries.has(e)}get size(){return this.state.entries.size}};var pc={};C(pc,{API:()=>lc,and:()=>hT,bitCount:()=>hc,empty:()=>db,from:()=>aT,fromBytes:()=>gT,get:()=>lT,or:()=>pT,popcount:()=>lh,set:()=>lb,size:()=>cT,toBytes:()=>mT,unset:()=>dT});var lc={};var db=(t=32)=>{if(t!==32)throw new Error(`Uint32 BitField does not support size: ${t}`);return 0},aT=(t,e)=>{let r=db(e);for(let n of t)r=lb(r,n);return r},cT=t=>32,fT=(t,e)=>t>>>e&31,uT=(t,e)=>1<<fT(t,e),lh=(t,e=31)=>hc(t&uT(e,0)-1),lb=(t,e)=>t|1<<e,dT=(t,e)=>t&(255^1<<e),lT=(t,e)=>(t>>e&1)!==0,hc=t=>{let e=t-(t>>1&1431655765),r=(e&858993459)+(e>>2&858993459);return(r+(r>>4)&252645135)*16843009>>24},hT=(t,e)=>t&e,pT=(t,e)=>t|e,mT=t=>Uint8Array.of(t>>24&255,t>>16&255,t>>8&255,t&255),gT=t=>{if(t.length!==4)throw new Error(`Expected 4 bytes instead got ${t.length}`);return(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3]};var mb=Ht(hh(),1),yT=new TextEncoder,wT=mb.default.x64.hash126,gb=({bitWidth:t=5,hash:e=wT})=>{if(t>4*8)throw new RangeError(`Can not use bitWidth ${t} which exceeds the hashSize 4`);if(4*8>32)throw new RangeError("Can not use hashSize 4 as it can not be encoded in Uint32");let n=4294967295>>>32-t;return{at:(i,a)=>i>>>a*t&n,from:i=>e(yT.encode(i)),size:Math.ceil(4*8/t)}};var Wn=class{constructor(e,r,n,o,s){this.edit=e,this.config=s,this.datamap=r,this.nodemap=n,this.children=o}get nodeArity(){return this.config.BitField.popcount(this.nodemap)}get dataArity(){return this.config.BitField.popcount(this.datamap)}empty(){return Ss(this.config)}lookup(e,r,n,o){return wb(this,e,r,n,o)}associate(e,r,n,o,s,i){return gh(this,e,r,n,o,s,i)}dissociate(e,r,n,o,s){return xb(this,e,r,n,o,s)}fork(e=null){return Es(this,e)}entries(){return bb(this)}keys(){return kb(this)}values(){return vb(this)}},gc=class{constructor(e,r,n,o){this.edit=e,this.count=r,this.children=n,this.config=o}get nodeArity(){return 0}get dataArity(){return this.count}lookup(e,r,n,o){return xT(this,n,o)}associate(e,r,n,o,s,i){return bT(this,e,n,o,s,i)}dissociate(e,r,n,o,s){return kT(this,e,n,o,s)}fork(e=null){return vT(this,e)}entries(){return bb(this)}keys(){return kb(this)}values(){return vb(this)}},xT=(t,e,r)=>{let{children:n,count:o}=t,s=ph(n,o,e);return n[s]===e?n[s+1]:r},bT=(t,e,r,n,o,s)=>{let{children:i,count:a}=t,c=ph(i,a,n);if(i[c]!==n){let u=t.fork(e);return s.value=!0,u.count+=1,u.children.splice(c,r,o),u}else if(i[c+1]!==o){let u=t.fork(e);return u.children[c+1]=o,u}else return t},kT=(t,e,r,n,o)=>{let{children:s,count:i,config:a}=t,c=ph(s,i,n);if(s[c]!==n)return t;if(o.value=!0,i===2){let u=c===0?2:0;return gh(Ss(a),e,0,r,s[u],s[u+1],o)}else{let u=t.fork(e);return u.children.splice(c,2),u.count-=1,u}},vT=(t,e=null)=>Tb(t.edit,e)?t:new gc(e,t.count,t.children.slice(),t.config),ph=(t,e,r)=>{let n=0;for(;n<e&&t[n]>r;)n+=2;return n};var Ss=(t,e=null)=>new Wn(e,t.BitField.empty(Math.pow(2,t.bitWidth)),t.BitField.empty(Math.pow(2,t.bitWidth)),[],t),yc=(t,e,r)=>wb(t,0,t.config.Path.from(e),e,r),wb=(t,e,r,n,o)=>{let{datamap:s,nodemap:i,config:a}=t,{Path:c,BitField:u}=a,d=c.at(r,e);if(u.get(s,d)){let h=u.popcount(s,d);return As(t,h)===n?vs(t,h):o}else return u.get(i,d)?Is(t,d).lookup(e+1,r,n,o):o},mh=(t,e,r,n,o)=>gh(t,e,0,t.config.Path.from(r),r,n,o),gh=(t,e,r,n,o,s,i)=>{let{datamap:a,nodemap:c,config:u}=t,{Path:d,BitField:h}=u,w=d.at(n,r);if(h.get(a,w)){let f=h.popcount(a,w),l=As(t,f);if(o===l)return vs(t,f)===s?t:ST(t,e,f,s);{let m=Eb(u,e,r+1,d.from(l),l,vs(t,f),n,o,s);return i.value=!0,AT(t,e,w,m)}}else if(h.get(c,w)){let f=Is(t,w),l=f.associate(e,r+1,n,o,s,i);return f===l?t:Sb(t,e,w,l)}else{let f=h.popcount(a,w);i.value=!0;let l=t.fork(e);return l.datamap=h.set(a,w),l.children.splice(Ts(f),0,o,s),l}},yh=(t,e,r,n)=>xb(t,e,0,t.config.Path.from(r),r,n);var xb=(t,e,r,n,o,s)=>{let{datamap:i,nodemap:a,config:c}=t,{BitField:u,Path:d}=c,h=d.at(n,r);if(u.get(i,h)){let w=u.popcount(i,h);if(o===As(t,w)){s.value=!0;let f=Es(t,e);return f.datamap=u.unset(t.datamap,h),f.children.splice(Ts(w),2),f}else return t}else if(u.get(a,h)){let w=Is(t,h),f=w.dissociate(e,r+1,n,o,s);return TT(f)?IT(t)?f:ET(t,e,h,f):w===f?t:Sb(t,e,h,f)}else return t},bb=function*({children:t}){let e=0,r=t.length;for(;e<r;){let n=t[e];if(typeof n=="string"){e+=1;let o=t[e];yield[n,o],e+=1}else break}for(;e<r;)yield*t[e].entries(),e+=1},Es=(t,e)=>Tb(t.edit,e)?t:new Wn(e,t.datamap,t.nodemap,t.children.slice(),t.config),kb=function*({children:t}){let e=0,r=t.length;for(;e<r;){let n=t[e];if(typeof n=="string")yield n,e+=2;else break}for(;e<r;)yield*t[e].keys(),e+=1},vb=function*({children:t}){let e=0,r=t.length;for(;e<r&&typeof t[e]=="string";)e+=1,yield t[e],e+=1;for(;e<r;)yield*t[e].values(),e+=1},ST=(t,e,r,n)=>{let o=t.fork(e);return o.children[Ab(r)]=n,o},ET=(t,e,r,n)=>{let{datamap:o,nodemap:s,config:i}=t,{BitField:a}=i,c=Es(t,e);return c.children.splice(wc(t,r),1),c.children.splice(Ts(a.popcount(o,r)),0,n.children[0],n.children[1]),c.datamap=a.set(o,r),c.nodemap=a.unset(s,r),c},Sb=(t,e,r,n)=>{let o=Es(t,e);return o.children[wc(t,r)]=n,o},AT=(t,e,r,n)=>{let{nodemap:o,datamap:s,config:i}=t,{BitField:a}=i,c=a.popcount(s,r),u=Ts(c),d=wc(t,r),h=Es(t,e);return h.datamap=a.unset(s,r),h.children.splice(u,2),h.nodemap=a.set(o,r),h.children.splice(d-1,0,n),h},Eb=(t,e,r,n,o,s,i,a,c)=>{let{BitField:u,Path:d}=t;if(d.size<r)return new gc(e,2,[o,s,a,c],t);{let h=d.at(n,r),w=d.at(i,r);return h===w?new Wn(e,u.empty(Math.pow(2,t.bitWidth)),u.from([h],Math.pow(2,t.bitWidth)),[Eb(t,e,r+1,n,o,s,i,a,c)],t):new Wn(e,u.from([h,w],Math.pow(2,t.bitWidth)),u.empty(Math.pow(2,t.bitWidth)),h<w?[o,s,a,c]:[a,c,o,s],t)}},As=({children:t},e)=>t[Ts(e)],Ts=t=>t*2,vs=({children:t},e)=>t[Ab(e)],Ab=t=>t*2+1,Is=(t,e)=>t.children[wc(t,e)],wc=({children:t,nodemap:e,config:r},n)=>t.length-1-r.BitField.popcount(e,n),Tb=(t,e)=>t!=null&&t===e,TT=t=>t.nodeArity===0&&t.dataArity===1,IT=({config:{BitField:t},datamap:e,nodemap:r})=>t.popcount(e)===0&&t.popcount(r)===1;var xc=Ht(hh(),1);function DT(t){let e=new Array(4);for(let r=0;r<4;r++)e[r]=t&255,t=t>>8;return new Uint8Array(e)}var OO=Tr({name:"murmur3-32",code:35,encode:t=>DT(xc.default.x86.hash32(t))}),PO=Tr({name:"murmur3-128",code:34,encode:t=>kr.fromHex(xc.default.x64.hash128(t))}),Gn=Tr({name:"murmur3-x64-64",code:34,encode:t=>kr.fromHex(xc.default.x64.hash128(t)).subarray(0,8)});var BT=new TextEncoder,_T=t=>Gn.encode(t),Db=({bitWidth:t=8,hash:e=_T}={})=>{let r=e(new Uint8Array).byteLength;return{from:s=>e(BT.encode(s)),at:(s,i)=>{let a=i*t;if(a>r)throw new RangeError("Out of bounds");return wh(s,a,t)},size:Math.ceil(r*8/t)}},wh=(t,e,r)=>{let n=e/8|0,o=e%8,s=r,i=0;for(;s>0&&n<t.byteLength;){let a=t[n],c=8-o,u=c<s?c:s,d=8-o-u,w=(255>>o&a)>>d;i=(i<<u)+w,s-=u,n++,o=0}return i};var xh={};C(xh,{API:()=>lc,and:()=>MT,empty:()=>Bb,from:()=>CT,fromBytes:()=>$T,get:()=>RT,or:()=>FT,popcount:()=>zT,set:()=>OT,size:()=>UT,toBytes:()=>NT,unset:()=>PT});var Bb=(t=256)=>{if(t%8!==0)throw new Error("Must be multiple of 8");return new Uint8Array(t/8)},CT=(t,e)=>{let r=Bb(e);for(let n of t){let{byte:o,byteOffset:s,bitOffset:i}=Ds(r,n);r[s]=o|1<<i}return r},UT=t=>t.byteLength*8,Ds=(t,e)=>{let r=t.byteLength-1-(e/8|0),n=e%8;return{byte:t[r],byteOffset:r,bitOffset:n}},_b=(t,e,r)=>{if(t[e]!==r){let n=t.slice(0);return n[e]=r,n}return t},OT=(t,e)=>{let{byte:r,byteOffset:n,bitOffset:o}=Ds(t,e);return _b(t,n,r|1<<o)},PT=(t,e)=>{let{byte:r,byteOffset:n,bitOffset:o}=Ds(t,e);return _b(t,n,r&(255^1<<o))},RT=(t,e)=>{var{byte:r,bitOffset:n}=Ds(t,e);return(r>>n&1)!==0},NT=t=>t,$T=t=>t,zT=(t,e=t.byteLength*8)=>{let{byteOffset:r,bitOffset:n,byte:o}=Ds(t,e),s=lh(o,n),i=t.byteLength-1;for(;i>r;){let a=t[i];s+=hc(a),i--}return s},FT=(t,e)=>{let r=t.slice(),n=0;for(;n<t.length;)r[n]|=e[n],n++;return r},MT=(t,e)=>{let r=t.slice(),n=0;for(;n<t.length;)r[n]&=e[n],n++;return r};var Lb=new RangeError("Not Found");var jT=({bitWidth:t=5,BitField:e=t===5?pc:xh,Path:r=t===5?gb({bitWidth:t}):Db({bitWidth:t})}={})=>({bitWidth:t,BitField:e,Path:r}),Cb=(t,e)=>{let r=vh(e);for(let[n,o]of t)r.set(n,o);return r.build()},kh=(t,e)=>yc(t.root,e,Lb)!==Lb,Ub=(t,e,r=void 0)=>yc(t.root,e,r),vh=t=>{let e={},r=jT(t);return new bc(e,0,Ss(r,e),r)},bh=class t{constructor(e=0,r,n){this.count=e,this.root=r,this.config=n}get size(){return this.count}clone(){return new t(this.count,this.root,this.config)}empty(){return new t(0,Ss(this.config,null),this.config)}has(e){return kh(this,e)}get(e){return yc(this.root,e,void 0)}set(e,r){let n={value:!1},o=mh(this.root,null,e,r,n);return o===this.root?this:new t(n.value?this.count+1:this.count,o,this.config)}delete(e){let r=yh(this.root,null,e,{value:!1});return r===this.root?this:new t(this.count-1,r,this.config)}get bitField(){return this.config.BitField.or(this.root.datamap,this.root.nodemap)}[Symbol.iterator](){return this.entries()}entries(){return this.root.entries()}keys(){return this.root.keys()}values(){return this.root.values()}createBuilder(){return new bc({},this.count,this.root,this.config)}},bc=class{constructor(e,r,n,o){this.edit=e,this.count=r,this.root=n,this.config=o}get size(){if(this.edit)return this.count;throw new Error(".size was accessed on the finalized builder")}set(e,r){if(this.edit){let n={value:!1},o=mh(this.root,this.edit,e,r,n);return this.root!==o&&(this.root=o),n.value&&(this.count+=1),this}else throw new Error(".set was called on the finalized builder")}delete(e){if(this.edit){if(this.count===0)return this;let r={value:!1},n=yh(this.root,this.edit,e,r);return n!==this.root&&(this.root=n),r.value&&(this.count-=1),this}else throw new Error(".delete was called on the finalized builder")}build(){if(this.edit)return this.edit=null,new bh(this.count,this.root,this.config);throw new Error(".build was called on the finalized builder")}};var HT=new TextEncoder,VT=t=>Gn.encode(t),Pb=({bitWidth:t=8,hash:e=VT})=>{let r=e(new Uint8Array).byteLength,n={bitWidth:t,hash:e,hashSize:r};return{at:(i,a)=>qT(i,a,n),from:i=>HT.encode(i),size:1/0}},qT=(t,e=0,{bitWidth:r=8,hash:n,hashSize:o})=>{let s=o*8,i=0,a=r,c=r*e;for(;a>0;){let u=c/s>>0,d=n(u===0?t:WT(t,u)),h=s<=c?c%s:c,w=s-h,f=w<a?w:a;i=(i<<f)+wh(d,h,f),a-=f,c+=f}return i},WT=(t,e)=>{let r=new Uint8Array(t.byteLength+1).fill(e,t.byteLength);return r.set(t),r};var Rb=8,Nb={bitWidth:Rb,Path:Pb({bitWidth:Rb})},$b=t=>Math.pow(2,t.config.bitWidth);var Sh=(t=Nb)=>vh(t),zb=(t,e=Nb)=>Cb(t,e),Fb=({datamap:t,nodemap:e,config:{BitField:r}})=>KT(r.toBytes(r.or(t,e))),KT=t=>{let e=0;for(;e<t.byteLength;){if(t[e]!==0)return t.subarray(e);e+=1}return t.subarray(e)},Mb=function*(t){let{config:e,datamap:r,nodemap:n}=t,{BitField:o}=e,s=o.size(r),i=0,a=0;for(;i<s;){let c=i.toString(16).toUpperCase().padStart(2,"0");if(o.get(r,i)){let u=As(t,a);yield{prefix:c,key:u,value:vs(t,a)},a++}else o.get(n,i)&&(yield{prefix:c,node:Is(t,i)});i++}};function kc({enumerable:t=!0,configurable:e=!1}={}){return{enumerable:t,configurable:e,writable:!1}}function*ZT(t,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(let[r,n]of e.entries()){let o=[...t,r],s=ve.asCID(n);s?yield[o.join("/"),s]:typeof n=="object"&&(yield*Eh(n,o))}else{let r=ve.asCID(e);r?yield[t.join("/"),r]:yield*Eh(e,t)}}function*Eh(t,e){if(t==null||t instanceof Uint8Array)return;let r=ve.asCID(t);r&&(yield[e.join("/"),r]);for(let[n,o]of Object.entries(t)){let s=[...e,n];yield*ZT(s,o)}}function*QT(t,e){if(Array.isArray(e))for(let[r,n]of e.entries()){let o=[...t,r];yield o.join("/"),typeof n=="object"&&!ve.asCID(n)&&(yield*Ah(n,o))}else yield*Ah(e,t)}function*Ah(t,e){if(!(t==null||typeof t!="object"))for(let[r,n]of Object.entries(t)){let o=[...e,r];yield o.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&!ve.asCID(n)&&(yield*QT(o,n))}}function YT(t,e){let r=t;for(let[n,o]of e.entries()){if(r=r[o],r==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(i=>`[${JSON.stringify(i)}]`).join("")}`);let s=ve.asCID(r);if(s)return{value:s,remaining:e.slice(n+1).join("/")}}return{value:r}}var vc=class{constructor({cid:e,bytes:r,value:n}){if(!e||!r||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=r,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:kc(),bytes:kc(),value:kc(),asBlock:kc()})}links(){return Eh(this.value,[])}tree(){return Ah(this.value,[])}get(e="/"){return YT(this.value,e.split("/").filter(Boolean))}};var XT=Ft,Th=({writer:t,settings:e=XT(),metadata:r={}})=>new Sc({writer:t,metadata:r,settings:e,entries:new Bs,closed:!1}),eI=t=>{if(t.closed)throw new Error("Can not change written HAMT directory, but you can .fork() and make changes to it");return t},jb=async(t,{closeWriter:e=!1,releaseLock:r=!1}={})=>{let{writer:n,settings:o,metadata:s}=eI(t.state);t.state.closed=!0;let{entries:i}=t.state;if(!(i instanceof Bs))throw new Error(`not a HAMT: ${i}`);let a=i.builder.build(),c=Hb(a,a.root,o),u=null;for await(let d of c)u=d,(n.desiredSize||0)<=0&&await n.ready,n.write(d);if(u==null)throw new Error("no root block yielded");return e?await n.close():r&&n.releaseLock(),{cid:u.cid,dagByteLength:gr(u.bytes,u.value.entries)}},Hb=async function*(t,e,r){let n=[];for(let s of Mb(e))if("key"in s)n.push({name:`${s.prefix??""}${s.key??""}`,dagByteLength:s.value.dagByteLength,cid:s.value.cid});else{let i=null;for await(let a of Hb(t,s.node,r))yield a,i=a;if(i==null)throw new Error("no root block yielded");n.push({name:s.prefix,dagByteLength:gr(i.bytes,i.value.entries),cid:i.cid})}let o=Nl(n,Fb(e),$b(t),Gn.code);yield await tI(o,r)};async function tI(t,e){let r=nc(t),n=await e.hasher.digest(r),o=e.linker.createLink(Ga,n);return new vc({cid:o,bytes:r,value:t})}var Vb=({state:t},{writer:e=t.writer,metadata:r=t.metadata,settings:n=t.settings}={})=>new Sc({writer:e,metadata:r,settings:n,entries:new Bs(zb(t.entries.entries()).createBuilder()),closed:!1}),Sc=class{constructor(e){this.state=e}get writer(){return this.state.writer}get settings(){return this.state.settings}set(e,r,n){return xs(this,e,r,n)}remove(e){return bs(this,e)}fork(e){return Vb(this,e)}close(e){return jb(this,e)}entries(){return this.state.entries.entries()}has(e){return this.state.entries.has(e)}get size(){return this.state.entries.size}},Bs=class extends Map{constructor(e=Sh()){super(),this.builder=e}clear(){this.builder=Sh()}delete(e){let{root:r}=this.builder;return this.builder.delete(e),this.builder.root!==r}forEach(e,r=this){for(let[n,o]of this.builder.root.entries())e.call(r,o,n,this)}get(e){return Ub(this.builder,e)}has(e){return kh(this.builder,e)}set(e,r){return this.builder.set(e,r),this}get size(){return this.builder.size}[Symbol.iterator](){return this.builder.root.entries()}entries(){return this.builder.root.entries()}keys(){return this.builder.root.keys()}values(){return this.builder.root.values()}};var Dh=({writable:t,settings:e=Ft()})=>new Ih({writer:t.getWriter(),settings:e}),rI=async(t,{releaseLock:e=!0,closeWriter:r=!0}={})=>(r?await t.writer.close():e&&t.writer.releaseLock(),t),Ih=class{constructor({writer:e,settings:r}){this.writer=e,this.settings=wr(r)}createFileWriter({settings:e=this.settings,metadata:r}={}){return ys({writer:this.writer,settings:e,metadata:r})}createDirectoryWriter({settings:e=this.settings,metadata:r}={}){return ws({writer:this.writer,settings:e,metadata:r})}close(e){return rI(this,e)}},nI=1048576,oI=nI*100,qb=(t=oI)=>({highWaterMark:t,size:e=>e.bytes.length});var iI=1e3,Wb=qb(),Gb=wr({fileChunkEncoder:Vo,smallFileEncoder:Vo,chunker:ih(1024*1024),fileLayout:uc(1024)});async function aI(t,e){let r=Ac(t,e),n=await Kb(r);return{cid:n.at(-1).cid,blocks:n}}function Ac(t,e){let{readable:r,writable:n}=new TransformStream({},Wb),o=e?.settings??Gb,s=Dh({writable:n,settings:o}),i=new Ec("",t);return(async()=>(await i.finalize(s),await s.close()))(),r}var Ls,Ec=class{constructor(e,r){it(this,Ls);this.name=e,at(this,Ls,r)}async finalize(e){let r=ys(e);return await te(this,Ls).stream().pipeTo(new WritableStream({async write(n){await r.write(n)}})),await r.close()}};Ls=new WeakMap;var Kn,_s=class{constructor(e,r){it(this,Kn);F(this,"entries",new Map);this.name=e,at(this,Kn,r)}async finalize(e){let r=this.entries.size<=iI?ws(e):Th(e);for(let[n,o]of this.entries){let s=await o.finalize(e);te(this,Kn)?.onDirectoryEntryLink&&te(this,Kn).onDirectoryEntryLink({name:o.name,...s}),r.set(n,s)}return await r.close()}};Kn=new WeakMap;async function cI(t,e){let r=Tc(t,e),n=await Kb(r);return{cid:n.at(-1).cid,blocks:n}}function Tc(t,e){let r=new _s("",e);for(let a of t){let c=a.name.split("/");(c[0]===""||c[0]===".")&&c.shift();let u=r;for(let[d,h]of c.entries()){if(d===c.length-1){u.entries.set(h,new Ec(c.join("/"),a));break}let w=u.entries.get(h);if(w==null){let f=u===r?h:`${u.name}/${h}`;w=new _s(f,e),u.entries.set(h,w)}if(!(w instanceof _s))throw new Error(`"${a.name}" cannot be a file and a directory`);u=w}}let{readable:n,writable:o}=new TransformStream({},Wb),s=e?.settings??Gb,i=Dh({writable:o,settings:s});return(async()=>{let a=await r.finalize(i);e?.onDirectoryEntryLink&&e.onDirectoryEntryLink({name:"",...a}),await i.close()})(),n}async function Kb(t){let e=[];return await t.pipeTo(new WritableStream({write(r){e.push(r)}})),e}var r0={};C(r0,{BlockStream:()=>Os,blockEncodingLength:()=>Uh,blockHeaderEncodingLength:()=>Ps,code:()=>Cc,encode:()=>Oh,headerEncodingLength:()=>Zn});Fc();Fc();async function Ic(t,e){let r=lt(await t.upTo(8),t);if(r===0)throw new Error("Invalid CAR header (zero length)");let n=await t.exactly(r,!0),o=ke(n);if(Ti.toTyped(o)===void 0)throw new Error("Invalid CAR header format");if(o.version!==1&&o.version!==2||e!==void 0&&o.version!==e)throw new Error(`Invalid CAR version: ${o.version}${e!==void 0?` (expected ${e})`:""}`);if(o.version===1){if(!Array.isArray(o.roots))throw new Error("Invalid CAR header format");return o}if(o.roots!==void 0)throw new Error("Invalid CAR header format");let s=Ei(await t.exactly(Si,!0));t.seek(s.dataOffset-t.pos);let i=await Ic(t,1);return Object.assign(i,s)}async function fI(t){let e=await t.exactly(2,!1);if(e[0]===er.SHA2_256&&e[1]===er.LENGTH){let i=await t.exactly(34,!0),a=Ve(i);return G.create(0,er.DAG_PB,a)}let r=lt(await t.upTo(8),t);if(r!==1)throw new Error(`Unexpected CID version (${r})`);let n=lt(await t.upTo(8),t),o=await t.exactly(Ai(await t.upTo(8)),!0),s=Ve(o);return G.create(r,n,s)}async function Zb(t){let e=t.pos,r=lt(await t.upTo(8),t);if(r===0)throw new Error("Invalid CAR section (zero length)");r+=t.pos-e;let n=await fI(t),o=r-Number(t.pos-e);return{cid:n,length:r,blockLength:o}}async function uI(t){let{cid:e,blockLength:r}=await Zb(t);return{bytes:await t.exactly(r,!0),cid:e}}async function dI(t){let e=t.pos,{cid:r,length:n,blockLength:o}=await Zb(t),s={cid:r,length:n,blockLength:o,offset:e,blockOffset:t.pos};return t.seek(s.blockLength),s}function Dc(t){let e=(async()=>{let r=await Ic(t);if(r.version===2){let n=t.pos-r.dataOffset;t=hI(t,r.dataSize-n)}return r})();return{header:()=>e,async*blocks(){for(await e;(await t.upTo(8)).length>0;)yield await uI(t)},async*blocksIndex(){for(await e;(await t.upTo(8)).length>0;)yield await dI(t)}}}function Jn(t){let e=0;return{async upTo(r){return t.subarray(e,e+Math.min(r,t.length-e))},async exactly(r,n=!1){if(r>t.length-e)throw new Error("Unexpected end of data");let o=t.subarray(e,e+r);return n&&(e+=r),o},seek(r){e+=r},get pos(){return e}}}function lI(t){let e=0,r=0,n=0,o=new Uint8Array(0),s=async i=>{r=o.length-n;let a=[o.subarray(n)];for(;r<i;){let u=await t();if(u==null)break;r<0?u.length>r&&a.push(u.subarray(-r)):a.push(u),r+=u.length}o=new Uint8Array(a.reduce((u,d)=>u+d.length,0));let c=0;for(let u of a)o.set(u,c),c+=u.length;n=0};return{async upTo(i){return o.length-n<i&&await s(i),o.subarray(n,n+Math.min(o.length-n,i))},async exactly(i,a=!1){if(o.length-n<i&&await s(i),o.length-n<i)throw new Error("Unexpected end of data");let c=o.subarray(n,n+i);return a&&(e+=i,n+=i),c},seek(i){e+=i,n+=i},get pos(){return e}}}function Bc(t){let e=t[Symbol.asyncIterator]();async function r(){let n=await e.next();return n.done?null:n.value}return lI(r)}function hI(t,e){let r=0;return{async upTo(n){let o=await t.upTo(n);return o.length+r>e&&(o=o.subarray(0,e-r)),o},async exactly(n,o=!1){let s=await t.exactly(n,o);if(s.length+r>e)throw new Error("Unexpected end of data");return o&&(r+=n),s},seek(n){r+=n,t.seek(n)},get pos(){return t.pos}}}var Bh=class{constructor(e,r,n){this._version=e,this._roots=r,this._iterable=n,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}},Cs=class t extends Bh{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(e){let{version:r,roots:n,iterator:o}=await gI(e);return new t(r,n,o)}static async fromIterable(e){let{version:r,roots:n,iterator:o}=await yI(e);return new t(r,n,o)}};async function gI(t){if(!(t instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return Qb(Jn(t))}async function yI(t){if(!t||typeof t[Symbol.asyncIterator]!="function")throw new TypeError("fromIterable() requires an async iterable");return Qb(Bc(t))}async function Qb(t){let e=Dc(t),{version:r,roots:n}=await e.header();return{version:r,roots:n,iterator:e.blocks()}}var _h=Ht(Ms(),1),Yb=1;function Lh(t){let e=be({version:Yb,roots:t}),r=_h.default.encode(e.length),n=new Uint8Array(r.length+e.length);return n.set(r,0),n.set(e,r.length),n}function Xb(t){return{async setRoots(e){let r=Lh(e);await t.write(r)},async writeBlock(e){let{cid:r,bytes:n}=e;await t.write(new Uint8Array(_h.default.encode(r.bytes.length+n.length))),await t.write(r.bytes),n.length&&await t.write(n)},async close(){await t.end()},version(){return Yb}}}function _c(){}function e0(){let t=[],e=null,r=_c,n=!1,o=null,s=_c,i=()=>(e||(e=new Promise(u=>{r=()=>{e=null,r=_c,u()}})),e),a={write(u){t.push(u);let d=i();return s(),d},async end(){n=!0;let u=i();s(),await u}},c={async next(){let u=t.shift();return u?(t.length===0&&r(),{done:!1,value:u}):n?(r(),{done:!0,value:void 0}):(o||(o=new Promise(d=>{s=()=>(o=null,s=_c,d(c.next()))})),o)}};return{writer:a,iterator:c}}var Us=class t{constructor(e,r){this._encoder=r,this._mutex=r.setRoots(e),this._ended=!1}async put(e){if(!(e.bytes instanceof Uint8Array)||!e.cid)throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");let r=G.asCID(e.cid);if(!r)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then(()=>this._encoder.writeBlock({cid:r,bytes:e.bytes})),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}version(){return this._encoder.version()}static create(e){e=wI(e);let{encoder:r,iterator:n}=t0(),o=new t(e,r),s=new Lc(n);return{writer:o,out:s}}static createAppender(){let{encoder:e,iterator:r}=t0();e.setRoots=()=>Promise.resolve();let n=new t([],e),o=new Lc(r);return{writer:n,out:o}}static async updateRootsInBytes(e,r){let n=Jn(e);await Ic(n);let o=Lh(r);if(Number(n.pos)!==o.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${n.pos} bytes, new header is ${o.length} bytes)`);return e.set(o,0),e}},Lc=class{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}};function t0(){let t=e0(),{writer:e,iterator:r}=t;return{encoder:Xb(e),iterator:r}}function wI(t){if(t===void 0)return[];if(!Array.isArray(t)){let r=G.asCID(t);if(!r)throw new TypeError("roots must be a single CID or an array of CIDs");return[r]}let e=[];for(let r of t){let n=G.asCID(r);if(!n)throw new TypeError("roots must be a single CID or an array of CIDs");e.push(n)}return e}var Ch=Ht(Ms(),1),Cc=514,xI=18;function Zn(t){if(!t)return xI;let e=be({version:1,roots:[t]}).length;return Ch.default.encodingLength(e)+e}function Ps(t){let e=t.cid.bytes.length+t.bytes.length;return Ch.default.encodingLength(e)+t.cid.bytes.length}function Uh(t){return Ps(t)+t.bytes.length}async function Oh(t,e){let{writer:r,out:n}=Us.create(e),o;(async()=>{try{for await(let a of t)await r.put(a)}catch(a){o=a}finally{await r.close()}})();let s=[];for await(let a of n)s.push(a);if(o!=null)throw o;let i=e!=null?[e]:[];return Object.assign(new Blob(s),{version:1,roots:i})}var Os=class extends ReadableStream{constructor(e){let r=null,n=()=>r||(r=Cs.fromIterable(bI(e.stream())),r),o=null;super({async start(){o=(await n())[Symbol.asyncIterator]()},async pull(s){if(!o)throw new Error("missing blocks iterator");let{value:i,done:a}=await o.next();if(a)return s.close();s.enqueue(i)}}),this.getRoots=async()=>await(await n()).getRoots()}};function bI(t){return Symbol.asyncIterator in t?t:async function*(){let e=t.getReader();try{for(;;){let{done:r,value:n}=await e.read();if(r)return;yield n}}finally{e.releaseLock()}}()}function Mt(t=0){return new Uint8Array(t)}function xr(t=0){return new Uint8Array(t)}function Uc(t,e){for(let r=0;r<t.byteLength;r++){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0}function Oc(t,e){e==null&&(e=t.reduce((o,s)=>o+s.length,0));let r=xr(e),n=0;for(let o of t)r.set(o,n),n+=o.length;return r}var Ph={};C(Ph,{base10:()=>vI});var vI=Gt({prefix:"9",name:"base10",alphabet:"0123456789"});var Rh={};C(Rh,{base16:()=>SI,base16upper:()=>EI});var SI=re({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),EI=re({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Nh={};C(Nh,{base2:()=>AI});var AI=re({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var $h={};C($h,{base256emoji:()=>_I});var n0=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),TI=n0.reduce((t,e,r)=>(t[r]=e,t),[]),II=n0.reduce((t,e,r)=>{let n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return t[n]=r,t},[]);function DI(t){return t.reduce((e,r)=>(e+=TI[r],e),"")}function BI(t){let e=[];for(let r of t){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=II[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);e.push(o)}return new Uint8Array(e)}var _I=sn({prefix:"\u{1F680}",name:"base256emoji",encode:DI,decode:BI});var zh={};C(zh,{base8:()=>LI});var LI=re({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Fh={};C(Fh,{identity:()=>CI});var CI=sn({prefix:"\0",name:"identity",encode:t=>Vc(t),decode:t=>Hc(t)});var uR=new TextEncoder,dR=new TextDecoder;var Mh={};C(Mh,{identity:()=>NI});var o0=0,PI="identity",s0=ct;function RI(t){return Ar(o0,s0(t))}var NI={code:o0,name:PI,encode:s0,digest:RI};var jh={};C(jh,{sha256:()=>Rs,sha512:()=>$I});function i0(t){return async e=>new Uint8Array(await crypto.subtle.digest(t,e))}var Rs=Tr({name:"sha2-256",code:18,encode:i0("SHA-256")}),$I=Tr({name:"sha2-512",code:19,encode:i0("SHA-512")});var Hh={...Fh,...Nh,...zh,...Ph,...Rh,...cf,...ff,...uf,...nu,...$h},gR={...jh,...Mh};function c0(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}var a0=c0("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Vh=c0("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=xr(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),bR={utf8:a0,"utf-8":a0,hex:Hh.base16,latin1:Vh,ascii:Vh,binary:Vh,...Hh};var f0=new WeakMap,Pc=t=>{let e=f0.get(t.bytes);return e||(e=He.encode(t.bytes),f0.set(t.bytes,e)),e},Le,jt=class{constructor(e){it(this,Le);at(this,Le,new Map);for(let[r,n]of e??[])this.set(r,n)}get[Symbol.toStringTag](){return"DigestMap"}clear(){te(this,Le).clear()}delete(e){let r=Pc(e);return te(this,Le).delete(r)}forEach(e,r){for(let[n,o]of te(this,Le).values())e.call(r,o,n,this)}get(e){let r=te(this,Le).get(Pc(e));if(r)return r[1]}has(e){return te(this,Le).has(Pc(e))}set(e,r){return te(this,Le).set(Pc(e),[e,r]),this}get size(){return te(this,Le).size}[Symbol.iterator](){return this.entries()}*entries(){yield*te(this,Le).values()}*keys(){for(let[e]of te(this,Le).values())yield e}*values(){for(let[,e]of te(this,Le).values())yield e}};Le=new WeakMap;var d0="index/sharded/dag@0.1",qR=x.variant({[d0]:x.struct({content:x.link(),shards:x.array(x.link())})}),u0=x.bytes(),WR=x.tuple([u0,x.array(x.tuple([u0,x.tuple([x.number(),x.number()])]))]);var Ns,Gr,qh=class{constructor(e){it(this,Ns);it(this,Gr);at(this,Ns,e),at(this,Gr,new jt)}get content(){return te(this,Ns)}get shards(){return te(this,Gr)}setSlice(e,r,n){let o=te(this,Gr).get(e);o||(o=new jt,te(this,Gr).set(e,o)),o.set(r,n)}archive(){return FI(this)}};Ns=new WeakMap,Gr=new WeakMap;var l0=t=>new qh(t),FI=async t=>{let e=new Map,r=[...t.shards.entries()].sort((a,c)=>Uc(a[0].digest,c[0].digest)),n={content:t.content,shards:[]};for(let a of r){let c=[...a[1].entries()].sort((w,f)=>Uc(w[0].digest,f[0].digest)).map(w=>[w[0].bytes,w[1]]),u=be([a[0].bytes,c]),d=await Rs.digest(u),h=dn(ut,d);e.set(h.toString(),{cid:h,bytes:u}),n.shards.push(h)}let o=be({[d0]:n}),s=await Rs.digest(o),i=dn(ut,s);return O(X.encode({roots:[{cid:i,bytes:o}],blocks:e}))};var m0=Symbol.for("@achingbrain/uint8arraylist");function h0(t,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let r=0;for(let n of t){let o=r+n.byteLength;if(e<o)return{buf:n,index:e-r};r=o}throw new RangeError("index is out of bounds")}function Rc(t){return!!t?.[m0]}var p0,Nc=class t{constructor(...e){F(this,"bufs");F(this,"length");F(this,p0,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(p0=m0,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let r=0;for(let n of e)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(Rc(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...e){this.prependAll(e)}prependAll(e){let r=0;for(let n of e.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(Rc(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(e){let r=h0(this.bufs,e);return r.buf[r.index]}set(e,r){let n=h0(this.bufs,e);n.buf[n.index]=r}write(e,r=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(r+n,e[n]);else if(Rc(e))for(let n=0;n<e.length;n++)this.set(r+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,r){let{bufs:n,length:o}=this._subList(e,r);return Oc(n,o)}subarray(e,r){let{bufs:n,length:o}=this._subList(e,r);return n.length===1?n[0]:Oc(n,o)}sublist(e,r){let{bufs:n,length:o}=this._subList(e,r),s=new t;return s.length=o,s.bufs=[...n],s}_subList(e,r){if(e=e??0,r=r??this.length,e<0&&(e=this.length+e),r<0&&(r=this.length+r),e<0||r>this.length)throw new RangeError("index is out of bounds");if(e===r)return{bufs:[],length:0};if(e===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],a=o,c=a+i.byteLength;if(o=c,e>=c)continue;let u=e>=a&&e<c,d=r>a&&r<=c;if(u&&d){if(e===a&&r===c){n.push(i);break}let h=e-a;n.push(i.subarray(h,h+(r-e)));break}if(u){if(e===0){n.push(i);continue}n.push(i.subarray(e-a));continue}if(d){if(r===c){n.push(i);break}n.push(i.subarray(0,r-a));break}n.push(i)}return{bufs:n,length:r-e}}indexOf(e,r=0){if(!Rc(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),e.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let h=0;h<s;h++)i[h]=-1;for(let h=0;h<o;h++)i[n[h]]=h;let a=i,c=this.byteLength-n.byteLength,u=n.byteLength-1,d;for(let h=r;h<=c;h+=d){d=0;for(let w=u;w>=0;w--){let f=this.get(h+w);if(n[w]!==f){d=Math.max(1,w-a[f]);break}}if(d===0)return h}return-1}getInt8(e){let r=this.subarray(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(e,r){let n=xr(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,e)}getInt16(e,r){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(e,r,n){let o=Mt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,e)}getInt32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(e,r,n){let o=Mt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,e)}getBigInt64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(e,r,n){let o=Mt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,e)}getUint8(e){let r=this.subarray(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(e,r){let n=xr(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,e)}getUint16(e,r){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(e,r,n){let o=Mt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,e)}getUint32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(e,r,n){let o=Mt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,e)}getBigUint64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(e,r,n){let o=Mt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,e)}getFloat32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(e,r,n){let o=Mt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,e)}getFloat64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(e,r,n){let o=Mt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,e)}equals(e){if(e==null||!(e instanceof t)||e.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!Ot(this.bufs[r],e.bufs[r]))return!1;return!0}static fromUint8Arrays(e,r){let n=new t;return n.bufs=e,r==null&&(r=e.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};var jI=Math.pow(2,31),Wh=t=>{let e=[],r=0;for(;t>=jI;)e[r++]=t&255|128,t/=128;for(;t&-128;)e[r++]=t&255|128,t>>>=7;return e[r]=t|0,e},Kr=(t,e)=>{let r=0;e=e||0;let n=0,o=e,s,i=t.length;do{if(o>=i||n>49)throw new RangeError("Could not decode varint");s=t.get(o++),r+=n<28?(s&127)<<n:(s&127)*Math.pow(2,n),n+=7}while(s>=128);return[r,o-e]};var bt={ReadHeaderLength:0,ReadHeader:1,ReadBlockLength:2,ReadBlock:3},g0={SHA2_256:18,LENGTH:32,DAG_PB:112},$s,$c=class extends TransformStream{constructor(r,n){let o=new Nc,s=0,i=s,a=8,c=bt.ReadHeaderLength,u,d=new Promise(h=>{u=h});super({transform(h,w){for(o.append(h);!(o.length<a);)if(c===bt.ReadHeaderLength){let[f,l]=Kr(o);o.consume(l),i=s,s+=l,c=bt.ReadHeader,a=f}else if(c===bt.ReadHeader){let f=ke(o.slice(0,a));u&&u(f),o.consume(a),i=s,s+=a,c=bt.ReadBlockLength,a=8}else if(c===bt.ReadBlockLength){let[f,l]=Kr(o);o.consume(l),i=s,s+=l,c=bt.ReadBlock,a=f}else if(c===bt.ReadBlock){let f=i,l=s-i+a;i=s;let m;if(o.get(0)===g0.SHA2_256&&o.get(1)===g0.LENGTH){let y=o.subarray(0,34),S=Ve(y);m=pm(S),o.consume(34),s+=34}else{let[y,S]=Kr(o);if(y!==1)throw new Error(`unexpected CID version (${y})`);o.consume(S),s+=S;let[v,A]=Kr(o);o.consume(A),s+=A;let B=HI(o),E=Ve(o.subarray(0,B));m=dn(v,E),o.consume(B),s+=B}let D=a-(s-i),g=o.subarray(0,D);w.enqueue({cid:m,bytes:g,offset:f,length:l,blockOffset:s,blockLength:D}),o.consume(D),i=s,s+=D,c=bt.ReadBlockLength,a=8}},flush(h){c!==bt.ReadBlockLength&&h.error(new Error("unexpected end of data"))}},r,n??new CountQueuingStrategy({highWaterMark:1}));it(this,$s);at(this,$s,d)}getHeader(){return te(this,$s)}};$s=new WeakMap;var HI=t=>{let[,e]=Kr(t),[r,n]=Kr(t,e);return e+n+r};var VI=t=>{let e=be({version:1,roots:t}),r=Wh(e.length),n=new Uint8Array(r.length+e.length);return n.set(r,0),n.set(e,r.length),n},qI=t=>{let e=Wh(t.cid.bytes.length+t.bytes.length),r=new Uint8Array(e.length+t.cid.bytes.length+t.bytes.length);return r.set(e),r.set(t.cid.bytes,e.length),r.set(t.bytes,e.length+t.cid.bytes.length),r},Gh=class extends TransformStream{constructor(e=[],r,n){super({start:o=>o.enqueue(VI(e)),transform:(o,s)=>s.enqueue(qI(o))},r,n)}};async function Kh(t,e,r){let n=l0(t);for(let[o,s]of e.entries()){let i=r[o];n.shards.set(s.multihash,i)}return await n.archive()}var WI=133169152,zc=class extends TransformStream{constructor(e={}){let r=e.shardSize??WI,n=r-Zn(),o=[],s=null,i=new jt,a=null,c=0;super({async transform(u,d){s!=null&&a!=null&&(d.enqueue(await zs(s,a)),s=null,a=null);let h=Ps(u),w=h+u.bytes.length;if(w>n)throw new Error(`block will cause CAR to exceed shard size: ${u.cid}`);o.length&&c+w>n&&(s=o,a=i,o=[],i=new jt,c=0),o.push(u),i.set(u.cid.multihash,[Zn()+c+h,u.bytes.length]),c+=w},async flush(u){s!=null&&a!=null&&u.enqueue(await zs(s,a));let d=o.at(-1);if(d==null)return;let h=e.rootCID??d.cid,w=Zn(h);if(w+c>r){let f=w+c-r,l=[],m=0;for(;m<f;){let g=o[o.length-1];if(o.pop(),i.delete(g.cid.multihash),l.unshift(g),m+=Uh(g),o.length<1)throw new Error(`block will cause CAR to exceed shard size: ${g.cid}`)}u.enqueue(await zs(o,i)),m=0;let D=new jt;for(let g of o){let y=Ps(g);D.set(g.cid.multihash,[w+m+y,g.bytes.length]),m+=y+g.bytes.length}u.enqueue(await zs(l,D,h))}else{let f=w-Zn();for(let l of i.values())l[0]+=f;u.enqueue(await zs(o,i,h))}}})}},y0=(t,e,r=n=>n.name)=>GI(t,e,r);function GI(t,e,r){let n=r(t),o=r(e);return n===o?0:n<o?-1:1}var zs=async(t,e,r)=>Object.assign(await Oh(t,r),{slices:e});async function DN(t,e,r={}){return await Jh(t,Ac(e,r),r)}async function BN(t,e,r={}){let{customOrder:n=!1}=r,o=n?e:[...e].sort(y0);return await Jh(t,Tc(o,r),r)}async function _N(t,e,r={}){let n=new Os(e);return r.rootCID=r.rootCID??(await n.getRoots())[0],await Jh(t,n,r)}async function Jh(t,e,{pieceHasher:r=Tf,...n}={}){let o=typeof t=="function"?t:()=>t,s=[],i=[],a=null;if(await e.pipeThrough(new zc(n)).pipeThrough(new TransformStream({async transform(l,m){let D=new Uint8Array(await l.arrayBuffer()),g=await Rd.digest(D),y=await o([{can:gl,nb:Fa(g,D.length)}]);await es(y,g,D,n);let S=Ho(Cc,g),v;if(r){let oe=await r.digest(D);v=Ho(sa,oe);let Jr=Ho(sa,g),br=await na.filecoinOffer({issuer:y.issuer,audience:y.audience,with:y.issuer.did(),proofs:y.proofs},Jr,v,n);if(br.out.error)throw new Error("failed to offer piece for aggregation into filecoin deal",{cause:br.out.error})}let{version:A,roots:B,size:E,slices:U}=l;m.enqueue({version:A,roots:B,size:E,cid:S,piece:v,slices:U})}})).pipeTo(new WritableStream({write(l){a=a||l.roots[0],i.push(l.cid),l.slices.set(l.cid.multihash,[0,l.size]),s.push(l.slices),n.onShardStored&&n.onShardStored(l)}})),!a)throw new Error("missing root CID");let c=await Kh(a,i,s);if(!c.ok)throw new Error("failed to archive DAG index",{cause:c.error});let u=await Rd.digest(c.ok),d=Ho(Cc,u),[h,w,f]=await Promise.all([o([{can:gl,nb:Fa(u,c.ok.length)}]),o([{can:vw,nb:yl(d)}]),o([{can:Ew,nb:wl(a,i)}])]);return await es(h,u,c.ok,n),await ja(w,d,n),await qa(f,a,i,n),a}export{$o as a,zd as b,Ly as c,yw as d,kw as e,Sw as f,Dw as g,Jb as h,r0 as i,zc as j,y0 as k,DN as l,BN as m,_N as n};
/*! Bundled license information:

@noble/ed25519/lib/esm/index.js:
  (*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=chunk-HDJNUV7D.js.map
